[{"title": "RosAria node doesn\u2019t receive messages", "time": "2018-10-29 14:55:46Z", "post_content": ["Macbook Air with Ubuntu virtual machine via VMWare", "\nPioneer3 AT robot", "\nROS", "\nRosAria", "I have at least most of the setup for Ros+RosAria already working:", "The RosAria node running on the robot confirms it\u2019s able to connect to the master, and if I run the command ", " on the laptop I can see ", " as one of the available topics.", "In the terminal window where I try to publish to ", " I\u2019m told that the message is sending but the robot shows no signs of having received it, neither console message nor movement of the wheels.", "However, if I quit the RosAria node on the robot and restart it while leaving the ", " command running on my laptop, the robot registers the message once upon startup, moves accordingly for a bit, and then does nothing.", "I\u2019ve also tried to ", " other topics like battery state, motors status and pose, but I don\u2019t receive any messages from the robot.", "I already tried changing the parameters ", " and ", " according to ", ".", "The project I was working on where this problem came up isn\u2019t using the same equipment anymore, so now this question is not so urgent for me. I\u2019m also not able to test proposed solutions in the near future since I no longer have access to that Pioneer robot. However, I\u2019ll keep this topic unanswered in case someone else encounters this problem too."], "answer": ["You need To Set ROS_IP On Robot side too to let the ROS System Knows What IP To Use as It's Network Interface", "I myself Set This Environments Inside ", " Like This:", "and then source ", ".", "I think You can use ", " Too  But  I never tested."], "question_code": ["192.168.1.112", "roscore", "192.168.1.108", "rosrun rosaria RosAria", "rosparam set...", "ROS_MASTER_URI=192.168.1.112:11311", "ROS_IP=192.168.1.112", "rostopic pub /RosAria/cmd_vel geometry_msgs/Twist \u201clinear:... angular:...\u201d", "rostopic list", "/RosAria/cmd_vel", "/RosAria/cmd_vel", "rostopic pub", "rostopic echo", "/RosAria/TicksMM", "/RosAria/RevCount", "cmd_vel"], "answer_code": [".bashrc", "export ROS_IP=192.168.1.108", ".bashrc", "rosparam", "ROS_IP", "ROS_MASTER_URI"], "url": "https://stackoverflow.com/questions/52939173/rosaria-node-doesn-t-receive-messages"}
,{"title": "How to make a pyqt gui refresh", "time": "2018-06-21 21:24:20Z", "post_content": ["I am making a gui in pyqt which gets battery levels for a robot and then displays them. The gui would therefore have to constantly update its battery level displays (which are displayed using QProgressBar). ", "However, if I were to put the progress bars in a loop, it makes infinite copies of the graphics and stacks them on top of each other. So essentially my question would be how might I make the progress bars refresh without making additional copies? Is there a way to delete everything in the loop after each recurrence?"], "answer": ["make the progress bar a global var, and have another thread call the update progress method, don't copy the progress bar itself.", "Also, in this site, it is customary to copy and paste code, otherwise how will other people will follow the time honored tradition to copy the question instead of the answer?"], "url": "https://stackoverflow.com/questions/50977603/how-to-make-a-pyqt-gui-refresh"}
,{"title": "Simulating battery life of a Turtlebot 3 in Gazebo", "time": "2020-01-16 21:24:03Z", "post_content": ["I have been researching ROS, Gazebo and Turtlebot 3 for the last 3 days for the first time ever and I have been trying to create a simulation where I can drive around a Turtlebot 3 while its battery state is simulated.", "I have read about the Gazebo battery class, but I do not know how to use or implement it. I have also read that a Turtlebot 3 should output its BatteryState under the sensor_msgs topic, however my gazebo simulation does not publish this topic. I do know that this ", " be possible to achieve but do not know what file to edit or what config to add. I am a very big ROS noob, especially in combination with Gazebo considering my 3 day limited research. I use the standard simulation provided by Turtlebot3:", "roslaunch turtlebot3_gazebo turtlebot3_house.launch", "I cannot imagine simulating battery life is not possible in Gazebo so I have reached my last resort, which is to ask for help here. I have found the brass_gazebo_plugin but find its GitHub README and generally any info on it very non-descriptive and would need help from the community to at least get me started towards a simulation where a Turtlebot 3 is just standing in an open space, publishing its battery state."], "answer": [], "quote": ["roslaunch turtlebot3_gazebo turtlebot3_house.launch"], "url": "https://stackoverflow.com/questions/59778016/simulating-battery-life-of-a-turtlebot-3-in-gazebo"}
,{"title": "ROS bebop_autonomy error with parrot bebop drone", "time": "2017-04-01 20:18:35Z", "post_content": ["I am relatively new to ROS and bebop drones, and I am just starting to install and use bebop_autonomy to connect to my  Parrot Bebop drone.", "I could ping my drone at  192.168.42.1, but then I encounter problems when I am following the documentation on \"Running the Driver\".", "When I try to run the driver as a node or a nodelet, I get error messages as followings:", "What could be the possible cause of this and how could I fix this?"], "answer": ["Turns out the error is caused by the network setting of my virtual machine.\nAfter I changed the adapter from NAT to bridged network, the problem is resolved."], "question_code": ["$ roslaunch bebop_driver bebop_node.launch\n... logging to /home/brian/.ros/log/4d22fb4c-1711-11e7-80d1-0800279b4b72/roslaunch-brian-VirtualBox-28034.log\nChecking log directory for disk usage. This may take awhile.\nPress Ctrl-C to interrupt\nDone checking log file disk usage. Usage is <1GB.\n\nxacro: Traditional processing is deprecated. Switch to --inorder processing!\nTo check for compatibility of your document, use option --check-order.\nFor more infos, see http://wiki.ros.org/xacro#Processing_Order\nstarted roslaunch server http://brian-VirtualBox:35861/\n\nSUMMARY\n========\n\nPARAMETERS\n * /bebop/bebop_driver/bebop_ip: 192.168.42.1\n * /bebop/bebop_driver/camera_info_url: package://bebop_d...\n * /bebop/bebop_driver/cmd_vel_timeout: 0.2\n * /bebop/bebop_driver/odom_frame_id: odom\n * /bebop/bebop_driver/publish_odom_tf: True\n * /bebop/bebop_driver/reset_settings: True\n * /bebop/bebop_driver/states/enable_altitudechanged: True\n * /bebop/bebop_driver/states/enable_autotakeoffmodechanged: True\n * /bebop/bebop_driver/states/enable_camerastate_orientation: True\n * /bebop/bebop_driver/states/enable_commonstate_batterystatechanged: True\n * /bebop/bebop_driver/states/enable_commonstate_wifisignalchanged: True\n * /bebop/bebop_driver/states/enable_controllerstate_ispilotingchanged: True\n * /bebop/bebop_driver/states/enable_flightplanstate_availabilitystatechanged: True\n * /bebop/bebop_driver/states/enable_flightplanstate_componentstatelistchanged: True\n * /bebop/bebop_driver/states/enable_gpsstate_numberofsatellitechanged: True\n * /bebop/bebop_driver/states/enable_mavlinkstate_mavlinkfileplayingstatechanged: True\n * /bebop/bebop_driver/states/enable_mavlinkstate_mavlinkplayerrorstatechanged: True\n * /bebop/bebop_driver/states/enable_mediastreamingstate_videoenablechanged: True\n * /bebop/bebop_driver/states/enable_numberofsatellitechanged: True\n * /bebop/bebop_driver/states/enable_overheatstate_overheatchanged: True\n * /bebop/bebop_driver/states/enable_pilotingstate_altitudechanged: True\n * /bebop/bebop_driver/states/enable_pilotingstate_attitudechanged: True\n * /bebop/bebop_driver/states/enable_pilotingstate_flattrimchanged: True\n * /bebop/bebop_driver/states/enable_pilotingstate_flyingstatechanged: True\n * /bebop/bebop_driver/states/enable_pilotingstate_navigatehomestatechanged: True\n * /bebop/bebop_driver/states/enable_pilotingstate_positionchanged: True\n * /bebop/bebop_driver/states/enable_pilotingstate_speedchanged: True\n * /bebop/robot_description: <?xml version=\"1....\n * /rosdistro: kinetic\n * /rosversion: 1.12.7\n\nNODES\n  /bebop/\n    bebop_driver (bebop_driver/bebop_driver_node)\n    robot_state_publisher (robot_state_publisher/robot_state_publisher)\n\nauto-starting new master\nprocess[master]: started with pid [28048]\nROS_MASTER_URI=http://localhost:11311\n\nsetting /run_id to 4d22fb4c-1711-11e7-80d1-0800279b4b72\nprocess[rosout-1]: started with pid [28061]\nstarted core service [/rosout]\nprocess[bebop/bebop_driver-2]: started with pid [28073]\nprocess[bebop/robot_state_publisher-3]: started with pid [28079]\n[ INFO] [1491074874.747679255]: Initializing nodelet with 1 worker threads.\n[ INFO] [1491074874.904582440]: [BebopSDK] 03:27:54:904 | Bebop:225 - Bebop Cnstr()\n[ INFO] [1491074874.905884516]: Nodelet Cstr\n[ INFO] [1491074874.919409933]: Connecting to Bebop ...\n[ INFO] [1491074874.925985788]: [CB] 03:27:54:925 | Ardrone3PilotingStateFlatTrimChanged:386 - [STATES] Enabling states/ardrone3/PilotingState/FlatTrimChanged\n[ INFO] [1491074874.927999006]: [CB] 03:27:54:927 | Ardrone3PilotingStateFlyingStateChanged:430 - [STATES] Enabling states/ardrone3/PilotingState/FlyingStateChanged\n[ INFO] [1491074874.935265924]: [CB] 03:27:54:935 | Ardrone3PilotingStateNavigateHomeStateChanged:532 - [STATES] Enabling states/ardrone3/PilotingState/NavigateHomeStateChanged\n[ INFO] [1491074874.938969647]: [CB] 03:27:54:938 | Ardrone3PilotingStatePositionChanged:590 - [STATES] Enabling states/ardrone3/PilotingState/PositionChanged\n[ INFO] [1491074874.942837436]: [CB] 03:27:54:942 | Ardrone3PilotingStateSpeedChanged:655 - [STATES] Enabling states/ardrone3/PilotingState/SpeedChanged\n[ INFO] [1491074874.954468087]: [CB] 03:27:54:954 | Ardrone3PilotingStateAttitudeChanged:720 - [STATES] Enabling states/ardrone3/PilotingState/AttitudeChanged\n[ INFO] [1491074874.958549970]: [CB] 03:27:54:958 | Ardrone3PilotingStateAltitudeChanged:836 - [STATES] Enabling states/ardrone3/PilotingState/AltitudeChanged\n[ INFO] [1491074874.979685917]: [CB] 03:27:54:979 | Ardrone3MediaStreamingStateVideoEnableChanged:1300 - [STATES] Enabling states/ardrone3/MediaStreamingState/VideoEnableChanged\n[ INFO] [1491074874.983328651]: [CB] 03:27:54:983 | Ardrone3CameraStateOrientation:1402 - [STATES] Enabling states/ardrone3/CameraState/Orientation\n[ INFO] [1491074875.002872666]: [CB] 03:27:55:002 | Ardrone3GPSStateNumberOfSatelliteChanged:1794 - [STATES] Enabling states/ardrone3/GPSState/NumberOfSatelliteChanged\n[ INFO] [1491074875.012341492]: [CB] 03:27:55:012 | CommonCommonStateBatteryStateChanged:148 - [STATES] Enabling states/common/CommonState/BatteryStateChanged\n[ INFO] [1491074875.025082885]: [CB] 03:27:55:025 | CommonCommonStateWifiSignalChanged:510 - [STATES] Enabling states/common/CommonState/WifiSignalChanged\n[ INFO] [1491074875.037880400]: [CB] 03:27:55:037 | CommonOverHeatStateOverHeatChanged:1023 - [STATES] Enabling states/common/OverHeatState/OverHeatChanged\n[ INFO] [1491074875.042039410]: [CB] 03:27:55:042 | CommonMavlinkStateMavlinkFilePlayingStateChanged:1118 - [STATES] Enabling states/common/MavlinkState/MavlinkFilePlayingStateChanged\n[ INFO] [1491074875.043688593]: [CB] 03:27:55:043 | CommonMavlinkStateMavlinkPlayErrorStateChanged:1183 - [STATES] Enabling states/common/MavlinkState/MavlinkPlayErrorStateChanged\n[ INFO] [1491074875.055460926]: [CB] 03:27:55:055 | CommonFlightPlanStateAvailabilityStateChanged:1568 - [STATES] Enabling states/common/FlightPlanState/AvailabilityStateChanged\n[ INFO] [1491074875.058350203]: [CB] 03:27:55:058 | CommonFlightPlanStateComponentStateListChanged:1619 - [STATES] Enabling states/common/FlightPlanState/ComponentStateListChanged\n[ INFO] [1491074875.080061404]: [ARCONTROLLER_Network] 03:27:55:080 | ARCONTROLLER_Network_GetAvailableSocketPort:110 - d2c_port port: 57751\n[ INFO] [1491074875.080260750]: [ARCONTROLLER_Stream2] 03:27:55:080 | ARCONTROLLER_Stream2_Open_Socket:124 - udp local port stream: 40425\n[ INFO] [1491074875.080321851]: [ARCONTROLLER_Stream2] 03:27:55:080 | ARCONTROLLER_Stream2_Open_Socket:124 - udp local port control: 59888\n**[ERROR] [1491074875.844809497]: [ARNETWORK_Sender] 03:27:55:844 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11\n[ERROR] [1491074875.844930504]: [ARNETWORK_Sender] 03:27:55:844 | ARNETWORK_Sender_ProcessBufferToSend:421 - [0x7ff9182a7de0] Will retry sending data of buffer 11\n[ERROR] [1491074876.345381668]: [ARNETWORK_Sender] 03:27:56:345 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11\n[ERROR] [1491074876.345512497]: [ARNETWORK_Sender] 03:27:56:345 | ARNETWORK_Sender_ProcessBufferToSend:421 - [0x7ff9182a7de0] Will retry sending data of buffer 11\n[ERROR] [1491074876.846253700]: [ARNETWORK_Sender] 03:27:56:846 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11\n[ERROR] [1491074876.846399317]: [ARNETWORK_Sender] 03:27:56:846 | ARNETWORK_Sender_ProcessBufferToSend:421 - [0x7ff9182a7de0] Will retry sending data of buffer 11\n[ERROR] [1491074877.346791394]: [ARNETWORK_Sender] 03:27:57:346 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11**\n_[ WARN] [1491074877.346930301]: [ARNETWORK_Sender] 03:27:57:346 | ARNETWORK_Sender_TimeOutCallback:655 - [0x7ff9182a7de0] Did timeout sending command : project = 0 | class = 4 | command = 1 - 0_\n**[ERROR] [1491074877.847247018]: [ARNETWORK_Sender] 03:27:57:847 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11\n[ERROR] [1491074877.847486088]: [ARNETWORK_Sender] 03:27:57:847 | ARNETWORK_Sender_ProcessBufferToSend:421 - [0x7ff9182a7de0] Will retry sending data of buffer 11\n[ERROR] [1491074878.348124995]: [ARNETWORK_Sender] 03:27:58:348 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11\n[ERROR] [1491074878.348251012]: [ARNETWORK_Sender] 03:27:58:348 | ARNETWORK_Sender_ProcessBufferToSend:421 - [0x7ff9182a7de0] Will retry sending data of buffer 11\n[ERROR] [1491074878.848439032]: [ARNETWORK_Sender] 03:27:58:848 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11\n[ERROR] [1491074878.848561779]: [ARNETWORK_Sender] 03:27:58:848 | ARNETWORK_Sender_ProcessBufferToSend:421 - [0x7ff9182a7de0] Will retry sending data of buffer 11\n[ERROR] [1491074879.349409300]: [ARNETWORK_Sender] 03:27:59:349 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11**\n_[ WARN] [1491074879.349558890]: [ARNETWORK_Sender] 03:27:59:349 | ARNETWORK_Sender_TimeOutCallback:655 - [0x7ff9182a7de0] Did timeout sending command : project = 0 | class = 4 | command = 2 - 0_\n**[ERROR] [1491074879.849932869]: [ARNETWORK_Sender] 03:27:59:849 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11\n[ERROR] [1491074879.850073686]: [ARNETWORK_Sender] 03:27:59:850 | ARNETWORK_Sender_ProcessBufferToSend:421 - [0x7ff9182a7de0] Will retry sending data of buffer 11**\n[ INFO] [1491074880.327451025]: [ARNETWORKAL_WifiNetwork] 03:28:00:327 | ARNETWORKAL_WifiNetwork_Receive:918 - [0x7ff91824dff0] connection lost (too long time without reception)\n[ INFO] [1491074880.327663960]: [ARCONTROLLER_Device] 03:28:00:327 | ARCONTROLLER_Device_StartRun:4987 - Start failed or canceled.\n**[ERROR] [1491074880.351238007]: [ARNETWORK_Sender] 03:28:00:351 | ARNETWORK_Sender_ProcessBufferToSend:405 - [0x7ff9182a7de0] Timeout waiting for ack in buffer 11\n[ERROR] [1491074880.351367810]: [ARNETWORK_Sender] 03:28:00:351 | ARNETWORK_Sender_ProcessBufferToSend:421 - [0x7ff9182a7de0] Will retry sending data of buffer 11\n[ERROR] [1491074881.325474151]: [ARCONTROLLER_Device] 03:28:01:325 | ARCONTROLLER_Device_StartRun:4995 - Start fail error :start canceled**\n[ INFO] [1491074881.325635335]: [BebopSDK] 03:28:01:325 | Cleanup:326 - Bebop Cleanup()\n[FATAL] [1491074881.325830937]: Init failed: Waiting for device failed: No error\n[ INFO] [1491074881.325905075]: Bebop Nodelet Dstr: 0\n[ INFO] [1491074881.325916417]: Killing Camera Thread ...\n[ INFO] [1491074881.325929273]: Killing Aux Thread ...\n^C[bebop/robot_state_publisher-3] killing on exit\n[bebop/bebop_driver-2] killing on exit\n[rosout-1] killing on exit\n[master] killing on exit\n"], "url": "https://stackoverflow.com/questions/43161584/ros-bebop-autonomy-error-with-parrot-bebop-drone"}
,{"title": "How to install ROS (Robotics Operating System) on Raspberry pi 3", "time": "2018-11-09 06:40:44Z", "post_content": ["How i will able to install ROS (Robotics Operating System). I want to install ROS on my raspberry pi 3."], "answer": ["There are many of Image list item you need to choice one", "It take some minutes about 1 GB file. When download completed Unzip ROS image into a folder ", " ", "$ rostopic list", "Output"], "answer_code": ["/battery_state\n/cmd_vel\n/diagnostics\n/joint_states\n/joy\n/left_error\n/motor_node/parameter_descriptions\n/motor_node/parameter_updates\n/right_error\n/rosout\n/rosout_agg\n/statistics\n/tf\n/tf2_web_republisher/cancel\n/tf2_web_republisher/feedback\n/tf2_web_republisher/goal\n/tf2_web_republisher/result\n/tf2_web_republisher/status\n/tf_static\n"], "url": "https://stackoverflow.com/questions/53220885/how-to-install-ros-robotics-operating-system-on-raspberry-pi-3"}
,{"title": "Android: NullPointerException 'double java.lang.Double.doubleValue()'", "time": "2019-10-04 07:25:11Z", "post_content": ["I'm new to android programming and I'm having a problem with my codes. Can anyone help me or point out the cause of my error because I'm not really sure why it's giving me a NullPointerException when its a text view or if that is possible.", "LogCat:", "Here is the code for that line:", "But when i run my app my voltage is setting null and here is the code for the voltage:", "Here is the full code:"], "answer": ["Check weather your created class with ", " is not null", "and then check class fields values  is not null or 0.", "You can check null before you set text on textview like the following.", "Everytime when you are setting the text to textview, you must need to check if it is not null."], "question_code": ["    java.lang.NullPointerException: Attempt to invoke virtual method 'double java.lang.Double.doubleValue()' on a null object reference\n    at com.example.app.rosbridge.MainActivity$2$1.run(MainActivity.java:133)\n", "   current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n", "   voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n", "public class MainActivity extends Activity {\n\n\nprivate TextView voltage, current, percentage, status;\nprivate SubscribedData<BatteryState> batteryStateData;\nprivate RosbridgeListener rosbridge;\nprivate boolean subscribed = false;\nprivate boolean advertised = false;\n\n/** Indicates that Lint should ignore the specified warnings for the annotated element. */\n@SuppressLint(\"ClickableViewAccessibility\")\n@Override\n\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main_activity);\n\n    Button settings_btn = (Button) findViewById(R.id.connect_btn);\n\n    voltage = findViewById(R.id.voltage_txt);\n    current = findViewById(R.id.current_txt);\n    percentage = findViewById(R.id.percentage_txt);\n    status = findViewById(R.id.status_txt);\n    connectButton = findViewById(R.id.connect_btn);\n\n    batteryStateData = new SubscribedData<>();\n    final Type batteryStateType = new TypeToken<SubscribedData<BatteryState>>() {\n    }.getType();\n\n\n    // ROSBRIDGE protocol allows access to underlying ROS messages and services as serialized JavaScript Object Notation (JSON) objects\n     WebSocket protocol communicates to a server for the connection from a user's web browser\n\n    //A connection to the rosbridge thru the IP address of the robot from the socket\n    rosbridge = new RosbridgeListener(\"ws://10.24.204.231:9090\");\n    rosbridge.setOnDataReceivedListener(new RosbridgeMessageListener() {\n\n        // a running thread that when the connection is made the data of the topic will serialize and deserialized java objects to (and from) JSON. @param msg\n\n            @Override\n            public void onDataReceived(final String msg) {\n                try {\n                    runOnUiThread(new Runnable() {\n                        @Override\n                        public void run() {\n                            batteryStateData = new Gson().fromJson(msg, batteryStateType);\n                            voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n                            current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n                            percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n                            status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n                        }\n                    });\n\n                    Log.d(\"B9T\", String.format(\"Received data: %s\", msg));\n                }\n                catch (Exception e)\n                {\n                    e.printStackTrace();\n                }\n            }\n        });\n\n    connectButton.setOnClickListener(new View.OnClickListener() {\n        @Override\n        public void onClick(View view) {\n\n            if (!subscribed) {\n                 rosbridge.Subscribe(\"/battery\", \"sensor_msgs/BatteryState\");\n                 subscribed = true;\n\n            connectButton.setText(\"Disconnect\");\n\n              } else {\n\n                rosbridge.UnSubscribe(\"/battery\");\n                subscribed = false;\n            connectButton.setText(\"Connect\");\n\n      }\n          }\n    });\n", "batteryStateData.msg.current "], "answer_code": ["batteryStateData = new Gson().fromJson(msg, batteryStateType);\nif (batteryStateData != null) {\n\n    if (batteryStateData.msg.voltage!=0)\n        voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n\n    if (batteryStateData.msg.current!=0)\n        current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n\n    if (batteryStateData.msg.percentage!=0)\n        percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n\n    if (batteryStateData.msg.values !=null)\n        status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n\n}\n", " @Override\n public void run() {\n     batteryStateData = new Gson().fromJson(msg, batteryStateType);\n\n     // check null before set text or calculate something\n     if(batteryStateData.msg.current != null){\n         current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n     }\n     // you can check belows like above\n\n     voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n\n     percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n     status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n}\n"], "url": "https://stackoverflow.com/questions/58230939/android-nullpointerexception-double-java-lang-double-doublevalue"}
,{"title": "Raspberry Pi is freezing since CPU usage reaches 100 while installing ROS", "time": "2018-10-03 09:05:44Z", "post_content": ["I am trying to install ROS on Raspberry Pi 3 (Raspbian Jessie).", "After invoking following command, I realized that Raspberry Pi is freezing and it is not responding anymore-", "I tried to power it off and re-run the above command. However, it got stuck again on the same line. I also tried to use CLI but got in vain. Please see below a picture-", "Please see below the output of ", " command-"], "answer": ["Your system is running out of memory. Even your swap is full. You can solve this issue in multiple ways:"], "question_code": ["sudo ./src/catkin/bin/catkin_make_isolated --install -DCMAKE_BUILD_TYPE=Release --install-space /opt/ros/indigo\n", "top", "htop", "top"], "answer_code": ["--jobs 1"], "url": "https://stackoverflow.com/questions/52621056/raspberry-pi-is-freezing-since-cpu-usage-reaches-100-while-installing-ros"}
,{"title": "Should I make a large function atomic in order to benchmark it accurately?", "time": "2017-05-23 11:53:50Z", "post_content": ["I would like to know how long it takes to execute some code. The code I am executing deals with openCV matrices and operations. The code will be run in a ROS environment on Linux. I don't want the code to be interrupted by system functions during my benchmarking.", "Looking at ", " about benchmarking, the answerer said the granularity of the result is 15ms. I would like to do much better than that and so I was considering to make the function atomic (just for benchmarking purposes). I'm not sure if it is a good idea for a few reasons, primarily because I don't have a deep understanding of processor architecture. ", "The function I am trying to bench mark is not a short function. ", "Will the result be accurate? For marking the time I'm considering to use ", ".", "Will it do something horrible to my computer? Call me superstitious but I think it's good to ask this question.", "I'm using C++11 on the Linux Kernel."], "answer": ["C++11 atomics are not atomic in the RTOS way, they just provide guarantees when writing multithreaded code. Linux is not an RTOS. Your code can and will always be interrupted. There are some ways to lessen the effects though, but not without diving very deeply into linux.", "You can for example configure the ", " to get interrupted less by other userspace programs. You can tell the kernel on which CPU core to process interrupts, then pin your program to a different cpu. You can increase the timer precision etc, but:", "There are many other things that might change the runtime of your algorithm like several layers of CPU caches, power saving features of your CPU, etc... If you are really only interested in benchmarking the execution time of your function for non-hard realtime problems, it is easier to just run the algorithm many many times and get a statistical estimate for the execution time.", "OR: You say that you want to know what influence the algorithm has on your total program runtime? Use profiling tools like ", " (integratable into QtCreator)."], "question_code": ["void atomic_wrapper_function(const object& A, const object& B) {\n  static unsigned long running_sum = 0;\n  unsigned long before, after;\n  before = GetTimeMs64();\n  function_to_benchmark(A, B);\n  after = GetTimeMs64();\n  running_sum += (after - before);\n}\n"], "answer_code": ["callgrind"], "url": "https://stackoverflow.com/questions/42150311/should-i-make-a-large-function-atomic-in-order-to-benchmark-it-accurately"}
,{"title": "ROS package: 64 bit vs 32 bit.Problems in execution", "time": "2014-10-07 07:17:22Z", "post_content": ["I have a ROS package that uses PCL libraries  and that works perfectly in Groovy and Hydro, both in 64 bit machines.\nIn 32 bit machines, I can compile the package exactly the same way, without problems, but in execution it does not work.\nThe callbacks in it go indredibly slow, sometimes taking more than a minute, when in 64 bit they work perfectly fine.\nAny possible causes for this package being stuck in 32 bit?\nI am runnning Ubuntu 12.04 64 bit with Hydro and Groovy, and Ubuntu 12.04 32 bit with Hydro.", "Thank you all in advance,"], "answer": ["Problem solved. The execution problems were due to the processing power difference between 32 and 64 bit, and also due to RAM memory available in both systems.\nDownsampling the point cloud that I was trying to process solved the problem and now the algorithm runs ok in 32 bit platform.", "Thanks to all,", "Alberto"], "url": "https://stackoverflow.com/questions/26230545/ros-package-64-bit-vs-32-bit-problems-in-execution"}
,{"title": "roslaunch activation failure what should i do?", "time": "2019-11-04 06:06:32Z", "post_content": ["i tried to launch the sdk package by typing", "however every time i get this error:", "here is the steps that i followed to activate the drone:", "where i edit the baud rate/app id/ enc key/ and serial name.", "app_id: 1079440\nbaud_rate: 921600\nserial_name: /dev/ttyUSB0\nenc_key: 39d353a8e9ad01b6c659111904bae57ebb138785aa5159699383f28da3f56563", "and i continued with the following commands:", "its where i got the error.", "i'm using USB-TTL cable to connect manifold 2-c with M210 RTK V2, also i got the permission first before typing any code by typing :", "and then log out and log in\nthen i typed :", "to read and give permission to serial port.", "TX (green wire) and Rx (white wire) and ground (black wire) there were put respectively.", "so now what should i do?"], "answer": ["There are too many possibility\nPlease refer my previous answers and check them one by one", "Information you have given is not enough, there could be many possibilities. Please go through with the following checklist (this is what first comes to my mind, if I remember sth new, I`ll add it in)", "The list is meant for error such as  Drone version not obtained  or  new device error  or  first success connection(get firmware) then failed activation for Both DJI OSDK and DJI OSDK-ROS. Assuming you already enabled the API control, then check", "Does UART on RPI is enabled? if not, enable it. Are you using the correct serial ID as well? If not, set it right. Recommend using /dev/serial/by-id/usb-XXX method", "Does Baud rate in DJI assisatnt2 is same as the one in the USERCONFIG file of OSDK? if not, make it same", "Did u give permission to the serial device e.g sudo chmod a+rw  or  sudo usermod -a -G dialout $USER   or  set the udev rule .  If not choose a way to get it right.", "FTDI series problems", "4.1 Did you use this FTDI cable successfully on other platform before?(to make sure tx rx is correct)  ", "4.2 Is this FTDI 3.3V? If not, high chance your FCU board is already burned. Send it back for repair. ", "4.3 Measure the voltage on Tx and RX pin while everything is connected, is it being pulled up at 3.3V? if less than 3 then there is a serious communication issue.  ", "4.4 Is there EMI generator around?( this one happen to me once, took me 2 weeks to isolate the issue, EMI cause unreliable connection)", "4.5 As an additional test, prob the tx and tx by Y cable using real-term to see if you can see any proper communication happening.", "Did u forget to turn on the RC ? If so turn it on while calling the sdk.launch", "GO app side issue", "6.1 Did u connect the Go app while running sdk.launch? If not connect by GO app, connect it as it will pop up sth. ", "6.2 Did you login to your account which creates the app id?If not, login to it. ", "6.3 And is your account being banned for flying in the non-authorized area before(e.g caught by DJI aeroscope/Flyhub) and police is actually going after you? If so, stop playing the drone and surrender urself in. Normally it should be max of one year Jail time, but if you resist, the punishment can be more deadly.", "Did u give authority from GO app? click ok or confirm on the GO App once you run sdk.launch in the RPI. Once you launch the sdk, ", " After changing the firmware, you should experience this again.", "Did u tried the hardware with the 3.8 with a Normal X86/X64 Intel PC/notebook with Ubuntu 16/18 before? is it working? ( rule out hardware / connection issue ) If can work, then its RPI issue. If can not, high chance drone/RC side.  I do have couple RPI burn down experience b4. ", "Did u have valid/correct app id and enc key? double check it. If not, enter is correct.", "Is the voltage supplied to A3 stable and clean?", "Have you tried this way of calling? /the_sample_u_wish_to_run UserConfig.txt /dev/ttyACM0  (this is what I gathered from other peoples experience)", "Which version of RPI you are using, if you are using 2 series, the high chance you have to use ", " with older version firmware.  I only tested with RPI 3B. Can not guarantee the function of other versions. That's why number 8 is important to isolate the issue. ", "Are you calling the sdk.launch from somewhere else? make sure you only call it once and prevent it from being calling again. Make sure the serial port is not occupied. ", "Make sure API is enabled in DJI assistant2. Close everything power on and connect to DJI assistant 2 again to verify this. If by any chance the board has an issue, the API enable you set in the previous run will get auto deselected. This is to rule out burned FCU board issue. ", "If by now it is still can not work, then you should try other 3.8 or 3.7 with firmware 1.7.7 and 1.7.5 or whatever firmware you can access. as far as I know, their delay+ wait for ACK always have all sorts of issues. Maybe adding more delay in the wait for serial ack will help you(solution from other github dji_osdk post)", "In case of this particular A3 burned, swap another fresh open A3 and proven working FTDI cable(test with Arduino) to rule out the A3 problem", "If still no luck, file a ticket to dev@dji.com + send a complaint to Samuel@DJI. Send them the long list of thing you tested, and if they say high chance it is a hardware issue. Do send it back for RMA. I do have experience of one Normal A3 and one M600 A3 has burned FCU board issue before.", "After this, if you encounter can not fly GPS mission by OSDK or can not do local flight control. Just try different firmware version. DJI firmware release is usually very buggy for developer. ", "For you case, use windows. as i have no issue with windows based method\nMake sure the slider to the right with my image view. I have no MAC so cant test MAC solution. ", "YOu might need to plug in and un plug and plug in for couple time", "by default api is disabled. so you have to enable it and select the hz rate for topic you wish to receive. Good Luck. This is all I can do. "], "question_code": ["roslaunch dji_sdk sdk.launch\n", "... logging to /home/dji/.ros/log/b31d5e94-fec0-11e9-9835-74da38ebc18f/roslaunch-manifold2-18825.log\nChecking log directory for disk usage. This may take awhile.\nPress Ctrl-C to interrupt\nDone checking log file disk usage. Usage is <1GB.\n\nstarted roslaunch server http://manifold2:41911/\n\nSUMMARY\n\nPARAMETERS\n\n/dji_sdk/align_time: False\n/dji_sdk/app_id: 1079440\n/dji_sdk/app_version: 1\n/dji_sdk/baud_rate: 921600\n/dji_sdk/enc_key: 39d353a8e9ad01b6c...\n/dji_sdk/serial_name: /dev/ttyUSB0\n/dji_sdk/use_broadcast: False\n/rosdistro: kinetic\n/rosversion: 1.12.13\nNODES\n/\ndji_sdk (dji_sdk/dji_sdk_node)\n\nauto-starting new master\nprocess[master]: started with pid [18835]\nROS_MASTER_URI=http://localhost:11311\n\nsetting /run_id to b31d5e94-fec0-11e9-9835-74da38ebc18f\nprocess[rosout-1]: started with pid [18848]\nstarted core service [/rosout]\nprocess[dji_sdk-2]: started with pid [18856]\n\nSTATUS/1 @ init, L56: Attempting to open device /dev/ttyUSB0 with baudrate 921600...\n\nSTATUS/1 @ init, L66: ...Serial started successfully.\n\nERRORLOG/1 @ getDroneVersion, L1503: Drone version not obtained! Please do not proceed.\nPossible reasons:\nSerial port connection:\n\nSDK is not enabled, please check DJI Assistant2 -> SDK -> [v] Enable API Control.\nBaudrate is not correct, please double-check from DJI Assistant2 -> SDK -> baudrate.\nTX and RX pins are inverted.\nSerial port is occupied by another program.\nPermission required. Please do 'sudo usermod -a -G dialout $USER' (you do not need to replace $USER with your username). Then logout and login again\nERRORLOG/1 @ activate, L1387: Unable to initialize some vehicle components![ERROR] [1572843926.785053218]: drone activation error\n[ERROR] [1572843926.785190956]: Vehicle initialization failed\n^C[dji_sdk-2] killing on exit\n[rosout-1] killing on exit\n[master] killing on exit\nshutting down processing monitor...\n... shutting down processing monitor complete\ndone\n", "source devel/setup.bash\ncatkin_make\nrosed dji_sdk sdk.launch\n", "roslaunch dji_sdk sdk.launch\n", "usermod -a -G dialout $USER\n", "sudo chmod 666 /dev/ttyUSB0\n"], "url": "https://stackoverflow.com/questions/58688023/roslaunch-activation-failure-what-should-i-do"}
,{"title": "Increase the precision of the values returned by the heart beat sensor on a Tizen device", "time": "2017-02-09 12:22:34Z", "post_content": ["what i want to achieve, is try to increase the precison of the values returned by the heart beat sensor of a Tizen smartwatch.\nThe values are Float64 numbers, since the language is Javascript.\nI tried to use a function like this:", "but with no success. Maybe i'm doing something wrong, like doing some programming mistakes, i really don't know. Apparently, the IDE compile and build the package to install with no problem, but i can't see something different with or without this function included.\nI will post my entire code below. Please check when is created the function ", " . I've used the escamotage ", " because i don't want the zeros to be printed. Please note that i want the variable streamed to the ROS topic HeartRateInterval to remain a Float; this is why i've also used the parseFloat function.\nThank you!\nCode :"], "answer": ["Am I missing something here, but I can not find where you actually call that new function?\nAnd why do you create it inline inside the onchangedCB function?", "It looks as if you expected that function to be called because you declare it there and call the parameter the same as the interval variable. Which will not work (as far as I know in any programming language).", "Then what I would try is call that function parseFloat(interval).toPrecision\ndirectly instead of putting it in another function.", "But what I'm far more interested in is:\nhere hrmInfo.rRInterval/1000\nthe orginal value is devived by a thousand.", "Remove that division (like this var interval = hrmInfo.rRInterval;) and see if there actually are more numbers where the decimal point would be.", "I can not make it up from your example, but if the value normally is something like 120 per minute. And you want to know if there are more precise values behind that, then the value should now look something like 1200054 if it is all zeroes like 120000 all the time, then the systems creating that event does not give off a more precise measure."], "question_code": ["function strip(interval) {\nreturn (parseFloat(interval).toPrecision(4));\n}\n", "strip", "if (interval !== 0) {\n   interval_screen = interval;\n   }", "document.addEventListener('tizenhwkey', function(e) {\n    if(e.keyName === \"back\")\n        window.webapis.motion.stop(\"HRM\");\n        tizen.application.getCurrentApplication().exit();\n});\n\nfunction Connect(){\n\nvar ip;\nvar connection=false;\nvar interval_screen = 0;\nif (document.getElementById(\"ip\").value===\"\")\n{ \n    ip=\"10.42.0.1\";\n}\nelse \n{ \n    ip=document.getElementById(\"ip\").value;\n}\n\nvar ros = new ROSLIB.Ros({\n    url : 'ws://' + ip +':9090'\n    });\n\nros.on('connection', function() {\n    connection=true;\n    document.getElementById(\"Connection_status\").setAttribute(\"color\",\"green\");\n    document.getElementById(\"Connection_status\").innerHTML = 'Connected';\n    tizen.power.request(\"SCREEN\", \"SCREEN_DIM\");\n});\n\nros.on('error', function(error) {\n    document.getElementById(\"Connection_status\").setAttribute(\"color\",\"orange\");\n    document.getElementById(\"Connection_status\").innerHTML = 'Error';\n});\n\nros.on('close', function() {\n    document.getElementById(\"Connection_status\").setAttribute(\"color\",\"red\");\n    document.getElementById(\"Connection_status\").innerHTML = 'Unconnected';\n    connection=false;\n    tizen.power.release(\"SCREEN\");\n});\n\n    var RatePub = new ROSLIB.Topic({\n    ros : ros,\n    name : '/HeartRateData',\n    messageType : 'std_msgs/Float64'\n});\n\nvar IntervalPub = new ROSLIB.Topic({\n    ros : ros,\n    name : '/HeartRateInterval',\n    messageType : 'std_msgs/Float64'\n});\n\nwindow.webapis.motion.start(\"HRM\", onchangedCB);\n\nfunction onchangedCB(hrmInfo)\n{\n   var rate = hrmInfo.heartRate;\n   document.getElementById(\"mytext\").innerHTML = 'Heart Rate= ' + rate + ' bpm';\n\n   var interval = hrmInfo.rRInterval/1000;\n   function strip(interval) {\n   return (parseFloat(interval).toPrecision(4));\n   }\n   if (interval !== 0) {\n   interval_screen = interval;\n   }\n   document.getElementById(\"mytext1\").innerHTML = 'RR Interval= ' + interval_screen + ' s';\n\n   var Float64 = new ROSLIB.Message({\n            data:rate\n        });\n\n        if(connection===true)\n            {\n            RatePub.publish(Float64);\n            }\n        else\n        {\n            document.getElementById(\"mytext\").innerHTML = 'Heart Rate = 0 bpm';\n        }\n\n   var Float64 = new ROSLIB.Message({\n            data:interval\n        });\n\n        if(connection===true)\n            { if (interval !== 0) {\n            IntervalPub.publish(Float64);\n            }\n            else {\n\n            }\n            }\n        else\n        {\n            document.getElementById(\"mytext1\").innerHTML = 'RR Interval = 0 s';\n        }\n\n        }}\n", "interval.toPrecision(4);", "var interval = hrmInfo.rRInterval/1000;", "parseFloat(interval).toPrecision(4);"], "url": "https://stackoverflow.com/questions/42136618/increase-the-precision-of-the-values-returned-by-the-heart-beat-sensor-on-a-tize"}
,{"title": "Using rosserial to communicate with MX-64 DYNAMIXEL motor", "time": "2018-08-03 05:17:02Z", "post_content": ["When I try to use rosserial to communicate with an Arduino to control the MX-64 motor, every time I use rostopic pub to send a message, it will give me this error:", "\"Mismatched protocol version in packet: lost sync or rosserial_python is from different ros release than the rosserial client \"", "If I remove the ", " function in the code or don't send any information though ROS, there will be no error. I tried all the rosserial examples, all of them are working just fine without any error.", "The weird thing is even if it gives me an error, the program is still working. Every time I send a message, the DYNAMIXEL motor will start moving."], "answer": ["It looks like your Dynamixel servo is hooked up to the same serial port that you use to communicate with the rosserial server. In many Arduino boards like the Uno the hardware serial port (where your Dynamixel is hooked up) is connected to a USB serial converter (which connects ROS via USB).", "You need to connect your Dynamixel to a different hardware (or ", ") serial on your Arduino and initialize it with ", " (", "), where ", " is that hardware / software serial."], "quote": ["\"Mismatched protocol version in packet: lost sync or rosserial_python is from different ros release than the rosserial client \""], "question_code": ["Dynamixel.move(X_SERVO_ID,rollint);", "#if (ARDUINO >= 100)\n #include <Arduino.h>\n#else\n #include <WProgram.h>\n#endif\n\n#include <ros.h>\n#include <std_msgs/Int8.h>\n\n\nros::NodeHandle  nh;\n\n#include <Dynamixel_Serial.h>       // Library needed to control Dynamixal servo\n#include <sensor_msgs/Imu.h>\n\n#define X_SERVO_ID 0x01 // ID which we will be set in Dynamixel too \n\nint rollint = 0;\n\nvoid motor_cb(const std_msgs::Int8& cmd_msg) {\n  rollint = ((1.00*(90-cmd_msg.data))/360)*4095;\n  Dynamixel.move(X_SERVO_ID,rollint); \n}\n\nros::Subscriber<std_msgs::Int8> sub(\"MX_Motor\", motor_cb);\n\nvoid setup() {\n  delay(100); // Give time for Dynamixel to start on power-up\n  nh.initNode();\n  nh.subscribe(sub);\n\n}\n\nvoid loop(){\n  nh.spinOnce();\n  delay(1);\n}\n"], "answer_code": ["Dynamixel.begin(Stream&)", "Stream&"], "url": "https://stackoverflow.com/questions/51644717/using-rosserial-to-communicate-with-mx-64-dynamixel-motor"}
,{"title": "I'm trying to publish a message of a Tizen based app on ros using rosbridge and i get an error", "time": "2016-10-12 09:01:52Z", "post_content": ["as the title says, I'm trying to publish a message on ros using rosbridge, because my app is written in javascript. Basically i want to cast a stream of heart rate data on a pc running ros to so some elaboration. The app is running on a Tizen based smartwatch. If i try to publish geometry messages, like the device orientation, i have no problem and they are published on ros. I tried the sensor message type (channelfloat32 in particular) to cast the stream of the heart rate with no success. I investigated on the type of the data coming out from the sensor and i discovered that is a number type data of javascript.\nSo i used the standard message type (Float64 in particular because, as far as i know based on some searching, apparently javascript uses only this type for numbers) with no success again.\nMaybe i could cast the variable or change its type, but i don't know if this could be a possible solution and i really don't know how to do it, maybe i only have to change the type of the ros message.\nAs you can see from my previous questions I'm very new to coding and I'm again on the same project.", "Thank you in advance for your help!", "Marco", "The code is below:", "function Connect(){"], "answer": ["If you are reading HRM data from Tizen wearable device you may use ", " of Human Activity Monitor API Instead of using ", "Rather using ", "You may try ", "And add the necessary privileges in config.xml file", "According to the ", " datatype of the heartRate is long.", "Please Check the ", " and ", " for details implementation."], "question_code": ["document.addEventListener('tizenhwkey', function(e) {\n    if(e.keyName === \"back\")\n        window.webapis.motion.stop(\"HRM\");\n        tizen.application.getCurrentApplication().exit();\n});\n", "var ip;\nvar connection=false;\n\nif (document.getElementById(\"ip\").value===\"\")\n{ \n    ip=\"10.42.0.1\";\n}\nelse \n{ \n    ip=document.getElementById(\"ip\").value;\n}\n\nvar ros = new ROSLIB.Ros({\n    url : 'ws://' + ip +':9090'\n    });\n\nros.on('connection', function() {\n    connection=true;\n    document.getElementById(\"Connection_status\").setAttribute(\"color\",\"green\");\n    document.getElementById(\"Connection_status\").innerHTML = 'Connected';\n    tizen.power.request(\"SCREEN\", \"SCREEN_DIM\");\n});\n\nros.on('error', function(error) {\n    document.getElementById(\"Connection_status\").setAttribute(\"color\",\"orange\");\n    document.getElementById(\"Connection_status\").innerHTML = 'Error';\n});\n\nros.on('close', function() {\n    document.getElementById(\"Connection_status\").setAttribute(\"color\",\"red\");\n    document.getElementById(\"Connection_status\").innerHTML = 'Unconnected';\n    connection=false;\n    tizen.power.release(\"SCREEN\");\n});\n\nvar RatePub = new ROSLIB.Topic({\n    ros : ros,\n    name : '/HeartRateData',\n    messageType : 'std_msgs/Float64'\n});\n\nwindow.webapis.motion.start(\"HRM\", onchangedCB);\n\nfunction onchangedCB(hrmInfo)\n{\n   var data = hrmInfo.heartRate;\n   document.getElementById(\"mytext\").innerHTML = 'Heart Rate= ' + data + ' bpm';\n\n\n   var Float64 = new ROSLIB.Message({\n            data:[data]\n        });\n\n        if(connection===true)\n            {\n            RatePub.publish(Float64);\n            }\n        else\n        {\n            document.getElementById(\"mytext\").innerHTML = 'Heart Rate= 0 bpm';\n        }\n\n        }}\n"], "answer_code": ["window.webapis.motion.start(\"HRM\", onchangedCB);\n\nfunction onchangedCB(hrmInfo) {\n    var data = hrmInfo.heartRate;\n    document.getElementById(\"mytext\").innerHTML = 'Heart Rate= ' + data + ' bpm';\n    ...\n    ..\n   }\n", "var dataCount = 0;\n\nfunction onsuccessCB(hrmInfo)\n{\n   console.log(\"Heart Rate: \" + hrmInfo.heartRate);\n   console.log(\"Peak-to-peak interval: \" + hrmInfo.rRInterval + \" milliseconds\");\n   dataCount++;\n\n   ...\n   ..\n\n   if (dataCount > 10){\n       /* Stop the sensor after detecting a few changes */\n       tizen.humanactivitymonitor.stop(\"HRM\");\n   }\n}\n\ntizen.humanactivitymonitor.start(\"HRM\", onsuccessCB);\n", "<tizen:privilege name=\"http://tizen.org/privilege/healthinfo\"/>\n<tizen:privilege name=\"http://tizen.org/privilege/power\"/>\n"], "url": "https://stackoverflow.com/questions/39994564/im-trying-to-publish-a-message-of-a-tizen-based-app-on-ros-using-rosbridge-and"}
,{"title": "Android: NullPointerException 'double java.lang.Double.doubleValue()'", "time": "2019-10-04 07:25:11Z", "post_content": ["I'm new to android programming and I'm having a problem with my codes. Can anyone help me or point out the cause of my error because I'm not really sure why it's giving me a NullPointerException when its a text view or if that is possible.", "LogCat:", "Here is the code for that line:", "But when i run my app my voltage is setting null and here is the code for the voltage:", "Here is the full code:"], "answer": ["Check weather your created class with ", " is not null", "and then check class fields values  is not null or 0.", "You can check null before you set text on textview like the following.", "Everytime when you are setting the text to textview, you must need to check if it is not null."], "question_code": ["    java.lang.NullPointerException: Attempt to invoke virtual method 'double java.lang.Double.doubleValue()' on a null object reference\n    at com.example.app.rosbridge.MainActivity$2$1.run(MainActivity.java:133)\n", "   current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n", "   voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n", "public class MainActivity extends Activity {\n\n\nprivate TextView voltage, current, percentage, status;\nprivate SubscribedData<BatteryState> batteryStateData;\nprivate RosbridgeListener rosbridge;\nprivate boolean subscribed = false;\nprivate boolean advertised = false;\n\n/** Indicates that Lint should ignore the specified warnings for the annotated element. */\n@SuppressLint(\"ClickableViewAccessibility\")\n@Override\n\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main_activity);\n\n    Button settings_btn = (Button) findViewById(R.id.connect_btn);\n\n    voltage = findViewById(R.id.voltage_txt);\n    current = findViewById(R.id.current_txt);\n    percentage = findViewById(R.id.percentage_txt);\n    status = findViewById(R.id.status_txt);\n    connectButton = findViewById(R.id.connect_btn);\n\n    batteryStateData = new SubscribedData<>();\n    final Type batteryStateType = new TypeToken<SubscribedData<BatteryState>>() {\n    }.getType();\n\n\n    // ROSBRIDGE protocol allows access to underlying ROS messages and services as serialized JavaScript Object Notation (JSON) objects\n     WebSocket protocol communicates to a server for the connection from a user's web browser\n\n    //A connection to the rosbridge thru the IP address of the robot from the socket\n    rosbridge = new RosbridgeListener(\"ws://10.24.204.231:9090\");\n    rosbridge.setOnDataReceivedListener(new RosbridgeMessageListener() {\n\n        // a running thread that when the connection is made the data of the topic will serialize and deserialized java objects to (and from) JSON. @param msg\n\n            @Override\n            public void onDataReceived(final String msg) {\n                try {\n                    runOnUiThread(new Runnable() {\n                        @Override\n                        public void run() {\n                            batteryStateData = new Gson().fromJson(msg, batteryStateType);\n                            voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n                            current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n                            percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n                            status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n                        }\n                    });\n\n                    Log.d(\"B9T\", String.format(\"Received data: %s\", msg));\n                }\n                catch (Exception e)\n                {\n                    e.printStackTrace();\n                }\n            }\n        });\n\n    connectButton.setOnClickListener(new View.OnClickListener() {\n        @Override\n        public void onClick(View view) {\n\n            if (!subscribed) {\n                 rosbridge.Subscribe(\"/battery\", \"sensor_msgs/BatteryState\");\n                 subscribed = true;\n\n            connectButton.setText(\"Disconnect\");\n\n              } else {\n\n                rosbridge.UnSubscribe(\"/battery\");\n                subscribed = false;\n            connectButton.setText(\"Connect\");\n\n      }\n          }\n    });\n", "batteryStateData.msg.current "], "answer_code": ["batteryStateData = new Gson().fromJson(msg, batteryStateType);\nif (batteryStateData != null) {\n\n    if (batteryStateData.msg.voltage!=0)\n        voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n\n    if (batteryStateData.msg.current!=0)\n        current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n\n    if (batteryStateData.msg.percentage!=0)\n        percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n\n    if (batteryStateData.msg.values !=null)\n        status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n\n}\n", " @Override\n public void run() {\n     batteryStateData = new Gson().fromJson(msg, batteryStateType);\n\n     // check null before set text or calculate something\n     if(batteryStateData.msg.current != null){\n         current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n     }\n     // you can check belows like above\n\n     voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n\n     percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n     status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n}\n"], "url": "https://stackoverflow.com/questions/58230939/android-nullpointerexception-double-java-lang-double-doublevalue"}
,{"title": "How to know/set the frequency at which the images are taken (grabbed)?", "time": "2016-07-21 03:48:12Z", "post_content": ["I already posted this question on ros forum, but I would like to post it here again in order to cover a larger audience.", "The issue is that I find that the frequency, I compute from the time between two successive callbacks and that from using rostopic hz, is totally different...", "With ", " I get:", "However, from this very short code, that computes the frequency at which the callback of the same topic is called,", "I get this inconsistent result", "Why this difference of values? ", "Also, if I run this same code, but only adding ", ", from another host machine,  I get even a quite different value. To be more clear, assume that am using ", " machine, whereas my ros node is implemented and compiled on ", " machine. Am doing this from ", ":", "Perhaps that ", " is consuming a lot of the bandwidth.... yet the code should be running on ", " machine not on ", " machine, thus the computational time should have been the same.", "For info, am using a Point Grey camera, Chameleon 3. As for the driver, am using ROS flea3 node, from  Kumar robotics driver ", ". Am running this on ubuntu 16, 4.6.4-040604-lowlatency kernel."], "answer": ["Well, I think that your estimation of the callback calls time is not exactly what ", " is doing. In order to have a closer one, try just computing the delay between callback calls without any further processing. This will avoid the extra calculation time. ", "Also, set the callback queue size for a higher value, thus avoiding  dropping images due to the little queue size.", "Also, I think it would be helpful if you mention the camera type and driver that you are using under ROS.", "Hope that helps !"], "question_code": ["rostopic hz /pg_15508342/image_raw", "average rate: 99.681\n    min: 0.003s max: 0.017s std dev: 0.00093s window: 797\naverage rate: 99.683\n    min: 0.003s max: 0.017s std dev: 0.00098s window: 896\naverage rate: 99.682\n    min: 0.003s max: 0.017s std dev: 0.00100s window: 997\naverage rate: 99.682\n    min: 0.003s max: 0.017s std dev: 0.00098s window: 1097\naverage rate: 99.684\n    min: 0.002s max: 0.018s std dev: 0.00102s window: 1196\naverage rate: 99.681\n    min: 0.002s max: 0.018s std dev: 0.00106s window: 1296\naverage rate: 99.676\n", "#include <ros/ros.h>\n#include <image_transport/image_transport.h>\n#include <cv_bridge/cv_bridge.h>\n#include <sensor_msgs/image_encodings.h>\n#include <opencv2/imgproc/imgproc.hpp>\n#include <opencv2/highgui/highgui.hpp>\n\n#include <time.h>\n#include <boost/timer.hpp>\n#include <boost/thread.hpp>\n#include <boost/thread/thread.hpp>\n#include <boost/version.hpp>\n#include  \"boost/bind.hpp\"\n#include  \"boost/bind.hpp\"\n#include <iostream>\n\nusing namespace std;\n\nboost::posix_time::ptime time1; \nboost::posix_time::time_duration timeloop;\ndouble timeloop_sc;\n\nint image_itr(0);\n\nvoid imageCallback(const sensor_msgs::ImageConstPtr& msg)\n{\n     //---\n      if(image_itr == 0)\n        time1 = boost::posix_time::microsec_clock::local_time();\n\n      timeloop =  boost::posix_time::microsec_clock::local_time() - time1;\n  time1 = boost::posix_time::microsec_clock::local_time();\n  timeloop_sc = 1e-3* (double)timeloop.total_milliseconds();\n  cout << \"itr \" << image_itr++ << \"   fps: \" << 1.0/timeloop_sc << endl;\n\n}\n\nint main(int argc, char **argv)\n{\n  ros::init(argc, argv, \"image_listener\");\n  ros::NodeHandle nh;\n\n  cv::namedWindow(\"view\");\n  cv::startWindowThread();\n  image_transport::ImageTransport it(nh);\n  image_transport::Subscriber sub = it.subscribe(\"/pg_15508342/image_raw\", 1, imageCallback);\n  ros::spin();\n  cv::destroyWindow(\"view\");\n}\n", "itr 2198   fps: 100\nitr 2199   fps: 111.111\nitr 2200   fps: 90.9091\nitr 2201   fps: 111.111\nitr 2202   fps: 111.111\nitr 2203   fps: 111.111\nitr 2204   fps: 100\nitr 2205   fps: 111.111\nitr 2206   fps: 100\nitr 2207   fps: 100\nitr 2208   fps: 90.9091\nitr 2209   fps: 125\nitr 2210   fps: 100.\n", "cv::imshowfrom", "local", "onboard", "local", "ssh onboard@ip\nrosrun package node\n", "cv::imshowfrom", "onboard", "local"], "answer_code": ["rostopic hz", "void imageCallback(const sensor_msgs::ImageConstPtr& msg)\n{\n if(image_itr == 0)\n        time1 = boost::posix_time::microsec_clock::local_time();\n\n  timeloop =  boost::posix_time::microsec_clock::local_time() - time1;\n  time1 = boost::posix_time::microsec_clock::local_time();\n  timeloop_sc = 1e-3* (double)timeloop.total_milliseconds();\n  cout << \"itr \" << image_itr++ << \"   fps: \" << 1.0/timeloop_sc << endl;\n}\n", "image_transport::Subscriber sub = it.subscribe(\"/pg_15508342/image_raw\", 1000, imageCallback);\n", "waitKey(30)"], "url": "https://stackoverflow.com/questions/38474873/how-to-know-set-the-frequency-at-which-the-images-are-taken-grabbed"}
,{"title": "Using roscpp in existing app on Android/iOS", "time": "2019-11-21 18:39:11Z", "post_content": ["I have an existing app, or rather a shared library, that I compile for mobile platforms (currently Android, but iOS will come very soon too). It is a C++ library that have heavy dependencies (\u201cheavy\u201d in terms of cross-compiling and amount of code).\nNow, I need to publish (and consume) some ROS topics. I was looking at ", " and it seems to me that I should use roscpp for my project.\nHowever, after following through all the ", " I\u2019m still confused on how I would incorporate roscpp into my existing code.\nI would expect to have a set of .so or .a libraries compiled for the target platform (btw, I use arm64 while docker container compiles for arm7) and a headers folder to include in my source code.\nMy question is \u2013 how can I use roscpp in my existing C++ android library? I am not using Android studio, I use ndk-build directly.\nI noticed there\u2019re Application.mk and Android.mk files in \u201croscpp_android_ndk\u201d folder, is that shall be used ultimately?"], "answer": [], "url": "https://stackoverflow.com/questions/58981665/using-roscpp-in-existing-app-on-android-ios"}
,{"title": "How to make jpeg encoding uses libjpeg-turbo or libjpeg-turbo8 library? Ubuntu", "time": "2019-11-26 16:24:48Z", "post_content": ["I am working on ROS.", "Some time ago, I remember /compressedimage topic was consuming 700KB/s bandwidth for 640*480 image @ 30 fps at 80% quality.", "After that, I think I started learning gstreamer and I re-install libjpeg-dev or libjpeg-turbo8 or something I did.", "Now when I resume working on /compressedimage topic, I am realizing that it is consuming 1.2MB/s bandwidth for same 640*480 @ 30fps at 80% quality.", "I am wishing to have lowest bandwidth possible for 80% jpeg quality.", "Thank you"], "answer": [], "url": "https://stackoverflow.com/questions/59055317/how-to-make-jpeg-encoding-uses-libjpeg-turbo-or-libjpeg-turbo8-library-ubuntu"}
,{"title": "Converting Protobuf to ROS messages with similar functionality", "time": "2017-11-01 16:09:19Z", "post_content": ["I recently inherited a large codebase at work utilizing MOOS & Protobuf messages.", "At the request of my project lead, I am porting it to use exclusively ROS where ROS messages are used instead of protobuf. The code base heavily relies on utilizing protobuf functionality such as enumerator min / max, extracting a string from the variable field, ->has_variable() function, ->isValid(), etc.", "So far I have only been able to find very basic ROS message functionality from the wiki.", "Example: Protbufs support enumerators, but ROS messages don't, so I have:", "My ", " is my 'enumerator' but I don't have a min or max unless I hardcode one, and I can't extract ", " as a string.  I've been slowly finding workarounds for this by using ", "But I'm having to modify many different areas that use it as a string, not integer."], "answer": ["Yes there is a hack. But you need to input a some work into it. \nFor using the publisher/subscriber methods in ROS you need to define messages for all topics in ", " files. ", "From this file then a C++ class is automatically generated. But you don't want to touch that autogenerated file! What you could do instead is define your class and associate it with the autogenerated class. ", "Look ", " for an example how to do it. You could then expand your custom class with desired methods like ", ". ", "Another (perhaps simpler) way would be to declare a helper class that would do the desired work for each type in messages.", "Or you could simply continue to use protobuf. It is also used at least in Gazebo if not also in ROS. ", "Sometime ago I wrote some auto generation scripts that consume Protobufs and produce ROS headers (", " the msg files) to transmit Protobuf blobs over ROS comms. This would satisfy your need without having to duplicate a Protobuf definition with a supporting ROS msg definition. ", "."], "question_code": ["  uint8 TYPE_FAILED        = 0\n  uint8 TYPE_OPERATIONAL   = 1\n  uint8 TYPE_INITIALIZING  = 2\n\n  uint8 health_state_type\n", "health_state_type", "TYPE_FAILED", "my_message::custom_msg health;\nhealth.health_state_type = health.TYPE_FAILED\n"], "url": "https://stackoverflow.com/questions/47059079/converting-protobuf-to-ros-messages-with-similar-functionality"}
,{"title": "Recoding (real-time) large-size images on a usb stick with [ROS bag]", "time": "2017-02-10 11:02:44Z", "post_content": ["The quality of the record images is a key importance. Thus am not sure if ", " is relevant to this case, since it is reported that the compressed mode is lossy...", "There should a manner that even when the rostopic stops, the copying on the usb continues. Like this, one will not have frame drops.", "Any advice/solution?", "Note that the image streaming needs to be at a decent frequency."], "answer": ["From your question I assume that your images are too large / arrive too frequently to be able to be written in real-time on your USB stick.", "Depending on your setup/requirements, consider writing the bag to hard disk and copy it over to USB later.", "If you need to write directly to your USB stick, obviously the only solution is to reduce the amount of data to be written. Do not rule out ", " for that. By default it compresses data as JPEG (lossy), but you can switch it to PNG (lossless). Simply start your software and run ", ". For the image transport you should see an entry where you can switch from JPEG to PNG (", "). You should be able to set this value (namespace.format = \"png\") in your launch file, too (", ").", "You could also reduce the image resolution or framerate, if that is acceptable. In combination with PNG compression, this would be your best bet.", "If you don't want to compress as lossless PNG, another (less efficient) option is to have rosbag store compressed data (", " will not consume much CPU, but will not yield the best compression results; ", " will save more space but may impact your real-time requirements depending on your CPU and load)"], "question_code": ["rosbag record /camera/image_raw/compressed"], "answer_code": ["/camera/image_raw/compressed", "rosrun rqt_reconfigure rqt_reconfigure", "--lz4", "--bz2"], "url": "https://stackoverflow.com/questions/42157782/recoding-real-time-large-size-images-on-a-usb-stick-with-ros-bag"}
,{"title": "How to solve: QPixmap: It is not safe to use pixmaps outside the GUI thread", "time": "2018-05-09 21:29:24Z", "post_content": ["I'm trying to display a sequence of images coming at 30 image per second in ", " but I'm getting that error of GUI thread. I did little bit research and I read that it is recommended using ", " instead but I'm not sure how to do it in my case.\nHere's a shot of my classes and the method I'm using to get the frames:", "Do you have any idea how to solve this?"], "answer": ["The callback is invoked from an arbitrary thread. Thus the other method calls must be made thread-safe. A simple way to do it is to emit a signal with the image. See ", " for other approaches.", "But you're also copying the image data unnecessarily. The callback has full control over image lifetime - the ", " is a shared pointer, after all. Thus - pass the ", " all the way to the target thread, then the ", " becomes a thin wrapper over the ", " class, and doesn't copy its data unless a BGR-TO-RGB format conversion is necessary.", "There's no need for ", " at all -- you're not using OpenCV, after all.", "Let's start with a minimal reimplementation of ROS that will allow us to try things out on a desktop platform without installing ROS :)", "The callbacks are invoked from a worker thread, as would happen in ROS.", "For demonstration purposes, we can make the main window a ", ". We need to pass the ", " to the main thread, where it will be wrapped in a ", " and set on the label. The signal itself can be the callback. Thus:", "First, we need a way to wrap the ", " in a ", ". The ", " does not copy the data from the ", " unless a format conversion is necessary. The image must be consumed while the ", " is kept alive. The ", " is an idiom for modifying the image in-place. Modern Qt supports this optimization.", "The implementation of the ", " and the rest of the demo harness is then quite straightforward:", "This concludes the example."], "question_code": ["qt label", "QImage", "class MainWindow : public QMainWindow {\nQ_OBJECT\n\npublic:\n    MainWindow(int argc, char** argv, QWidget *parent = 0);\n    ~MainWindow();\n\npublic Q_SLOTS:\n    void callBackColor(const sensor_msgs::ImageConstPtr& msg);\n\nprivate:\n    Ui::MainWindowDesign ui;\n    ros::Subscriber sub;\n};\n", "MainWindow::MainWindow(int argc, char** argv, QWidget *parent)\n    : QMainWindow(parent)\n{\n    ui.setupUi(this);\n\n    ros::init(argc,argv,\"MainWindow\");\n    ros::NodeHandle n;\n    sub = n.subscribe(\"/usb_cam/image_raw\", 1, &MainWindow::callBackColor, this);\n}\n\nvoid MainWindow::callBackColor(const sensor_msgs::ImageConstPtr& msg)\n{\n\n  cv_bridge::CvImagePtr cv_ptr;\n\n  try\n  {\n    cv_ptr = cv_bridge::toCvCopy(msg, sensor_msgs::image_encodings::BGR8);\n  }\n\n  catch (cv_bridge::Exception& e)\n  {\n    ROS_ERROR(\"cv_bridge exception: %s\", e.what());\n    return;\n  }\n  //Here I got the image and I want to display it in a label\n  QImage temp(&(msg->data[0]), msg->width, msg->height, \n  QImage::Format_RGB888);\n  static QLabel *imageLabel = new QLabel;\n  QPixmap pix = QPixmap::fromImage(temp);\n  ui.imageLabel->setPixmap(pix);\n}\n", "cv_bridge", "msg", "QImage", "opencv"], "answer_code": ["sensor_msgs::ImageConstPtr", "ImageConstPtr", "QImage", "Image", "cvBridge", "// https://github.com/KubaO/stackoverflown/tree/master/questions/qimage-ros-50262348\n#include <QtWidgets>\n#include <memory>\n#include <string>\n#include <vector>\n\n// Minimal reimplementation of ROS\n\n#define ROS_ERROR qFatal\nnamespace sensor_msgs {\nnamespace image_encodings {\nconst std::string MONO8{\"mono8\"}, BGR8{\"bgr8\"}, BGRA8{\"bgra8\"}, RGB8{\"rgb8\"}, RGBA8{\"rgba8\"};\n} // image_encodings\nstruct Image {\n   std::vector<quint8> data;\n   std::string encoding;\n   uint32_t height;\n   uint32_t width;\n};\nusing ImagePtr = std::shared_ptr<Image>;\nusing ImageConstPtr = std::shared_ptr<const Image>;\n} // sensor_msgs\n\nnamespace ros {\nstruct Subscriber {};\nstruct NodeHandle {\n   template<class M, class T>\n   Subscriber subscribe(const std::string &, uint32_t, void(T::*fun)(M), T *obj) {\n      struct Thread : QThread {\n         Thread(QObject*p):QThread(p){} ~Thread() override { quit(); wait(); } };\n      static QPointer<Thread> thread = new Thread(qApp);\n      thread->start(); // no-op if already started\n      auto *timer = new QTimer;\n      timer->start(1000/60);\n      timer->moveToThread(thread);\n      QObject::connect(timer, &QTimer::timeout, [obj, fun]{\n         auto const msec = QTime::currentTime().msecsSinceStartOfDay();\n         QImage img{256, 256, QImage::Format_ARGB32_Premultiplied};\n         img.fill(Qt::white);\n         QPainter p{&img};\n         constexpr int period = 3000;\n         p.scale(img.width()/2.0, img.height()/2.0);\n         p.translate(1.0, 1.0);\n         p.rotate((msec % period) * 360.0/period);\n         p.setPen({Qt::darkBlue, 0.1});\n         p.drawLine(QLineF{{-1., 0.}, {1., 0.}});\n         p.end();\n         img = std::move(img).convertToFormat(QImage::Format_RGB888).rgbSwapped();\n         sensor_msgs::ImageConstPtr ptr{new sensor_msgs::Image{\n               {img.constBits(), img.constBits() + img.sizeInBytes()},\n               sensor_msgs::image_encodings::BGR8,\n                     (uint32_t)img.height(), (uint32_t)img.width()}};\n         (*obj.*fun)(ptr);\n      });\n      return {};\n   }\n};\nvoid init(int &, char **, const std::string &) {}\n} // ros\n", "QLabel", "ImageConstPtr", "QImage", "// Interface\n\nclass MainWindow : public QLabel {\n   Q_OBJECT\npublic:\n   MainWindow(int argc, char** argv, QWidget *parent = {});\nprotected:\n   Q_SLOT void setImageMsg(const sensor_msgs::ImageConstPtr&);\n   Q_SIGNAL void newImageMsg(const sensor_msgs::ImageConstPtr&);\nprivate:\n   ros::Subscriber sub;\n};\n\nQ_DECLARE_METATYPE(sensor_msgs::ImageConstPtr)\n", "ImageConstPtr", "QImage", "QImage", "msg", "msg", "std::move(image).conversion()", "// Implementation\n\nstatic QImage toImageShare(const sensor_msgs::ImageConstPtr &msg) {\n   using namespace sensor_msgs::image_encodings;\n   QImage::Format format = {};\n   if (msg->encoding == RGB8 || msg->encoding == BGR8)\n      format = QImage::Format_RGB888;\n   else if (msg->encoding == RGBA8 || msg->encoding == BGRA8)\n      format = QImage::Format_RGBA8888_Premultiplied;\n   else if (msg->encoding == MONO8)\n      format = QImage::Format_Grayscale8;\n   else\n      return {};\n   QImage img(msg->data.data(), msg->width, msg->height, format);\n   if (msg->encoding == BGR8 || msg->encoding == BGRA8)\n      img = std::move(img).rgbSwapped();\n   return img;\n}\n", "MainWindow", "MainWindow::MainWindow(int argc, char** argv, QWidget *parent) : QLabel(parent) {\n   qRegisterMetaType<sensor_msgs::ImageConstPtr>();\n#if QT_VERSION >= QT_VERSION_CHECK(5,0,0)\n   connect(this, &MainWindow::newImageMsg, this, &MainWindow::setImageMsg);\n#else\n   connect(this, SIGNAL(newImageMsg(sensor_msgs::ImageConstPtr)), SLOT(setImageMsg(sensor_msgs::ImageConstPtr)));\n#endif\n   ros::init(argc,argv,\"MainWindow\");\n   ros::NodeHandle n;\n   sub = n.subscribe(\"/usb_cam/image_raw\", 1, &MainWindow::newImageMsg, this);\n}\n\nvoid MainWindow::setImageMsg(const sensor_msgs::ImageConstPtr &msg) {\n   auto img = toImageShare(msg);\n   auto pix = QPixmap::fromImage(std::move(img));\n   setPixmap(pix);\n   resize(pix.size());\n}\n\nint main(int argc, char *argv[])\n{\n   QApplication app{argc, argv};\n   MainWindow w{argc, argv};\n   w.show();\n   return app.exec();\n}\n#include \"main.moc\"\n"], "url": "https://stackoverflow.com/questions/50262348/how-to-solve-qpixmap-it-is-not-safe-to-use-pixmaps-outside-the-gui-thread"}
,{"title": "message from ROSbridge server to client", "time": "2017-01-30 13:46:52Z", "post_content": ["Is it possible to send messages from the ROSbridge server to a connected client? I've connected an Android application using tcp, and able to send JSON messages from the app to the server. But is it possible to send messages in the other direction as well? ", "Thanks  "], "answer": ["as ", " you create a websocket by starting rosbridge. You would have to consume that socket. Not sure if rosjava can consume that for your android app"], "url": "https://stackoverflow.com/questions/41937447/message-from-rosbridge-server-to-client"}
,{"title": "What is an undefined reference/unresolved external symbol error and how do I fix it?", "time": "2018-01-21 17:39:45Z", "post_content": ["What are undefined reference/unresolved external symbol errors? What are common causes and how to fix/prevent them?"], "answer": ["Compiling a C++ program takes place in several steps, as specified by ", " ", ":", "The precedence among the syntax rules of translation is specified by the following phases ", ".", " Implementations must behave as if these separate phases occur, although in practice different phases might be folded together.", "The specified errors occur during this last stage of compilation, most commonly referred to as linking. It basically means that you compiled a bunch of implementation files into object files or libraries and now you want to get them to work together.", "Say you defined symbol ", " in ", ". Now, ", " ", " that symbol and used it. Before linking, it simply assumes that that symbol was defined ", ", but it doesn't yet care where. The linking phase is responsible for finding the symbol and correctly linking it to ", " (well, actually to the object or library that uses it).", "If you're using Microsoft Visual Studio, you'll see that projects generate ", " files. These contain a table of exported symbols, and a table of imported symbols. The imported symbols are resolved against the libraries you link against, and the exported symbols are provided for the libraries that use that ", " (if any).", "Similar mechanisms exist for other compilers/ platforms.", "Common error messages are ", ", ", ", ", " for ", " and ", " ", " for ", ".", "The code:", "will generate the following errors with ", ":", "and similar errors with ", ":", "Common causes include:", "Declaring a destructor pure still requires you to define it (unlike a regular function):", "This happens because base class destructors are called when the object is destroyed implicitly, so a definition is required.    ", "This is similar to non-", " methods with no definition, with the added reasoning that \nthe pure declaration generates a dummy vtable and you might get the linker error without using the function:", "For this to work, declare ", " as pure:", "Some members need to be defined even if not used explicitly:", "The following would yield the error:", "The implementation can be inline, in the class definition itself:", "or outside:", "If the implementation is outside the class definition, but in a header, the methods have to be marked as ", " to prevent a multiple definition.", "All used member methods need to be defined if used.", "The definition should be", "An initializer can be provided for a ", " ", " data member of integral or enumeration type within the class definition; however, odr-use of this member will still require a namespace scope definition as described above. C++11 allows initialization inside the class for all ", " data members.", "Commonly, each translation unit will generate an object file that contains the definitions of the symbols defined in that translation unit. \nTo use those symbols, you have to link against those object files.", "Under ", " you would specify all object files that are to be linked together in the command line, or compile the implementation files together.", "The ", " here is just the bare name of the library, without platform-specific additions. So e.g. on Linux library files are usually called ", " but you'd only write ", ". On Windows that same file might be called ", ", but you'd use the same argument. You might have to add the directory where those files can be found using ", ". Make sure to not write a space after ", " or ", ".", "For ", ":  Add the User Header Search Paths -> add the Library Search Path -> drag and drop the actual library reference into the project folder.", "Under ", ", files added to a project automatically have their object files linked together and a ", " file would be generated (in common usage). To use the symbols in a separate project, you'd \nneed to include the ", " files in the project settings. This is done in the Linker section of the project properties, in ", ". (the path to the ", " file should be\nadded in ", ") When using a third-party library that is provided with a ", " file, failure to do so usually results in the error.", "It can also happen that you forget to add the file to the compilation, in which case the object file won't be generated. In ", " you'd add the files to the command line. In ", " adding the file to the project will make it compile it automatically (albeit files can, manually, be individually excluded from the build).", "In Windows programming, the tell-tale sign that you did not link a necessary library is that the name of the unresolved symbol begins with ", ". Look up the name of the function in the documentation, and it should say which library you need to use. For example, MSDN puts the information in a box at the bottom of each function in a section called \"Library\".", "A typical variable declaration is", "As this is only a declaration, a ", " is needed. A corresponding definition would be:", "For example, the following would generate an error:", "Similar remarks apply to functions. Declaring a function without defining it leads to the error:", "Be careful that the function you implement exactly matches the one you declared. For example, you may have mismatched cv-qualifiers:", "Other examples of mismatches include", "The error message from the compiler will often give you the full declaration of the variable or function that was declared but never defined. Compare it closely to the definition you provided. ", "The order in which libraries are linked DOES matter if the libraries depend on each other. In general, if library ", " depends on library ", ", then ", " ", " appear before ", " in the linker flags.", "For example:", "Create the libraries:", "Compile:", "So to repeat again, the order ", " matter!", "I'll try to explain what is an \"undefined reference/unresolved external symbol\".", "note: i use g++ and Linux and all examples is for it ", "For example we have some code", "and", "Make object files", "After the assembler phase we have an object file, which contains any symbols to export. \nLook at the symbols", "I've rejected some lines from output, because they do not matter", "So, we see follow symbols to export.", "src2.cpp exports nothing and we have seen no its symbols", "Link our object files", "and run it", "Linker sees exported symbols and links it. Now we try to uncomment lines in src2.cpp like here", "and rebuild an object file", "OK (no errors), because we only build object file, linking is not done yet.\nTry to link", "It has happened because our local_var_name is static, i.e. it is not visible for other modules. \nNow more deeply. Get the translation phase output", "So, we've seen there is no label for local_var_name, that's why linker hasn't found it. But we are hackers :) and we can fix it. Open src1.s in your text editor and change", "to ", "i.e. you should have like below", "we have changed the visibility of local_var_name and set its value to 456789.\nTry to build an object file from it", "ok, see readelf output (symbols)", "now local_var_name has Bind GLOBAL (was LOCAL)", "link", "and run it", "ok, we hack it :)", "So, as a result - an \"undefined reference/unresolved external symbol error\" happens when the linker cannot find global symbols in the object files.", "The function (or variable) ", " was defined in a C program and you attempt to use it in a C++ program:", "The C++ linker expects names to be mangled, so you have to declare the function as:", "Equivalently, instead of being defined in a C program, the function (or variable) ", " was defined in C++ but with C linkage:", "and you attempt to use it in a C++ program with C++ linkage.", "If an entire library is included in a header file (and was compiled as C code); the include will need to be as follows;", "I was recently able to get rid of an unresolved external error in Visual Studio 2012 just by recompiling the offending file. When I re-built, the error went away. ", "This usually happens when two (or more) libraries have a cyclic dependency. Library A attempts to use symbols in B.lib and library B attempts to use symbols from A.lib. Neither exist to start off with. When you attempt to compile A, the link step will fail because it can't find B.lib. A.lib will be generated, but no dll. You then compile B, which will succeed and generate B.lib. Re-compiling A will now work because B.lib is now found.", "MSVS requires you to specify which symbols to export and import using ", " and ", ".", "This dual functionality is usually obtained through the use of a macro:", "The macro ", " would only be defined in the module that exports the function. That way, the declaration:", "expands to", "and tells the compiler to export the function, as the current module contains its definition. When including the declaration in a different module, it would expand to   ", "and tells the compiler that the definition is in one of the libraries you linked against (also see ", "). ", "You can similary import/export classes:", "This is one of most confusing error messages that every VC++ programmers have seen time and time again. Let\u2019s make things clarity first.", "\nIn short, a symbol is a name. It can be a variable name, a function name, a class name, a typedef name, or anything except those names and signs that belong to C++ language. It is user defined or introduced by a dependency library (another user-defined).", "\nIn VC++, every source file (.cpp,.c,etc.) is considered as a translation unit, the compiler compiles one unit at a time, and generate one object file(.obj) for the current translation unit. (Note that every header file that this source file included will be preprocessed and will be considered as part of this translation unit)Everything within a translation unit is considered as internal, everything else is considered as external. In C++, you may reference an external symbol by using keywords like ", ", ", " and so on.", "\nResolve is a linking-time term. In linking-time, linker attempts to find the external definition for every symbol in object files that cannot find its definition internally. The scope of this searching process including:", "This searching process is called resolve.", "\nIf the linker cannot find the external definition for a symbol that has no definition internally, it reports an Unresolved External Symbol error.", ": Unresolved External Symbol error.\nWe already know that this error is due to the linker failed to find the definition of external symbols, the possible causes can be sorted as:", "For example, if we have a function called foo defined in a.cpp:", "In b.cpp we want to call function foo, so we add", "to declare function foo(), and call it in another function body, say ", ":", "Now when you build this code you will get a LNK2019 error complaining that foo is an unresolved symbol. In this case, we know that foo() has its definition in a.cpp, but different from the one we are calling(different return value). This is the case that definition exists.", "If we want to call some functions in a library, but the import library is not added into the additional dependency list (set from: ", ") of your project setting. Now the linker will report a LNK2019 since the definition does not exist in current searching scope.", "Unspecialized templates must have their definitions visible to all translation units that use them. That means you can't separate the definition of a template\nto an implementation file. If you must separate the implementation, the usual workaround is to have an ", " file which you include at the end of the header that\ndeclares the template. A common situation is:", "To fix this, you must move the definition of ", " to the header file or some place visible to the translation unit that uses it.", "Specialized templates can be implemented in an implementation file and the implementation doesn't have to be visible, but the specialization must be previously declared.", "For further explanation and another possible solution (explicit instantiation) see ", ".", " (especially for ", ").", "You may have missed to choose the right project type with your actual IDE. The IDE may want to bind e.g. Windows Application projects to such entry point function (as specified in the missing reference above), instead of the commonly used ", " signature.", "If your IDE supports ", " you might want to choose this project type, instead of a windows application project.", "Here are ", " and ", " handled in more detail from a ", " problem.", "Also if you're using 3rd party libraries make sure you have the correct 32/64 bit binaries", "Microsoft offers a ", " to reference the correct library at link time;", "In addition to the library path including the directory of the library, this should be the full name of the library.", "I just had this problem trying to link libpng with Visual Studio 2013.  The problem is that the package file only had libraries for Visual Studio 2010 and 2012.", "The correct solution is to hope the developer releases an updated package and then upgrade, but it worked for me by hacking in an extra setting for VS2013, pointing at the VS2012 library files.", "I edited the package (in the ", " folder inside the solution's directory) by finding ", " and inside that file, copying all the ", " sections.  I changed the ", " to ", " in ", " being very careful to leave the filename paths all as ", ".  This simply allowed Visual Studio 2013 to link to the libraries for 2012, and in this case, it worked.", "Suppose you have a big project written in c++ which has a thousand of .cpp files and a thousand of .h files.And let's says the project also depends on ten static libraries. Let's says we are on Windows and we build our project in Visual Studio 20xx. When you press Ctrl + F7 Visual Studio to start compiling the whole solution ( suppose we have just one project in the solution )", "The Second step of compilation is done by Linker.Linker should merge all the object file and build finally the output ( which may be an executable or a library)", "    ", "Compiler Time Error : ", "Linker Time Error", "I recently had this problem, and it turned out ", ". I had to remove a source file from the project and re-add it to overcome the bug.", "Steps to try if you believe it could be a bug in compiler/IDE:", "Most modern linkers include a verbose option that prints out to varying degrees;", "For gcc and clang; you would typically add ", " or ", " to the command line. More details can be found here;", "For MSVC, ", " (in particular ", ") is added to the link command line.", "I had the same issue. Say i have projects MyProject and TestProject. I had effectively linked the lib file for MyProject to the TestProject. However, this lib file was produced as the DLL for the MyProject was built. Also, I did not contain source code for all methods in the MyProject, but only access to the DLL's entry points. ", "To solve the issue, i built the MyProject as a LIB, and linked TestProject to this .lib file (i copy paste the generated .lib file into the TestProject folder). I can then build again MyProject as a DLL. It is compiling since the lib to which TestProject is linked does contain code for all methods in classes in MyProject. ", "Since people seem to be directed to this question when it comes to linker errors I am going to add this here.", "One possible reason for linker errors with GCC 5.2.0 is that a new libstdc++ library ABI is now chosen by default.", "If you get linker errors about undefined references to symbols that involve types in the std::__cxx11 namespace or the tag [abi:cxx11] then it probably indicates that you are trying to link together object files that were compiled with different values for the _GLIBCXX_USE_CXX11_ABI macro. This commonly happens when linking to a third-party library that was compiled with an older version of GCC. If the third-party library cannot be rebuilt with the new ABI then you will need to recompile your code with the old ABI.", "So if you suddenly get linker errors when switching to a GCC after 5.1.0 this would be a thing to check out.", "Some .so files are actually ", ", e.g. ", " file is an ASCII text file with this contents:", "Some more complex builds may not support this. For example, if you include -v in the compiler options, you can see that the ", " discards linker script command files in the verbose output list of libraries to link in. A simple work around is to replace the linker script input command file with a copy of the file instead (or a symlink), e.g.", "Or you could replace the -l argument with the full path of the .so, e.g. instead of ", " do ", "Given the code snippet of a template type with a friend operator (or function);", "The ", " is being declared as a non-template function. For every type ", " used with ", ", there needs to be a non-templated ", ". For example, if there is a type ", " declared, then there must be an operator implementation as follows;", "Since it is not implemented, the linker fails to find it and results in the error.", "To correct this, you can declare a template operator before the ", " type and then declare as a friend, the appropriate instantiation. The syntax is a little awkward, but is looks as follows;", "The above code limits the friendship of the operator to the corresponding instantiation of ", ", i.e. the ", " instantiation is limited to access the private members of the instantiation of ", ".", "Alternatives include;", "Allowing the friendship to extend to all instantiations of the templates, as follows;", "Or, the implementation for the ", " can be done inline inside the class definition;", ", when the declaration of the operator (or function) only appears in the class, the name is not available for \"normal\" lookup, only for argument dependent lookup, from ", ";", "A name first declared in a friend declaration within class or class template X becomes a member of the innermost enclosing namespace of X, but is not accessible for lookup (except argument-dependent lookup that considers X) unless a matching declaration at the namespace scope is provided...", "There is further reading on template friends at ", " and the ", ".", ".", " ", "Examples are in C. They could equally well be C++", "You build your static library:", "You compile your program:", "You try to link it with ", " and fail:", "The same result if you compile and link in one step, like:", "Compile your program:", "Try to link your program with ", " and fail:", "Same if you compile and link in one go:", "And a variation on example 2 involving ", ":", "In the sequence of object files and libraries you want to link to make your\nprogram, you are placing the libraries before the object files that refer to\nthem. You need to place the libraries ", " the object files that refer\nto them.", "Link example 1 correctly:", "Success:", "Link example 2 correctly:", "Success:", "Link the example 2 ", " variation correctly:", ".", "By default, a linkage command generated by GCC, on your distro,\nconsumes the files in the linkage from left to right in\ncommandline sequence. When it finds that a file refers to ", "\nand does not contain a definition for it, to will search for a definition\nin files further to the right. If it eventually finds a definition, the\nreference is resolved. If any references remain unresolved at the end,\nthe linkage fails: the linker does not search backwards.", "First, ", ", with static library ", "A static library is an indexed archive of object files. When the linker\nfinds ", " in the linkage sequence and figures out that this refers\nto the static library ", ", it wants to know whether your program\nneeds any of the object files in ", ".", "There is only object file in ", ", namely ", ", and there's only one thing defined\nin ", ", namely the function ", ".", "The linker will decide that your program needs ", " if and only if it already knows that\nyour program refers to ", ", in one or more of the object files it has already\nadded to the program, and that none of the object files it has already added\ncontains a definition for ", ".", "If that is true, then the linker will extract a copy of ", " from the library and\nadd it to your program. Then, your program contains a definition for ", ", so\nits references to ", " are ", ".", "When you try to link the program like:", "the linker ", " ", " ", " when it sees\n", ". Because at that point, it has not seen ", ".\nYour program does not yet make any references to ", ": it\ndoes not yet make any references ", ", because all the references it makes\nare in ", ".", "So the linker does not add ", " to the program and has no further\nuse for ", ".", "Next, it finds ", ", and adds it to be program. An object file in the\nlinkage sequence is always added to the program. Now, the program makes\na reference to ", ", and does not contain a definition of ", "; but\nthere is nothing left in the linkage sequence that could provide the missing\ndefinition. The reference to ", " ends up ", ", and the linkage fails.", "Second, ", ", with shared library ", "A shared library isn't an archive of object files or anything like it. It's\nmuch more like a ", " that doesn't have a ", " function and\ninstead exposes multiple other symbols that it defines, so that other\nprograms can use them at runtime.", "Many Linux distros today configure their GCC toolchain so that its language drivers (", ",", ",", " etc)\ninstruct the system linker (", ") to link shared libraries on an ", " basis.\nYou have got one of those distros.", "This means that when the linker finds ", " in the linkage sequence, and figures out that this refers \nto the shared library (say) ", ", it wants to know whether any references that it has added to your program that aren't yet defined have definitions that are exported by ", "If that is true, then the linker will ", " copy any chunks out of ", " and\nadd them to your program; instead, it will just doctor the code of your program \nso that:-", "At runtime, the system program loader will load a copy of ", " into the\nsame process as your program whenever it loads a copy of your program, to run it.", "At runtime, whenever your program refers to something that is defined in\n", ", that reference uses the definition exported by the copy of ", " in\nthe same process.", "Your program wants to refer to just one thing that has a definition exported by ", ",\nnamely the function ", ", which is referred to just once, in ", ".\nIf the linker adds that reference to your program, and then finds the definition\nexported by ", ", the reference is ", " ", "But when you try to link the program like:", "the order of events is wrong in just the same way as with example 1.\nAt the point when the linker finds ", ", there are ", " references to anything\nin the program: they are all in ", ", which has not yet been seen. So the\nlinker decides it has no use for ", ". When it reaches ", ", adds it to the program,\nand then has undefined reference to ", ", the linkage sequence is finished;\nthat reference is unresolved, and the linkage fails.", "Lastly, the ", " variation of example 2 has a now obvious explanation.\nAfter shell-expansion:", "becomes:", "which is just example 2 again.", "The linkage:", "works just fine for you!", "(Or: That linkage worked fine for you on, say, Fedora 23, but fails on Ubuntu 16.04)", "That's because the distro on which the linkage works is one of the ones that \ndoes not configure its GCC toolchain to link shared libraries ", ".", "Back in the day, it was normal for unix-like systems to link static and shared \nlibraries by different rules. Static libraries in a linkage sequence were linked \non the ", " basis explained in example 1, but shared libraries were linked unconditionally.", "This behaviour is economical at linktime because the linker doesn't have to ponder\nwhether a shared library is needed by the program: if it's a shared library,\nlink it. And most libraries in most linkages are shared libraries. But there are disadvantages too:-", "It is uneconomical at ", ", because it can cause shared libraries to be\nloaded along with a program even if doesn't need them.", "The different linkage rules for static and shared libraries can be confusing\nto inexpert programmers, who may not know whether ", " in their linkage\nis going to resolve to ", " or to ", ",\nand might not understand the difference between shared and static libraries\nanyway.", "This trade-off has led to the schismatic situation today. Some distros have\nchanged their GCC linkage rules for shared libraries so that the ", "\nprinciple applies for all libraries. Some distros have stuck with the old\nway.", "If I just do:", "surely gcc has to compile ", " first, and then link the resulting\nobject file with ", ".  So how can it not know that object file\nis needed when it's doing the linking?", "Because compiling and linking with a single command does not change the\norder of the linkage sequence.", "When you run the command above, ", " figures out that you want compilation +\nlinkage. So behind the scenes, it generates a compilation command, and runs\nit, then generates a linkage command, and runs it, as if ", " had run the\ntwo commands:", "So the linkage fails just as it does if you ", " run those two commands. The\nonly difference you notice in the failure is that gcc has generated a\ntemporary object file in the compile + link case, because you're not telling it\nto use ", ". We see:", "instead of:", "Putting interdependent libraries in the wrong order is just one way\nin which you can get files that ", " definitions of things coming\nlater in the linkage than the files that ", " the definitions. Putting libraries before the \nobject files that refer to them is another way of making the same mistake.", "Linker errors can happen when a header file and its associated shared library (.lib file) go out of sync. Let me explain. ", "How do linkers work? The linker matches a function declaration (declared in the header) with its definition (in the shared library) by comparing their signatures. You can get a linker error if the linker doesn't find a function definition that matches perfectly. ", "Is it possible to still get a linker error even though the declaration and the definition seem to match? Yes! They might look the same in source code, but it really depends on what the compiler sees. Essentially you could end up with a situation like this:", "Note how even though both the function declarations look identical in source code, but they are really different according to the compiler.", "You might ask how one ends up in a situation like that? ", " of course! If when compiling the shared library, the include path leads to ", " and you end up using ", " in your own program, you'll be left scratching your header wondering what happened (pun intended).", "An example of how this can happen in the real world is explained below.", "I have two projects: ", " and ", ". Both projects depend on ", ". Suppose the library exports the following function:", "And then you go ahead and include the library in your own project.", "Boom! You get a linker error and you have no idea why it's failing. The reason is that the common library uses different versions of the same include ", " (I have made it obvious here in the example by including a different path, but it might not always be so obvious. Maybe the include path is different in the compiler settings).", "Note in this example, the linker would tell you it couldn't find ", ", when in reality you know it obviously is being exported by the library. You could spend hours scratching your head wondering what went wrong. The thing is, the linker sees a different signature because the parameter types are slightly different. In the example, ", " is a different type in both projects as far as the compiler is concerned. This could happen because they come from two slightly different include files (maybe the include files come from two different versions of the library).", "DUMPBIN is your friend, if you are using Visual Studio. I'm sure other compilers have other similar tools.", "The process goes like this:", "[1] By project I mean a set of source files that are linked together to produce either a library or an executable.", "EDIT 1: Rewrote first section to be easier to understand. Please comment below to let me know if something else needs to be fixed. Thanks!", "A Windows UNICODE build is built with ", " etc. being defined as ", " etc. When not building with ", " defined as build with ", " defined as ", " etc. These ", " and ", " defines affect all the ", "; ", ", ", " and their elk.", "Building one library with ", " defined and attempting to link it in a project where ", " is not defined will result in linker errors since there will be a mismatch in the definition of ", "; ", " vs. ", ".", "The error usually includes a function a value with a ", " or ", " derived type, these could include ", " etc. as well. When browsing through the affected function in the code, there will often be a reference to ", " or ", " etc. This is a tell-tale sign that the code was originally intended for both a UNICODE and a Multi-Byte Character (or \"narrow\") build.", "To correct this, build all the required libraries and projects with a consistent definition of ", " (and ", ").", "This can be done with either;", "Or in the project settings;", "Project Properties > General > Project Defaults > Character Set", "Or on the command line;", "The alternative is applicable as well, if UNICODE is not intended to be used, make sure the defines are not set, and/or the multi-character setting is used in the projects and consistently applied.", "Do not forget to be consistent between the \"Release\" and \"Debug\" builds as well.", "A \"clean\" of the build can remove the \"dead wood\" that may be left lying around from previous builds, failed builds, incomplete builds and other build system related build issues.", "In general the IDE or build will include some form of \"clean\" function, but this may not be correctly configured (e.g. in a manual makefile) or may fail (e.g. the intermediate or resultant binaries are read-only).", "Once the \"clean\" has completed, verify that the \"clean\" has succeeded and all the generated intermediate file (e.g. an automated makefile) have been successfully removed.", "This ", "; especially if the code related to the error has recently been added (either locally or from the source repository).", "For people coming from C it might be a surprise that in C++ global ", "variables have internal (or static) linkage. In C this was not the case, as all global variables are implicitly ", " (i.e. when the ", " keyword is missing).", "Example: ", "correct would be to use a header file and include it in file2.cpp ", " file1.cpp", "Alternatively one could declare the ", " variable in file1.cpp with explicit ", "Even though this is a pretty old questions with multiple accepted answers, I'd like to share how to resolve an ", " \"undefined reference to\" error.  ", "I was using an alias to refer to ", ": filesystem is in the standard library since C++17 but my program needed to ", " so I decided to use a variable alias:  ", "Let's say I have three files: main.cpp, file.h, file.cpp:", "Note the ", " used in main.cpp and file.h. Since main.cpp #include'd \"", "\" after <", ">, the version of filesystem used there was ", ". I used to compile the program with the following commands:", "$ ", " -> compiles main.cpp to main.o", "\n$ ", " -> compiles file.cpp and file.h to file.o", "\n$ ", " -> links main.o and file.o  ", "This way ", " contained in file.o and used in main.o that ", " gave \"undefined reference\" errors because ", " referred to ", " but ", " to ", ".  ", "To fix this I just needed to ", ".", "The default behavior of gcc is that all symbols are visible. However, when the translation units are built with option ", ", only functions/symbols marked with ", " are external in the resulting shared object.", "You can check whether the symbols your are looking for are external by invoking:", "the hidden/local symbols are shown by ", " with lowercase symbol type, for example ", " instead of `T for code-section:", "You can also use ", " with the option ", " to demangle the names (if C++ was used).", "Similar to Windows-dlls, one would mark public functions with a define, for example ", " defined as:", "Which roughly corresponds to Windows'/MSVC-version:", "More ", " can be found on the gcc wiki.", "When a translation unit is compiled with ", " the resulting symbols have still external linkage (shown with upper case symbol type by ", ") and can be used for external linkage without problem if the object files become part of a static libraries. The linkage becomes local only when the object files are linked into a shared library.", "To find which symbols in an object file are hidden run:", "You may see a message like:", "In that case, it means that the available symbols are for a different architecture than the one you are compiling for.", "On Visual Studio, this is due to the wrong \"Platform\", and you need to either select the proper one or install the proper version of the library.", "On Linux, it may be due to the wrong library folder (using ", " instead of ", " for instance).", "On MacOS, there is the option of shipping both architectures in the same file. It may be that the link expects both versions to be there, but only one is. It can also be an issue with the wrong ", "/", " folder where the library is picked up."], "quote": ["The precedence among the syntax rules of translation is specified by the following phases ", ".", " Implementations must behave as if these separate phases occur, although in practice different phases might be folded together.", "note: i use g++ and Linux and all examples is for it ", "If you get linker errors about undefined references to symbols that involve types in the std::__cxx11 namespace or the tag [abi:cxx11] then it probably indicates that you are trying to link together object files that were compiled with different values for the _GLIBCXX_USE_CXX11_ABI macro. This commonly happens when linking to a third-party library that was compiled with an older version of GCC. If the third-party library cannot be rebuilt with the new ABI then you will need to recompile your code with the old ABI.", "A name first declared in a friend declaration within class or class template X becomes a member of the innermost enclosing namespace of X, but is not accessible for lookup (except argument-dependent lookup that considers X) unless a matching declaration at the namespace scope is provided...", " ", "Project Properties > General > Project Defaults > Character Set"], "answer_code": ["a", "a.cpp", "b.cpp", "b.cpp", ".lib", ".lib", "error LNK2001", "error LNK1120", "error LNK2019", "undefined reference to", "struct X\n{\n   virtual void foo();\n};\nstruct Y : X\n{\n   void foo() {}\n};\nstruct A\n{\n   virtual ~A() = 0;\n};\nstruct B: A\n{\n   virtual ~B(){}\n};\nextern int x;\nvoid foo();\nint main()\n{\n   x = 0;\n   foo();\n   Y y;\n   B b;\n}\n", "/home/AbiSfw/ccvvuHoX.o: In function `main':\nprog.cpp:(.text+0x10): undefined reference to `x'\nprog.cpp:(.text+0x19): undefined reference to `foo()'\nprog.cpp:(.text+0x2d): undefined reference to `A::~A()'\n/home/AbiSfw/ccvvuHoX.o: In function `B::~B()':\nprog.cpp:(.text._ZN1BD1Ev[B::~B()]+0xb): undefined reference to `A::~A()'\n/home/AbiSfw/ccvvuHoX.o: In function `B::~B()':\nprog.cpp:(.text._ZN1BD0Ev[B::~B()]+0x12): undefined reference to `A::~A()'\n/home/AbiSfw/ccvvuHoX.o:(.rodata._ZTI1Y[typeinfo for Y]+0x8): undefined reference to `typeinfo for X'\n/home/AbiSfw/ccvvuHoX.o:(.rodata._ZTI1B[typeinfo for B]+0x8): undefined reference to `typeinfo for A'\ncollect2: ld returned 1 exit status\n", "1>test2.obj : error LNK2001: unresolved external symbol \"void __cdecl foo(void)\" (?foo@@YAXXZ)\n1>test2.obj : error LNK2001: unresolved external symbol \"int x\" (?x@@3HA)\n1>test2.obj : error LNK2001: unresolved external symbol \"public: virtual __thiscall A::~A(void)\" (??1A@@UAE@XZ)\n1>test2.obj : error LNK2001: unresolved external symbol \"public: virtual void __thiscall X::foo(void)\" (?foo@X@@UAEXXZ)\n1>...\\test2.exe : fatal error LNK1120: 4 unresolved externals\n", "#pragma", "UNICODE", "virtual", "struct X\n{\n    virtual ~X() = 0;\n};\nstruct Y : X\n{\n    ~Y() {}\n};\nint main()\n{\n    Y y;\n}\n//X::~X(){} //uncomment this line for successful definition\n", "virtual", "virtual", "struct X\n{\n    virtual void foo();\n};\nstruct Y : X\n{\n   void foo() {}\n};\nint main()\n{\n   Y y; //linker error although there was no call to X::foo\n}\n", "X::foo()", "struct X\n{\n    virtual void foo() = 0;\n};\n", "virtual", "struct A\n{ \n    ~A();\n};\n", "A a;      //destructor undefined\n", "struct A\n{ \n    ~A() {}\n};\n", "A::~A() {}\n", "inline", "struct A\n{\n   void foo();\n};\n\nvoid foo() {}\n\nint main()\n{\n   A a;\n   a.foo();\n}\n", "void A::foo() {}\n", "static", "struct X\n{\n    static int x;\n};\nint main()\n{\n    int x = X::x;\n}\n//int X::x; //uncomment this line to define X::x\n", "static", "const", "static const", "g++ -o test objectFile1.o objectFile2.o -lLibraryName\n", "libraryName", "libfoo.so", "-lfoo", "foo.lib", "-L\u2039directory\u203a", "-l", "-L", "lib", "lib", "Input -> Additional Dependencies", "lib", "Linker -> General -> Additional Library Directories", "lib", "__imp_", "gcc main.c", "gcc main.c other.c", "extern int x;\n", "int x;\n", "extern int x;\nint main()\n{\n    x = 0;\n}\n//int x; // uncomment this line for successful definition\n", "void foo(); // declaration only\nint main()\n{\n   foo();\n}\n//void foo() {} //uncomment this line for successful definition\n", "void foo(int& x);\nint main()\n{\n   int x;\n   foo(x);\n}\nvoid foo(const int& x) {} //different function, doesn't provide a definition\n                          //for void foo(int& x)\n", "#includes", "A", "B", "libA", "libB", "// B.h\n#ifndef B_H\n#define B_H\n\nstruct B {\n    B(int);\n    int x;\n};\n\n#endif\n\n// B.cpp\n#include \"B.h\"\nB::B(int xx) : x(xx) {}\n\n// A.h\n#include \"B.h\"\n\nstruct A {\n    A(int x);\n    B b;\n};\n\n// A.cpp\n#include \"A.h\"\n\nA::A(int x) : b(x) {}\n\n// main.cpp\n#include \"A.h\"\n\nint main() {\n    A a(5);\n    return 0;\n};\n", "$ g++ -c A.cpp\n$ g++ -c B.cpp\n$ ar rvs libA.a A.o \nar: creating libA.a\na - A.o\n$ ar rvs libB.a B.o \nar: creating libB.a\na - B.o\n", "$ g++ main.cpp -L. -lB -lA\n./libA.a(A.o): In function `A::A(int)':\nA.cpp:(.text+0x1c): undefined reference to `B::B(int)'\ncollect2: error: ld returned 1 exit status\n$ g++ main.cpp -L. -lA -lB\n$ ./a.out\n", "// src1.cpp\nvoid print();\n\nstatic int local_var_name; // 'static' makes variable not visible for other modules\nint global_var_name = 123;\n\nint main()\n{\n    print();\n    return 0;\n}\n", "// src2.cpp\nextern \"C\" int printf (const char*, ...);\n\nextern int global_var_name;\n//extern int local_var_name;\n\nvoid print ()\n{\n    // printf(\"%d%d\\n\", global_var_name, local_var_name);\n    printf(\"%d\\n\", global_var_name);\n}\n", "$ g++ -c src1.cpp -o src1.o\n$ g++ -c src2.cpp -o src2.o\n", "$ readelf --symbols src1.o\n  Num:    Value          Size Type    Bind   Vis      Ndx Name\n     5: 0000000000000000     4 OBJECT  LOCAL  DEFAULT    4 _ZL14local_var_name # [1]\n     9: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    3 global_var_name     # [2]\n", "[1] - this is our static (local) variable (important - Bind has a type \"LOCAL\")\n[2] - this is our global variable\n", "$ g++ src1.o src2.o -o prog\n", "$ ./prog\n123\n", "// src2.cpp\nextern \"C\" int printf (const char*, ...);\n\nextern int global_var_name;\nextern int local_var_name;\n\nvoid print ()\n{\n    printf(\"%d%d\\n\", global_var_name, local_var_name);\n}\n", "$ g++ -c src2.cpp -o src2.o\n", "$ g++ src1.o src2.o -o prog\nsrc2.o: In function `print()':\nsrc2.cpp:(.text+0x6): undefined reference to `local_var_name'\ncollect2: error: ld returned 1 exit status\n", "$ g++ -S src1.cpp -o src1.s\n\n// src1.s\nlook src1.s\n\n    .file   \"src1.cpp\"\n    .local  _ZL14local_var_name\n    .comm   _ZL14local_var_name,4,4\n    .globl  global_var_name\n    .data\n    .align 4\n    .type   global_var_name, @object\n    .size   global_var_name, 4\nglobal_var_name:\n    .long   123\n    .text\n    .globl  main\n    .type   main, @function\nmain:\n; assembler code, not interesting for us\n.LFE0:\n    .size   main, .-main\n    .ident  \"GCC: (Ubuntu 4.8.2-19ubuntu1) 4.8.2\"\n    .section    .note.GNU-stack,\"\",@progbits\n", ".local  _ZL14local_var_name\n.comm   _ZL14local_var_name,4,4\n", "    .globl  local_var_name\n    .data\n    .align 4\n    .type   local_var_name, @object\n    .size   local_var_name, 4\nlocal_var_name:\n    .long   456789\n", "    .file   \"src1.cpp\"\n    .globl  local_var_name\n    .data\n    .align 4\n    .type   local_var_name, @object\n    .size   local_var_name, 4\nlocal_var_name:\n    .long   456789\n    .globl  global_var_name\n    .align 4\n    .type   global_var_name, @object\n    .size   global_var_name, 4\nglobal_var_name:\n    .long   123\n    .text\n    .globl  main\n    .type   main, @function\nmain:\n; ...\n", "$ g++ -c src1.s -o src2.o\n", "$ readelf --symbols src1.o\n8: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    3 local_var_name\n", "$ g++ src1.o src2.o -o prog\n", "$ ./prog \n123456789\n", "void foo()", "void foo();\nint main()\n{\n    foo();\n}\n", "extern \"C\" void foo();\nint main()\n{\n    foo();\n}\n", "void foo()", "extern \"C\" void foo();\n", "extern \"C\" {\n    #include \"cheader.h\"\n}\n", "#ifdef __cplusplus [\\n] extern\"C\" { [\\n] #endif", "#ifdef __cplusplus [\\n] } [\\n] #endif", "[\\n]", "__declspec(dllexport)", "__declspec(dllimport)", "#ifdef THIS_MODULE\n#define DLLIMPEXP __declspec(dllexport)\n#else\n#define DLLIMPEXP __declspec(dllimport)\n#endif\n", "THIS_MODULE", "DLLIMPEXP void foo();\n", "__declspec(dllexport) void foo();\n", "__declspec(dllimport) void foo();\n", "class DLLIMPEXP X\n{\n};\n", "visibility", ".def", ".def", "extern", "__declspec (dllimport)", "int foo()\n{\n    return 0;\n}\n", "void foo();\n", "bar()", "void bar()\n{\n    foo();\n}\n", "Project | Properties | Configuration Properties | Linker | Input | Additional Dependency", "impl", "template<class T>\nstruct X\n{\n    void foo();\n};\n\nint main()\n{\n    X<int> x;\n    x.foo();\n}\n\n//differentImplementationFile.cpp\ntemplate<class T>\nvoid X<T>::foo()\n{\n}\n", "X::foo", "WinMain@16", "main()", "int main(int argc, char** argv);", "WinMain", "main", "#pragma", "#pragma comment(lib, \"libname.lib\")\n", "packages", "packagename\\build\\native\\packagename.targets", "v110", "v110", "v120", "v110", "error LNK2001: unresolved external symbol \"void __cdecl foo(void)\" (?foo@@YAXXZ)", "#pragma once", "-v -Wl,--verbose", "-v -Wl,-v", "/VERBOSE", "/VERBOSE:LIB", "/VERBOSE", "INPUT (libtbb.so.2)\n", "cp libtbb.so.2 libtbb.so\n", "-ltbb", "/home/foo/tbb-4.3/linux/lib/intel64/gcc4.4/libtbb.so.2", "template <typename T>\nclass Foo {\n    friend std::ostream& operator<< (std::ostream& os, const Foo<T>& a);\n};\n", "operator<<", "T", "Foo", "operator<<", "Foo<int>", "std::ostream& operator<< (std::ostream& os, const Foo<int>& a) {/*...*/}\n", "Foo", "// forward declare the Foo\ntemplate <typename>\nclass Foo;\n\n// forward declare the operator <<\ntemplate <typename T>\nstd::ostream& operator<<(std::ostream&, const Foo<T>&);\n\ntemplate <typename T>\nclass Foo {\n    friend std::ostream& operator<< <>(std::ostream& os, const Foo<T>& a);\n    // note the required <>        ^^^^\n    // ...\n};\n\ntemplate <typename T>\nstd::ostream& operator<<(std::ostream&, const Foo<T>&)\n{\n  // ... implement the operator\n}\n", "Foo", "operator<< <int>", "Foo<int>", "template <typename T>\nclass Foo {\n    template <typename T1>\n    friend std::ostream& operator<<(std::ostream& os, const Foo<T1>& a);\n    // ...\n};\n", "operator<<", "template <typename T>\nclass Foo {\n    friend std::ostream& operator<<(std::ostream& os, const Foo& a)\n    { /*...*/ }\n    // ...\n};\n", "warning: friend declaration 'std::ostream& operator<<(...)' declares a non-template function [-Wnon-template-friend]", "note: (if this is not what you intended, make sure the function template has already been declared and add <> after the function name here)", "libfoo", "libbar", "libfoo", "libbar", "undefined reference to", "#include", "#include \"my_lib.h\"\n#include <stdio.h>\n\nvoid hw(void)\n{\n    puts(\"Hello World\");\n}\n", "#ifndef MY_LIB_H\n#define MT_LIB_H\n\nextern void hw(void);\n\n#endif\n", "#include <my_lib.h>\n\nint main()\n{\n    hw();\n    return 0;\n}\n", "$ gcc -c -o my_lib.o my_lib.c\n$ ar rcs libmy_lib.a my_lib.o\n", "$ gcc -I. -c -o eg1.o eg1.c\n", "libmy_lib.a", "$ gcc -o eg1 -L. -lmy_lib eg1.o \neg1.o: In function `main':\neg1.c:(.text+0x5): undefined reference to `hw'\ncollect2: error: ld returned 1 exit status\n", "$ gcc -o eg1 -I. -L. -lmy_lib eg1.c\n/tmp/ccQk1tvs.o: In function `main':\neg1.c:(.text+0x5): undefined reference to `hw'\ncollect2: error: ld returned 1 exit status\n", "libz", "#include <zlib.h>\n#include <stdio.h>\n\nint main()\n{\n    printf(\"%s\\n\",zlibVersion());\n    return 0;\n}\n", "$ gcc -c -o eg2.o eg2.c\n", "libz", "$ gcc -o eg2 -lz eg2.o \neg2.o: In function `main':\neg2.c:(.text+0x5): undefined reference to `zlibVersion'\ncollect2: error: ld returned 1 exit status\n", "$ gcc -o eg2 -I. -lz eg2.c\n/tmp/ccxCiGn7.o: In function `main':\neg2.c:(.text+0x5): undefined reference to `zlibVersion'\ncollect2: error: ld returned 1 exit status\n", "pkg-config", "$ gcc -o eg2 $(pkg-config --libs zlib) eg2.o \neg2.o: In function `main':\neg2.c:(.text+0x5): undefined reference to `zlibVersion'\n", "$ gcc -o eg1 eg1.o -L. -lmy_lib\n", "$ ./eg1 \nHello World\n", "$ gcc -o eg2 eg2.o -lz\n", "$ ./eg2 \n1.2.8\n", "pkg-config", "$ gcc -o eg2 eg2.o $(pkg-config --libs zlib) \n$ ./eg2\n1.2.8\n", "my_lib.a", "-lmy_lib", "./libmy_lib.a", "libmy_lib.a", "libmy_lib.a", "my_lib.o", "my_lib.o", "hw", "my_lib.o", "hw", "hw", "my_lib.o", "hw", "hw", "$ gcc -o eg1 -L. -lmy_lib eg1.o\n", "eg1.o", "-lmy_lib", "eg1.o", "hw", "eg1.o", "my_lib.o", "libmy_lib.a", "eg1.o", "hw", "hw", "hw", "libz", "main", "gcc", "g++", "gfortran", "ld", "-lz", "/usr/lib/x86_64-linux-gnu/libz.so", "libz", "libz", "libz", "libz", "libz", "libz", "zlibVersion", "eg2.c", "libz", "gcc -o eg2 -lz eg2.o\n", "-lz", "eg2.o", "libz", "eg2.o", "zlibVersion", "pkg-config", "gcc -o eg2 $(pkg-config --libs zlib) eg2.o\n", "gcc -o eg2 -lz eg2.o\n", "gcc -o eg2 -lz eg2.o\n", "-lfoo", "/some/where/libfoo.a", "/some/where/libfoo.so", "$ gcc -o eg1 -I. -L. -lmy_lib eg1.c\n", "eg1.c", "libmy_lib.a", "gcc", "$ gcc -I. -c -o eg1.o eg1.c\n$ gcc -o eg1 -L. -lmy_lib eg1.o\n", "eg1.o", "/tmp/ccQk1tvs.o: In function `main'\n", "eg1.o: In function `main':\n", "// header1.h\ntypedef int Number;\nvoid foo(Number);\n\n// header2.h\ntypedef float Number;\nvoid foo(Number); // this only looks the same lexically\n", "header1.h", "header2.h", "graphics.lib", "main.exe", "common_math.h", "// graphics.lib    \n#include \"common_math.h\" \n\nvoid draw(vec3 p) { ... } // vec3 comes from common_math.h\n", "// main.exe\n#include \"other/common_math.h\"\n#include \"graphics.h\"\n\nint main() {\n    draw(...);\n}\n", "common_math.h", "draw()", "vec3", "UNICODE", "TCHAR", "wchar_t", "UNICODE", "TCHAR", "char", "UNICODE", "_UNICODE", "T", "LPTSTR", "LPCTSTR", "UNICODE", "UNICODE", "TCHAR", "char", "wchar_t", "char", "wchar_t", "std::basic_string<>", "TCHAR", "std::basic_string<TCHAR>", "UNICODE", "_UNICODE", "#define UNICODE\n#define _UNICODE\n", "/DUNICODE /D_UNICODE\n", "const", "const", "extern", "static", "// file1.cpp\nconst int test = 5;    // in C++ same as \"static const int test = 5\"\nint test2 = 5;\n\n// file2.cpp\nextern const int test;\nextern int test2;\n\nvoid foo()\n{\n int x = test;   // linker error in C++ , no error in C\n int y = test2;  // no problem\n}\n", "extern const int test;\nextern int test2;\n", "const", "extern", "std::filesystem::path", "#if (defined _GLIBCXX_EXPERIMENTAL_FILESYSTEM) //is the included filesystem library experimental? (C++14 and newer: <experimental/filesystem>)\nusing path_t = std::experimental::filesystem::path;\n#elif (defined _GLIBCXX_FILESYSTEM) //not experimental (C++17 and newer: <filesystem>)\nusing path_t = std::filesystem::path;\n#endif\n", "g++ -g -std=c++17 -c main.cpp", "g++ -g -std=c++17 -c file.cpp", "g++ -g -std=c++17 -o executable main.o file.o -lstdc++fs", "path_t", "std::filesystem::path", "std::experimental::filesystem::path", "-fvisibility=hidden", "__attribute__ ((visibility (\"default\")))", "# -D shows (global) dynamic symbols that can be used from the outside of XXX.so\nnm -D XXX.so | grep MY_SYMBOL \n", "nm", "t", "nm XXX.so\n00000000000005a7 t HIDDEN_SYMBOL\n00000000000005f8 T VISIBLE_SYMBOL\n", "nm", "-C", "DLL_PUBLIC", "#define DLL_PUBLIC __attribute__ ((visibility (\"default\")))\n\nDLL_PUBLIC int my_public_function(){\n  ...\n}\n", "#ifdef BUILDING_DLL\n    #define DLL_PUBLIC __declspec(dllexport) \n#else\n    #define DLL_PUBLIC __declspec(dllimport) \n#endif\n", "-fvisibility=hidden", "nm", ">>> objdump -t XXXX.o | grep hidden\n0000000000000000 g     F .text  000000000000000b .hidden HIDDEN_SYMBOL1\n000000000000000b g     F .text  000000000000000b .hidden HIDDEN_SYMBOL2\n", "nm -CD", "nm -gCD", "library machine type 'x64' conflicts with target machine type 'X86'\n", "lib", "lib64", "lib", "lib64"], "url": "https://stackoverflow.com/questions/12573816/what-is-an-undefined-reference-unresolved-external-symbol-error-and-how-do-i-fix"}
,{"title": "How to get ROS MSG length in python?", "time": "2019-02-03 02:30:40Z", "post_content": ["I have a problem that needs to count the length of each ROS topic msg.", "I modified rostopic(/opt/ros/smart-ros/lib/python2.7/dist-packages/rostopic / __ init__.py):", "But when the message contains a vector or struct list, the length is incorrect.", "Please help solve this problem?", "Thanks."], "answer": ["The problem is the behaviour of ", ":", "Only the memory consumption directly attributed to the object is accounted for, not the memory consumption of objects it refers to.", "This means only the size of the reference to a list is used to calculate the object size.", "There are already a few questions dealing with this:", "The solution is to ", " which provides a function to the required calculation:", "Function asizeof calculates the combined (approximate) size of one or several Python objects in bytes", "After installing the package using ", "pip install pympler", "and importing it to your code like", "you are able to print the correct object size in your callback like"], "quote": ["Only the memory consumption directly attributed to the object is accounted for, not the memory consumption of objects it refers to.", "Function asizeof calculates the combined (approximate) size of one or several Python objects in bytes", "pip install pympler"], "question_code": ["Class CallbackEcho(object) ->\nDef callback (self, data, callback_args, current_time = None):\n    Print('message length =',sys.getsizeof(data)) #statics msg length\n"], "answer_code": ["from pympler.asizeof import asizeof\n", "print('Size: ' + str(asizeof(data)))\n"], "url": "https://stackoverflow.com/questions/54499456/how-to-get-ros-msg-length-in-python"}
,{"title": "Not retrieving NOTIFY with libpq in a C++ program", "time": "2013-12-10 15:27:23Z", "post_content": ["I'm enhancing a ROS (robot operating system) stack ", " to be able to handle postgresqls LISTEN and NOTIFY commands. As mentioned, I'm using libpq version 9.1.10-0 on Ubuntu12.04 within a C++ program.\nBut for some reasons I'm not able to retrieve a NOTIFY.", "I know, that there's an example (Example 28-2. libpq Example Program 2)  and it works perfectly fine. I've played around with it quite a long time and also tried to copy it to my code as exactly as possible and change the example code in a way making it more similar to the code I'm having problems with. But that didn't help for my problem.", "I can received notifies in the example program and in a manual login into the database, but not in the  code I want to use.", "What else did I try:", "The NOTIFY was always triggered manually with ", "The code can also be seen here ", " (on the unstable branches):", "class PostgresqlDatabase (in sql_interface->database_interface->src on github)", "\nThis class holds the connection PGconn and provides tasks like", "The main purpose of that class is to abstract the sql queries, so that ROS-programmers don't have to care about them anymore.", "class databaseBinding", "\nit's the glue between ROS and the database functionalities. It holds a PostgresqlDatabase object to get a database connection and to call the tasks.", "A main function ", "\nDoes the following things", "The checkNotify function, which is triggered about 5 times per second:"], "answer": ["So it turned out, that there was something wrong with the connection.\nIt was created with that code:", "With ", "\nBut an empty username doesn't satisfy the usage of PQconnectdb, which, for some parsing-reason, caused it to login to the database \"turtlebot\". That database unfortunately existed on my server. And there it - of course - didn't get any notifications sent out in the \"rosdb\"-database and had a good connection.", "What an, for me, awkward and unlucky behaviour."], "question_code": ["COMMIT;", "LISTEN <channel>;", "PQconsumeInput(connection_);", "NOTIFY <channel>;", " bool listenToChannel(std::string channel);\n", "PostgresqlDatabase::listenToChannel(std::string channel)", "PostgresqlDatabase::checkNotify(notification &no)", "/*! Checks for a received NOTIFY and returns it. */\nbool PostgresqlDatabase::checkNotify(notification &no)\n{\n  PGnotify   *notify;\n  PQconsumeInput(connection_);\n  if ((notify = PQnotifies(connection_)) != NULL)\n    {\n    no.channel = notify->relname;\n    no.sending_pid = notify->be_pid;\n    no.payload = notify->extra;\n    PQfreemem(notify);\n    return true;\n    } else\n    {\n    no.channel = \"\";\n    no.sending_pid = 0;\n    no.payload = \"\";\n    PQfreemem(notify);\n    return false;\n    }\n}\n", "/*! Listens to a specified channel using the Postgresql LISTEN-function.*/\nbool PostgresqlDatabase::listenToChannel(std::string channel) {\n  //look, if we're already listening to the channel in our list\n  if (std::find(channels_.begin(),channels_.end(),channel) == channels_.end() )\n    {\n      std::string query = \"LISTEN \" + channel;\n      PGresultAutoPtr result = PQexec(connection_,query.c_str());\n      if (PQresultStatus(*result) != PGRES_COMMAND_OK)\n          {\n              ROS_WARN(\"LISTEN command failed: %s\", PQerrorMessage(connection_));\n              return false;\n          }\n      ROS_INFO(\"Now listening to channel \\\"%s\\\"\",channel.c_str());\n      channels_.push_back(channel);\n      return true;\n    }\n  ROS_INFO(\"We are already listening to channel \\\"%s\\\" - nothing to be done\",channel.c_str());\n  return true;\n}\n"], "answer_code": ["void PostgresqlDatabase::pgMDBconstruct(std::string host, std::string port, \nstd::string user, std::string password, std::string dbname )\n{\n  std::string conn_info = \"host=\" + host + \" port=\" + port +\n    \" user=\" + user + \" password=\" + password + \" dbname=\" + dbname;\n  connection_= PQconnectdb(conn_info.c_str());\n  if (PQstatus(connection_)!=CONNECTION_OK)\n  {\n    ROS_ERROR(\"Database connection failed with error message: %s\", PQerrorMessage(connection_));\n  }\n}\n", "host=192.168.10.100, port=5432, user=turtlebot, password= , dbname=rosdb."], "url": "https://stackoverflow.com/questions/20495210/not-retrieving-notify-with-libpq-in-a-c-program"}
,{"title": "How to make table and variable values to persist when calling a lua function from c++?", "time": "2016-06-09 07:24:13Z", "post_content": ["I am calling a lua function from a c++ script. Within the lua function, I need to update certain variables and tables based on the data that I am passing to the function from C++. The data has to be passed to the lua function in a continuous loop, and each successive update to the lua variables and tables must take into account the changes made by the previous updates. How to accomplish this in a robust way? One clumsy way might be just to pass the values around between C and lua, or save and load them repeatedly, but since my data tables are expected to be really large that really may not be a good option. Please suggest solutions. ", "PS: I cannot simply write the entire code in lua since the C++ code is meant to run rosservices and subscribe to rostopics. I think it may be difficult to achieve the same in lua, and although there is a package called roslua apparently it is not compatible with ros indigo. ", "Calling this from C++", "Here variable x is the state whose state I want to retain after incrementing it by the value passed from C++. What I am not getting is where is the local function ", " being invoked? should be within the outer lua function or elsewhere? when I comment out the line increment(t) within the outer lua function, I simply get 2, 10, 3, 10 as the output, whereas on with increment(t) I am just getting 2, 12, 3, 13. Clearly the static variable behaviour is not getting implemented correctly. Where am I going wrong? Thanks. "], "answer": ["Expanding on the use of upvalues to carry state, here is some pseudo-code to get you started.", "Lua function factory which returns a function (", ") which has persistent state as an upvalue (", ", ", "):", "Creating an instance of ", " with state from Lua:", "Creating an instance of ", " wih state from C:", "Calling this function from C in a loop", "Let me know if anything here is unclear.  I'm making some assumptions about what sort of state you are trying to maintain, and there are a bunch of other things that can be handled with a little extra work (like returning the state to C, for example).", "In your example calling the Lua code from C++, there are a couple of problems.  Here is what I believe you wanted:", "In order to see the results of these increments, you'll want to print them out inside the ", " function.  The factory function gets called once.  The function it returns gets called multiple times.", "If you want to be able to set the initial state and retrieve the value afterward, you might want a lua function something like this:", "Here the factory function returns two functions, one to increment the state, and the other to retrieve it.  ", " is an upvalue to both ", " and ", ".  (If you want the value of the state after each increment, it is easier to return it from ", ".)  This would be used like this:"], "question_code": [" function test_upvalues(a)\n print(a)\n local x=10\n local function increment(t)\n x=x+t\n end\n --increment(a)\n print(x)\nreturn(increment)\nend\n", "lua_getglobal(L, \"test_upvalues\");\nlua_pushvalue(L, -1);\n\nlua_pushnumber(L,2); //push a value to increment state\nlua_call(L,1,0);\n\nlua_pushvalue(L, -1);\nlua_pushnumber(L,3); //push another value to increment state further\nlua_call(L,1,0);\n", "increment(t)"], "answer_code": ["myfunction", "mystate", "mystate2", "function create_myfunction ()\n   local mystate = {} -- initial value of state\n   local mystate2 = 0 -- Can have more than one upvalue\n   local function myfunction (args)\n       -- modify mystate and mystate2 based on args here\n   end\n   return myfunction\nend\n", "myfunction", "called_from_c_function = create_myfunction();\n", "myfunction", "lua_getglobal(L, \"create_myfunction\");\nlua_call(L, 0, 1); // Zero arguments, one result\n", "// Assume myfunction is on the top of the stack\nfor (...) { // Loop\n    lua_pushvalue(L, -1); // Copy function on stack (so we can use it again, as it gets consumed by the call)\n    // Now push an argument to the function on the stack here\n    lua_pushfoo(L, ...); // Just an example\n    lua_call(L, 1, 0); // Call myfunction with 1 argument, returning 0\n    // We should be stack-neutral at this point, with myfunction on top\n}\n", "lua_getglobal(L, \"test_upvalues\"); // Put factory function on stack\nlua_pushnumber(L, 1); // Argument 'a' (not sure what you are using it for)\nlua_call(L, 1, 1); // Call factory.  Consumes argument 'a', returns function 'increment'\n\nlua_pushvalue(L, -1); // Copies 'increment' on stack\nlua_pushnumber(L, 2); //push a value to increment state\nlua_call(L,1,0); // Calls 'increment' function with increment\n\nlua_pushvalue(L, -1); // Copies 'increment' on stack\nlua_pushnumber(L, 3); //push another value to increment state further\nlua_call(L,1,0); // Calls 'increment' function with increment\n", "increment", "function increment_factory(value)\n  local function get_state()\n    return value\n  end\n  local function increment(x)\n    value = value + x\n  end\n  return get_state, increment\nend\n", "value", "get_state", "increment", "increment", "lua_getglobal(L, \"increment_factory\");\nlua_pushnumber(L, INITIAL_STATE);\nlua_call(L, 1, 2);  // One argument, two returned functions\n\nlua_pushvalue(L, -1); // Copy 'increment'\nlua_pushnumber(L, 2); // Push value to increment\nlua_call(L, 1, 0);    // Call 'increment'\n\nlua_pushvalue(L, -1); // Copy 'increment'\nlua_pushnumber(L, 3); // Push value to increment\nlua_call(L, 1, 0);    // Call 'increment'\n\nlua_pushvalue(L, -2); // Copy 'get_state'\nlua_call(L, 0, 1);    // Call 'get_state'\n\n// Now the current state is on the top of the stack\n"], "url": "https://stackoverflow.com/questions/37679050/how-to-make-table-and-variable-values-to-persist-when-calling-a-lua-function-fro"}
,{"title": "How to use the Azure IoT Hub node on ROS?", "time": "2019-05-09 07:52:28Z", "post_content": ["I'm making a project combining robotics and cloud computing.\nBeginning simply, I currently use a raspberry py with Ubuntu and ROS Kinectic, controlling an arduino with some servomotors and sensors. In order to monitor the sensors data, I want to connect my Raspberry to Microsoft Azure Cloud using the Python SDK for Azure IoT Hub.", "This could be done by creating a node that subscribes to the \"sensors\" topics and sends the data received to Azure IoT Hub.", "I found an Azure IoT HuB node provided on Github but can't figure out how to use it or find documentation on it: ", " ", "I wonder if someone has some advice/experience about this node? any documentation?", "Thanks for helping!"], "answer": ["Here are the steps you need to do to connect your raspberry pi to Azure IOT hub using python", "1) Setup your PI", "For setup , you can use this ", " to enable SSH on your pi.", "Enable I2C on your Pi\nUse below link to enable I2C.\n", "2) Connect your sensor with your PI", "3) Download and setup referenced modules", "Clone the client application to local:", "git clone ", "Because the Azure IoT SDKs for Python are wrappers on top of the [SDKs for C][azure-iot-sdk-c], you will need to compile the C libraries if you want or need to generate the Python libraries from source code.", "In the above script, we run ./setup.sh without parameter, so the shell will automatically detect and use the version of python installed (Search sequence 2.7->3.4->3.5). Alternatively, you can use a parameter to specify the python version which you want to use like this: sudo ./setup.sh [--python-version|-p] [2.7|3.4|3.5]", "You can refer the sample code ", ".", "Hope it helps."], "answer_code": ["sudo apt-get install git-core\n", "cd ./iot-hub-python-raspberrypi-client-app\n   sudo chmod u+x setup.sh\n   sudo ./setup.sh\n", "Known build issues:\n\n1.) On building the Python client library (`iothub_client.so`) on Linux devices that have less than **1GB** RAM, you may see build getting **stuck** at **98%** while building `iothub_client_python.cpp` as shown below\n\n``[ 98%] Building CXX object python/src/CMakeFiles/iothub_client_python.dir/iothub_client_python.cpp.o``\n\nIf you run into this issue, check the **memory consumption** of the device using `free -m command` in another terminal window during that time. If you are running out of memory while compiling iothub_client_python.cpp file, you may have to temporarily increase the **swap space** to get more available memory to successfully build the Python client side device SDK library.\n"], "url": "https://stackoverflow.com/questions/56054661/how-to-use-the-azure-iot-hub-node-on-ros"}
,{"title": "How to efficiently load large amount of parameters in ROS?", "time": "2017-05-23 11:06:37Z", "post_content": ["What is the better way to load many parameters in ROS compared to:", "where it is just too many codes and prone to error.\nCan I some how create a custom type in yaml and load it as a whole?"], "answer": ["Dictionary (in Python meaning) can be loaded as map, e.g. map. List (in Python meaning) can be loaded as vector, e.g. map.", "Example:"], "question_code": ["double default_maxvel_xy = 3;\ndouble default_maxvel_z = 1.5;\ndouble default_maxvel_c = 1;\ndouble default_maxacc_xy = 2;\ndouble default_maxacc_z = 1;\ndouble default_maxacc_c = 1;\ndouble default_maxjerk_xy = 1;\ndouble default_maxjerk_z = 1;\ndouble default_maxjerk_c = 1;\nn.param<double>(\"default_maxvel_xy\", default_maxvel_xy, 3);\nn.param<double>(\"default_maxvel_z\", default_maxvel_z, 1.5);\nn.param<double>(\"default_maxvel_c\", default_maxvel_c, 1);\nn.param<double>(\"default_maxacc_xy\", default_maxacc_xy, 2);\nn.param<double>(\"default_maxacc_z\", default_maxacc_z, 1);\nn.param<double>(\"default_maxacc_c\", default_maxacc_c, 1);\nn.param<double>(\"default_maxjerk_xy\", default_maxjerk_xy, 1);\nn.param<double>(\"default_maxjerk_z\", default_maxjerk_z, 1);\nn.param<double>(\"default_maxjerk_c\", default_maxjerk_c, 1);\n\nm_waypoint.max_dynamics.vel_max.linear.x = default_maxvel_xy;\nm_waypoint.max_dynamics.vel_max.linear.y = default_maxvel_xy;\nm_waypoint.max_dynamics.vel_max.linear.z = default_maxvel_z;\nm_waypoint.max_dynamics.vel_max.angular.x = default_maxvel_c;\nm_waypoint.max_dynamics.vel_max.angular.y = default_maxvel_c;\nm_waypoint.max_dynamics.vel_max.angular.z = default_maxvel_c;\n\nm_waypoint.max_dynamics.acc_max.linear.x = default_maxacc_xy;\nm_waypoint.max_dynamics.acc_max.linear.y = default_maxacc_xy;\nm_waypoint.max_dynamics.acc_max.linear.z = default_maxacc_z;\nm_waypoint.max_dynamics.acc_max.angular.x = default_maxacc_c;\nm_waypoint.max_dynamics.acc_max.angular.y = default_maxacc_c;\nm_waypoint.max_dynamics.acc_max.angular.z = default_maxacc_c;\n\nm_waypoint.max_dynamics.jerk_max.linear.x = default_maxjerk_xy;\nm_waypoint.max_dynamics.jerk_max.linear.y = default_maxjerk_xy;\nm_waypoint.max_dynamics.jerk_max.linear.z = default_maxjerk_z;\nm_waypoint.max_dynamics.jerk_max.angular.x = default_maxjerk_c;\nm_waypoint.max_dynamics.jerk_max.angular.y = default_maxjerk_c;\nm_waypoint.max_dynamics.jerk_max.angular.z = default_maxjerk_c;\n"], "answer_code": ["std::map<std::string, double> parameter_map;\nros::param::get(\"~my_parameter_map\", parameter_map);\n"], "url": "https://stackoverflow.com/questions/44133078/how-to-efficiently-load-large-amount-of-parameters-in-ros"}
,{"title": "Fusion of multiple Occupancy Grids from different sensors", "time": "2016-05-22 13:54:03Z", "post_content": ["I'm doing a project in ROS, where I have to make a robot navigate in the environment using a dynamic map built using data from his sensors.", "Note: I don't have to store every map I build.", "I have to wait data from every sensor and then create a new map every X milliseconds. A request for this project is that I have to build an Occupancy Grid for each sensor and then fuse them to make the robot decide his next direction and velocity.", "By now I have created the Occupancy Grids from an Hokuyo sensor and from a Kinect2. I'm trying to fuse them by adding the value of each cell and it works quite well. The problem is that the same wall is repeated, a bit traslated to the right.", "How can I compute the transformation between the two Occupancy Grids in a efficient way, even when the two Occupancy Grids have nothing in common (i.e. I'm not near the wall)."], "answer": [], "url": "https://stackoverflow.com/questions/37375251/fusion-of-multiple-occupancy-grids-from-different-sensors"}
,{"title": "Real Time Camera/Image Based Large-Scale Slam Algorithm", "time": "2016-05-19 05:56:32Z", "post_content": ["I want to use an already implemented ", " for ", ".", "I have found some algorithms ", " and some other independent ones such as ", " and ", ", which show some promises but they have limitation such as they use LIDAR, or don't extend to large dataset etc.", "SLAM has been an active topic for many years and some groups have also mapped an entire town. Can someone point me to such efficient algorithm?", "My requirements are:"], "answer": [], "url": "https://stackoverflow.com/questions/37274900/real-time-camera-image-based-large-scale-slam-algorithm"}
,{"title": "How to find a header path in a cpp file ROS", "time": "2019-04-07 06:00:06Z", "post_content": ["I am learning how to program in ros. And the first difficulty for me is the header files. I want to read the original code, but the question is where are they? How do I locate those header files?", "I have tried ", " in the current path, but it just show me some  irrelevent answer. For example, I am curious about ros.h, not string. For ros.h, it tells me ", "I have no idea now.", "I expect to find a efficient way to find the header in a cpp file tht I want to know. Hope you can help or give me some advice."], "answer": ["The command ", " will list all the paths that gcc is searching for header files. Since as the previous command gave an error saying it couldn't find this header this list will not include the location, otherwise the previous command would have found ", " and not produced that error.", "The location of these header files in a standard ROS install will be:", "The path to these header files will be setup for you automatically if you've run the setup script ", " or included it in your ", " script.", "Hope this helps."], "question_code": ["gcc -H xx.cpp", "fatal error: ros/ros.h: No such file or directory compilation terminated. \n", "dale@dale-Aspire-EC-471G:~/Compile/src/learningros/chapter8_tutorials/src$ gcc -H tf_broadcaster.cpp \ntf_broadcaster.cpp:1:21: fatal error: ros/ros.h: No such file or directory\ncompilation terminated.\n\ndale@dale-Aspire-EC-471G:~/Compile/src/learningros/chapter8_tutorials/src$ gcc -H odometry.cpp \n. /usr/include/c++/5/string\n.. /usr/include/x86_64-linux-gnu/c++/5/bits/c++config.h\n... /usr/include/x86_64-linux-gnu/c++/5/bits/os_defines.h\n.... /usr/include/features.h\n..... /usr/include/x86_64-linux-gnu/sys/cdefs.h\n...... /usr/include/x86_64-linux-gnu/bits/wordsize.h\n..... /usr/include/x86_64-linux-gnu/gnu/stubs.h\n...... /usr/include/x86_64-linux-gnu/gnu/stubs-64.h\n..............\n........ /usr/lib/gcc/x86_64-linux-gnu/5/include/stddef.h\n........ /usr/include/x86_64-linux-gnu/bits/time.h\n......... /usr/include/x86_64-linux-gnu/bits/timex.h\n....... /usr/include/x86_64-linux-gnu/bits/pthreadtypes.h\n........ /usr/include/x86_64-linux-gnu/bits/wordsize.h\n....... /usr/include/x86_64-linux-gnu/bits/setjmp.h\n........ /usr/include/x86_64-linux-gnu/bits/wordsize.h\n....... /usr/include/x86_64-linux-gnu/bits/wordsize.h\n.... /usr/include/x86_64-linux-gnu/c++/5/bits/atomic_word.h\n... /usr/include/c++/5/ext/alloc_traits.h\n.. /usr/include/c++/5/bits/basic_string.tcc\nodometry.cpp:2:21: fatal error: ros/ros.h: No such file or directory\ncompilation terminated.\n", "ROS_ROOT"], "answer_code": ["gcc -H odometry.cpp", "ros/ros.h", "/opt/ros/<distribution_name>/include\n", "source /opt/ros/<distribution_name>/setup.bash", ".bashrc"], "url": "https://stackoverflow.com/questions/55555444/how-to-find-a-header-path-in-a-cpp-file-ros"}
,{"title": "Most efficient way to check if object is a String", "time": "2016-11-15 09:17:02Z", "post_content": ["I get an object (", ") that is either a number or a string. If it is a string I don't want to use it, if it is a number I want to. I currently solved this problem with an ", ", though I think there are way better solutions:", "I care about efficiency, because this is part of a for loop running many times each second.", "The basic structure is a ", " message, coming from a certain topic, and can have basically any data type.\nIn this case I use a ", ", the documentation does not mention that ", " can return ", "."], "answer": ["According to ROS documentation, ", " is an array of float. That makes sense, because you add it to a float (", ") when the ", " of ", " is not ", ".", "That means that (as MSalters guessed in its comment), you have a true float value, and you just want to make sure it is a real number and neither an infinite value nor a NaN (Not a Number) value.", "So provided you include ", " (or ", ") you can use the C classifications macros to determine whether the number is finite (but subnormal values are allowed) or normal (even subnormal values are rejected):", "(more references on IEEE-754 representation of floating point numbers on ", ")"], "question_code": ["msg.data", "ostringstream", "void scan_cb(const sensor_msgs::LaserScan::ConstPtr& scan)\n{\nfloat dist = 0.0f;\n\nstd::ostringstream s;\ns << scan->ranges[0]; // can be string (always \"inf\") or a float\nif(s.str() != \"inf\"){\n    dist += scan->ranges[0];\n}\n...\n", "range[x]", "msg.data", "NaN", "msg"], "answer_code": ["scan->ranges", "dist", "ranges[0]", "inf", "cmath", "math.h", "void scan_cb(const sensor_msgs::LaserScan::ConstPtr& scan)\n{\nfloat dist = 0.0f;\n\nif(isfinite(scan->ranges[0])){\n    dist += scan->ranges[0];\n}\n...\n"], "url": "https://stackoverflow.com/questions/40604994/most-efficient-way-to-check-if-object-is-a-string"}
,{"title": "How to convert a cv::Mat into a sensor_msgs in ros?", "time": "2014-11-22 17:05:45Z", "post_content": ["I am trying to convert a cv::Mat into a sensor_msgs so that I can publish this in ROS.", "my code is just like this :", "I have tried two potential solutions :", "[1] using cv_bridge, CvImagePtr and toImageMsg(), but the CvImagePtr report ", "assert(px!0) error, which I guess means that I have to initialize CvImagePtr.", "But I don't know how to initialize it;", "[2] using fillImage and sensor_msgs::Image,", "but the sixth parameter of fillImage has to be a void* instead of a Mat*", "Hope anyone could help me !", "Is there an efficient way to convert cv::Mat(or IplImage) to sensor_msgs ?", "THX in advance !"], "answer": ["Using image_transport: ", "Using cv_bridge interface and setting the header by hand", "Use the following code", "I think the best shot for you is to read the ROS tutorial ", ":", "This tutorial describes how to interface ROS and OpenCV by converting ROS images into OpenCV images, and vice versa, using cv_bridge. Included is a sample node that can be used as a template for your own node."], "quote": ["This tutorial describes how to interface ROS and OpenCV by converting ROS images into OpenCV images, and vice versa, using cv_bridge. Included is a sample node that can be used as a template for your own node."], "question_code": ["while(ros::ok())\n        {\n                capture >> frame;\n                cv::imshow(\"Preview\" , frame);\n                cv::waitKey(1);\n                //sensor_msgs::Image img_;\n                //fillImage(img_ , \"rgb8\" , frame.rows , frame.cols , 3 * frame.cols , frame);\n                //img_header.stamp = ros::Time::now();\n                //cv_bridge::CvImagePtr cv_ptr;\n                //cv_ptr->image = frame;\n                //image_pub_.publish(img_);\n                ros::spinOnce();\n        }\n"], "answer_code": ["#include <sensor_msgs/Image.h>\n#include <sensor_msgs/image_encodings.h>\n#include <cv_bridge/cv_bridge.h>\n\ncv::Mat img; // << image MUST be contained here\ncv_bridge::CvImage img_bridge;\nsensor_msgs::Image img_msg; // >> message to be sent\n\nstd_msgs::Header header; // empty header\nheader.seq = counter; // user defined counter\nheader.stamp = ros::Time::now(); // time\nimg_bridge = cv_bridge::CvImage(header, sensor_msgs::image_encodings::RGB8, img);\nimg_bridge.toImageMsg(img_msg); // from cv_bridge to sensor_msgs::Image\npub_img.publish(img_msg); // ros::Publisher pub_img = node.advertise<sensor_msgs::Image>(\"topic\", queuesize);\n"], "url": "https://stackoverflow.com/questions/27080085/how-to-convert-a-cvmat-into-a-sensor-msgs-in-ros"}
,{"title": "how to read generator data as numpy array", "time": "2017-10-31 16:39:47Z", "post_content": ["I'm trying to convert the laser data into pointcloud2 data, and then display them using matplotlib.pyplot. I tried traversing individual points in the generator but it takes a long time. Instead I'd like to convert them into a numpy array and then plot it. How do I go about doing that?"], "answer": ["Take a look at some of these other posts which seem to answer the basic question of \"convert a generator to an array\":", "Without knowing exactly what your generator is returning, the best I can do is provide a somewhat generic (but not particularly efficient) example:", "Output:", "Again though, I cannot comment on the efficiency of this. You mentioned that it takes a long time to plot by reading points directly from the generator, but converting to a Numpy array will still require going through the whole generator to get the data. It would probably be much more efficient if the laser to pointcloud implementation you are using could provide the data directly as an array, but that is a question for the ROS Answers forum (I notice you ", ")."], "question_code": ["def laser_callback(self, laserMsg):\n     cloud = self.laser_projector.projectLaser(laserMsg)\n     gen = pc2.read_points(cloud, skip_nans=True, field_names=('x', 'y', 'z'))\n     self.xyz_generator = gen\n     print(gen)\n"], "answer_code": ["#!/usr/bin/env -p python\n\nimport numpy as np\n\n# Sample generator of (x, y, z) tuples\ndef my_generator():\n    for i in range(10):\n        yield (i, i*2, i*2 + 1)\n        i += 1\n\ndef gen_to_numpy(gen):\n    return np.array([x for x in gen])\n\ngen = my_generator()\narray = gen_to_numpy(gen)\n\nprint(type(array))\nprint(array)\n", "<class 'numpy.ndarray'>\n[[ 0  0  1]\n [ 1  2  3]\n [ 2  4  5]\n [ 3  6  7]\n [ 4  8  9]\n [ 5 10 11]\n [ 6 12 13]\n [ 7 14 15]\n [ 8 16 17]\n [ 9 18 19]]\n"], "url": "https://stackoverflow.com/questions/47040359/how-to-read-generator-data-as-numpy-array"}
,{"title": "Loading a set of messages from rosbag into Matlab", "time": "2019-03-08 20:00:06Z", "post_content": ["I am curious if there's a better way to load information from ROS bag files into Matlab.", "My current work flow is:", "When having to load a lot of different message sets this becomes very cumbersome. I'm not sure how to pull sets of messages from the timerseries, for example I can pull the angular velocity of just one axis by writing:", "I would ideally like to write something like:", "and pull all of the angular velocity messages from the topic (x,y, and z) but I'm not sure if it is possible nor how to do it?"], "answer": ["I am assuming you are trying to get ROSBAG data into Matlab.  In our experience with IMU messages we found the matlab toolbox very slow, so forked some existing code to develop something that works efficiently for us.  It is a bit cumbersome, but once you add your own definitions, this code works super fast.  We could process bags in 10secs which might have taken 10 mins with Matlab toolbox.  Basically it is written in C++ with hard coded message definations and uses Matlab's mex module to convert directly to a .mat file.  Hope you find it useful - "], "question_code": ["bag = rosbag(FILE_LOCATION)\nbagSel = select(bag,'Topic','/mavros/imu/data')\nX_imu_raw = timeseries(bagSel)\nt_imu_angvel = X_imu_raw.Time - bag.StartTime\nX_imu_angvel = X_immu_raw.Data(:,8:10) % indices of X,Y, and Z\n", "timeseries(bagSel,'AngularVelocity.X')\n", "timeseries(bagSel,'AngularVelocity')\n"], "url": "https://stackoverflow.com/questions/55048556/loading-a-set-of-messages-from-rosbag-into-matlab"}
,{"title": "Vectorization of pcl_ros::transformPointCloud", "time": "2018-05-13 11:52:03Z", "post_content": ["I just noticed that the function ", " is not vectorized. Below is the code snippet copied from ", ".", "The code above iterated over each point in the point cloud and multiply the transformation with it.", "I am looking for suggestions to implement/incorporate the same. I am using ROS Indigo (PCL 1.7.1) on Ubuntu 14.04 LTS PC."], "answer": ["Assuming ", ", ", ", and ", " are ", ", ", " and ", " and you don't care about all the special case handling of non-finite data, etc, you can simplify the inner loop to something like this:", " would be ", " and ", " and ", " would be the corresponding ", " members. Minor possible improvement: You can copy ", " into a local variable so it does not need to be loaded from memory every time.", "If ", " is a multiple of ", " you could also reduce this to a single assignment, using ", ", etc. However, this usually generates less efficient code than the version above (may change in future versions of Eigen)."], "question_code": ["void transformPointCloud(\n    const Eigen::Matrix4f& transform, \n    const sensor_msgs::PointCloud2& in,\n    sensor_msgs::PointCloud2& out)\n{\n    int x_idx = pcl::getFieldIndex(in, \"x\");\n    int y_idx = pcl::getFieldIndex(in, \"y\");\n    int z_idx = pcl::getFieldIndex(in, \"z\");\n\n    Eigen::Array4i xyz_offset(\n        in.fields[x_idx].offset, \n        in.fields[y_idx].offset, \n        in.fields[z_idx].offset, 0);\n\n    // most of the code is not shown here\n\n    for (size_t i = 0; i < in.width * in.height; ++i)\n    {\n        Eigen::Vector4f pt(*(float*)&in.data[xyz_offset[0]], \n                           *(float*)&in.data[xyz_offset[1]],\n                           *(float*)&in.data[xyz_offset[2]], 1);\n        Eigen::Vector4f pt_out;\n        pt_out = transform * pt;\n    }\n\n    memcpy(&out.data[xyz_offset[0]], &pt_out[0], sizeof(float));\n    memcpy(&out.data[xyz_offset[1]], &pt_out[1], sizeof(float));\n    memcpy(&out.data[xyz_offset[2]], &pt_out[2], sizeof(float));\n\n    xyz_offset += in.point_step;\n}\n", "transform", "transform * in", "transformPointCloud"], "answer_code": ["x_idx", "y_idx", "z_idx", "0", "4", "8", "void foo(char* data_out, Eigen::Index N, int out_step, const Eigen::Matrix4f& T, const char* data_in, int in_step)\n{\n    for(Eigen::Index i=0; i<N; ++i)\n    {\n        Eigen::Vector3f::Map((float*)(data_out + i*out_step)).noalias()\n          = (T * Eigen::Vector3f::Map((const float*)(data_in + i*in_step)).homogeneous()).head<3>();\n    }\n}\n", "N", "in.width * in.height", "out_step", "in_step", "point_step", "T", "point_step", "sizeof(float)", "out_stride = out.point_step / sizeof(float)", "void foo2(float* data_out, Eigen::Index N, int out_stride, const Eigen::Matrix4f& T, const float* data_in, int in_stride)\n{\n    Eigen::Matrix3Xf::Map(data_out, 3, N, Eigen::OuterStride<>(out_stride)).noalias()\n     = (T * \n        Eigen::Matrix3Xf::Map(data_in, 3, N, Eigen::OuterStride<>(in_stride))\n            .colwise().homogeneous()\n       ).topRows<3>();\n}\n", "x_idx: 0, y_idx: 1, z_idx: 2", "Eigen::Array4i xyz_offset", "xyz_offset[0]: 0, xyz_offset[1]: 4, xyz_offset[2]: 8", "point_step:32", "in", "out", "in.data", "out.data", "uint8[]", "gdb", "Program received signal SIGSEGV, Segmentation fault.", "0x0000000000406a70 in Eigen::internal::gemm_pack_rhs<float, long, 4, 0, false, false>::operator()(float*, float const*, long, long, long, long, long) [clone .constprop.525] ()", "\u2018Index\u2019 is not a member of \u2018Eigen\u2019", "Eigen::Index", "size_t", "Eigen::Index", "eigen3", "(float*)&out.data", "out.data", "(float*)(&out.data[0])"], "url": "https://stackoverflow.com/questions/50315830/vectorization-of-pcl-rostransformpointcloud"}
,{"title": "Recoding (real-time) large-size images on a usb stick with [ROS bag]", "time": "2017-02-10 11:02:44Z", "post_content": ["The quality of the record images is a key importance. Thus am not sure if ", " is relevant to this case, since it is reported that the compressed mode is lossy...", "There should a manner that even when the rostopic stops, the copying on the usb continues. Like this, one will not have frame drops.", "Any advice/solution?", "Note that the image streaming needs to be at a decent frequency."], "answer": ["From your question I assume that your images are too large / arrive too frequently to be able to be written in real-time on your USB stick.", "Depending on your setup/requirements, consider writing the bag to hard disk and copy it over to USB later.", "If you need to write directly to your USB stick, obviously the only solution is to reduce the amount of data to be written. Do not rule out ", " for that. By default it compresses data as JPEG (lossy), but you can switch it to PNG (lossless). Simply start your software and run ", ". For the image transport you should see an entry where you can switch from JPEG to PNG (", "). You should be able to set this value (namespace.format = \"png\") in your launch file, too (", ").", "You could also reduce the image resolution or framerate, if that is acceptable. In combination with PNG compression, this would be your best bet.", "If you don't want to compress as lossless PNG, another (less efficient) option is to have rosbag store compressed data (", " will not consume much CPU, but will not yield the best compression results; ", " will save more space but may impact your real-time requirements depending on your CPU and load)"], "question_code": ["rosbag record /camera/image_raw/compressed"], "answer_code": ["/camera/image_raw/compressed", "rosrun rqt_reconfigure rqt_reconfigure", "--lz4", "--bz2"], "url": "https://stackoverflow.com/questions/42157782/recoding-real-time-large-size-images-on-a-usb-stick-with-ros-bag"}
,{"title": "Messages size of sensor_msgs.image/compressedImage type will changed when publish/subscriber in ROS-Android?", "time": "2017-08-24 06:37:01Z", "post_content": ["I need to get the ", " from ", " and publish it by ", ", and here is my sample-code:", "And then, I had subscribed the ", ", just to check if the messages had been published completely and correctly. Just like the following code did:", "I'm so confused about the number of ", ". It's means the size of image-bytes had changed after packaged and published by ROS, and if I don't set the offset there're will be wrong to decode a bitmap. And more strangely, sometimes the number of offset had a change too.", "I don't know why, and I had read some articles about the ", " structure, and suspect that it's maybe the ", " of the jpg byte  messages. However, this problem just happen in ", " scene.", "Anyone have a good idea about this? ", "OK! I know that the question I asked and problem described previously is terrible, that's why it got 2 negative-points. I'm so sorry about these, and I have to make up my fault by telling you guys more information, and making the problem more clear now.", "At first, forget about all the code I pasted before. The problem happened in my ", " project. In this project, I need to send the sensor messages of compressed image type to ros-server and get the processed image-bytes(jpg format) in publish/subscribe way. And in theory, the size of the image-bytes should be same, and in fact, this had been proved in my ", " and ", " project under same conditions. ", "However, they're different in ros-android, it's get bigger! For this reason, I can't just decode a bitmap from the image bytes which I had subscribed, and I have to leave out the excrescent bytes with a ", " in the image byte array. I don't know why this happened in ros-android or ros-java, and what's these adding part.", "I can't find the reason from my code, that's why I pasted my code in detail for you. I really need help! Thanks in advance!"], "answer": ["Maybe I really need to check the API first before ask question here. This's a so simple question if I had check the properties of ", " in API, cause the property ", " had already told me the answer of this question!", "Well, for the sake of be more cautious and somebody of you guys need a clarification of my answer, so I have to make an explanation in details!", "At first, I have to say that, I still don't know how the ", " package the data of ", ", that's means I still don't know why there're should have the ", " before the array data. Why we can't just get data? Is there really some important reasons for the being of the ", "? For the sake of safety, or efficiency? I don't know, I can't find an answer from the API. So I'm really tired of this question now, and I'm tired of whether you guys make a negative point of this question or not, just let it go!", "Hark back to the subject, the problem can be solved in this way:", "OK! I'm still hope that someone who have good knowledge of this can tell me why, I'll be so appreciate of this! If you guys are just tired of this question like me, so just let's vote to close it, I'll be appreciate it too! Thanks anyway!"], "question_code": ["@Override\npublic void onPreviewFrame(byte[] data, Camera camera) {\n    if(data != null){\n        Camera.Size size = camera.getParameters().getPreviewSize();\n        YuvImage yuvImage = new YuvImage(data, ImageFormat.NV21, size.width, size.height, null);\n\n        if(yuvImage != null){\n            ByteArrayOutputStream baos = new ByteArrayOutputStream();\n            ChannelBufferOutputStream stream = new ChannelBufferOutputStream(MessageBuffers.dynamicBuffer());\n\n            yuvImage.compressToJpeg(new Rect(0, 0, yuvImage.getWidth(), yuvImage.getHeight()), 80, baos);\n            yuvImage = null;\n\n            stream.buffer().writeBytes(baos.toByteArray());\n            try{\n                baos.flush();\n                baos.close();\n                baos = null;\n            }\n            catch(IOException e){\n                e.printStackTrace();\n            }\n\n            // compressedImage type\n            sensor_msgs.CompressedImage compressedImage = compressedImagePublisher.newMessage();\n            compressedImage.getHeader().setFrameId(\"xxx\");    // frame id\n\n            Time curTime = connectedNode.getCurrentTime();    \n            compressedImage.getHeader().setStamp(curTime);    // time\n\n            compressedImage.setFormat(\"jpeg\");                // format\n            compressedImage.setData(stream.buffer().copy());  // data\n\n            stream.buffer().clear();\n            try {\n                stream.flush();\n                stream.close();\n                stream = null;\n            }\n            catch (IOException e) {\n                e.printStackTrace();\n            }\n\n            // publish\n            System.out.println(\"-----Publish: \" + compressedImage.getData().array().length + \"-----\");\n            compressedImagePublisher.publish(compressedImage);\n            compressedImage = null;\n            System.gc();\n        }\n        else{\n            Log.v(\"Log_Tag\", \"-----Failed to get yuvImage!-----\");\n        }\n    }\n    else{\n        Log.v(\"Log_Tag\", \"-----Failed to get the preview frame!-----\");\n    }\n}\n", "@Override\npublic void onStart(ConnectedNode node) {\n    this.connectedNode = node;\n\n    // publisher\n    this.compressedImagePublisher = connectedNode.newPublisher(topic_name, sensor_msgs.CompressedImage._TYPE);\n    // subscriber\n    this.compressedImageSubscriber = connectedNode.newSubscriber(topic_name, sensor_msgs.CompressedImage._TYPE);\n    compressedImageSubscriber.addMessageListener(new MessageListener<CompressedImage>() {\n        @Override\n        public void onNewMessage(final CompressedImage compressedImage) {\n            byte[] receivedImageBytes = compressedImage.getData().array();\n            if(receivedImageBytes != null && receivedImageBytes.length != 0) {\n                System.out.println(\"-----Subscribe(+46?): \" + receivedImageBytes.length + \"-----\");\n\n                // decode bitmap from byte[] with a strange number of offset and necessary\n                Bitmap bmp = BitmapFactory.decodeByteArray(receivedImageBytes, offset, receivedImageBytes.length - offset);\n                ...    \n            }\n        }\n    });\n}\n"], "answer_code": ["int offset = compressedImage.getData().arrayOffset();\nBitmap bmp = BitmapFactory.decodeByteArray(receivedImageBytes, offset, receivedImageBytes.length - offset);\n"], "url": "https://stackoverflow.com/questions/45755189/messages-size-of-sensor-msgs-image-compressedimage-type-will-changed-when-publis"}
,{"title": "Writing a ros node with both a publisher and subscriber?", "time": "2016-11-20 15:43:45Z", "post_content": ["I am currently trying to make a ROS node in Python which has both a subscriber and a publisher.", "I've seen examples where a message is published within the callback, but I want it to \"constantly\" publish messages, and perform callbacks when it is the case. ", "Here is how I do it now: ", "So where should I publish?"], "answer": ["Simply replace ", " with the following loop:", "Of course you can adjust the sleep duration to whatever value you want (or even remove it entirely).", "According to ", " subscribers in rospy are running in a separate thread, so you don't need to call spin actively.", "Note that in roscpp (i.e. when using C++) this is handled differently. There you have to call ", " in the while loop.", "Well, I think there's a lot of solutions here, you could even make use of a python process, but what I'm proposing is a ROS approach using a ", ".", "I am not really that efficient in python but this code may gave you a heads up.", "Here, your callback will update the message and your timer will fire up every 0.5sec and publishes the last data received.", "you can test this code by publishing data on \"/contriol_c\" every 3 seconds and configuring you timer to 0.5 sec. start an echo on /status ", "and you'll got your message published on a 2 Hz rate. ", "Hope that helps !"], "question_code": ["#!/usr/bin/env python\n\nimport rospy\nfrom std_msgs.msg import Empty\nfrom std_msgs.msg import String\nimport numpy as np\n\npub = rospy.Publisher('/status', String, queue_size=1000)\n\ndef callback(data):\n    print \"Message received\"\n\ndef listener():\n\n    rospy.init_node('control', anonymous=True)\n\n    rospy.Subscriber('control_c', Empty, callback)\n    rospy.spin()\n\nif __name__ == '__main__':\n    print \"Running\"\n    listener()\n"], "answer_code": ["rospy.spin()", "while not rospy.is_shutdown():\n    # do whatever you want here\n    pub.publish(foo)\n    rospy.sleep(1)  # sleep for one second\n", "ros::spinOnce()", "pub", "sub", "pub", "callback", "pub", "callback", "self.pub", "#!/usr/bin/env python\n\nimport rospy\nfrom std_msgs.msg import Empty\nfrom std_msgs.msg import String\nimport numpy as np\n\nlast_data = \"\"\nstarted = False\npub = rospy.Publisher('/status', String, queue_size=1000) \n\ndef callback(data):\n    print \"New message received\"\n    global started, last_data\n    last_data = data\n    if (not started):\n        started = True\n\ndef timer_callback(event):\n    global started, pub, last_data\n    if (started):\n        pub.publish(last_data)\n        print \"Last message published\"\n\n\ndef listener():\n\n    rospy.init_node('control', anonymous=True)\n\n    rospy.Subscriber('control_c', String, callback)\n    timer = rospy.Timer(rospy.Duration(0.5), timer_callback)\n\n    rospy.spin()    \n    timer.shutdown()\n\nif __name__ == '__main__':\n    print \"Running\"\n    listener()\n", "$ rostopic echo /status\n", "pub", "sub", "pub", "callback"], "url": "https://stackoverflow.com/questions/40508651/writing-a-ros-node-with-both-a-publisher-and-subscriber"}
,{"title": "Using UDP transport data to Non-ROS computer over UDP", "time": "2016-01-02 13:26:16Z", "post_content": ["I want to transport the data from a ROS computer  to the Non-ROS computer over the UDP.", "To specify my works now : ", "I have a LiDAR(Sick TiM561) and I can launch it by the ROS computer successfully, and I can use the \"Subscriber\" to get the data of the LiDAR now using roscpp which is the c++ code in the ROS. Now,I need to transport the LiDAR's data to the ", " which is a MATLAB-based computer (this PC that you can build your program in it by MATLAB). But I'm not familiar in the c++ code, could someone can suggest me or direct me how to modify the code as below and add it into my roscpp code? Thanks in advance!", "For the structure, the Micro box is the client, ROS PC is server.\nThis is the code of my roscpp:", "And this code maybe is what I need:"], "answer": ["I'd think a possible way to go for you is to check out the ", " implementations. I'm not familiar with development for microbox, probably none of the rosserial supported platforms works with it out of the box, but I thought it's what the rosserial for: to provide a ros-compliant ", " for communicating a ros server with non-ros devices. For that your ros-nodes' code don't even need to know if the client's publishers and/or subscribers are regular ros nodes running on a ros-running computer or they are mimicked by a ", " on a non-ros device.", "When I used it, the efficiency of ", " was good for me. I was able to control a rather high resolution camera attached to a windows computer connected to a network with several ros running computers to transfer image messages from the camera with a satisfiable rate.", "If none of the available rosserial implementations are compatible with microbox then you may want to check out the rosserial's \"", "\" and the existing code for ", " to implement the rosserial-like connection thru udp. "], "question_code": ["#include \"ros/ros.h\"\n#include \"std_msgs/String.h\"\n#include \"sensor_msgs/LaserScan.h\"\nvoid laser_msg_Callback(const sensor_msgs::LaserScan::ConstPtr& scan)\n{\nfor (int x=0;x< scan->ranges.size();x++)\n{\n  ROS_INFO(\"I heard: [%f]\", scan->ranges[x]);\n}\n}\nint main(int argc, char **argv)\n{\nros::init(argc, argv, \"sick_listener\");\nros::NodeHandle n;\nros::Subscriber sub = n.subscribe(\"scan\", 811, laser_msg_Callback);\nros::spin();\nreturn 0;\n}\n", "UdpClient client;\npublic IPAddress serverIP = IPAddress.Parse(\"140.124.35.1\");\npublic Form1()\n{\n    InitializeComponent();\n    client = new UdpClient();\n}\n\npublic void SendData()\n{\n    client.Connect(serverIP, 3000);\n    byte[] data = Encoding.ASCII.GetBytes(\"Hi, I'm new client.\");\n    client.Send(data, data.Length);\n    DoListening();\n}\npublic void DoListening()\n{\n    IPEndPoint adress = new IPEndPoint(serverIP, 3000);\n    byte[] receivedbytes = client.Receive(ref adress);\n    string recieved = Encoding.ASCII.GetString(receivedbytes);\n\n    MessageBox.Show(\"Recieved: \" + recieved);\n}\nprivate void button1_Click(object sender, EventArgs e)\n{\n    SendData();\n}\n"], "url": "https://stackoverflow.com/questions/34564842/using-udp-transport-data-to-non-ros-computer-over-udp"}
,{"title": "Setting values in large tuples efficiently", "time": "2017-09-22 17:44:54Z", "post_content": ["I am using ROS and I am currently trying to munipulate a costmap, so essentially I am wanting to change individual values in a tuple that has a length in this situation of approaching 7 digits.", "See ", "Originally I tried just turning this long tuple into a list then changing the values and then turning this back into a tuple, as you can imagine this extremely inefficient. I need this to be able to run quickly as it needs to update the costmap often for dynamic object avoidance.", "Is there a way that I can change individual values in a tuple efficiently?"], "answer": ["Sadly, this is simply a limitation of ROS's ", ". Array-like structures are always deserialized as ", " for performance reasons, except for lists of ", " for some reason. And ", " is immutable.", "However, if you were in C++ space, you would be receiving a ", " anyway, so it would still be just as immutable. Or you could have registered the callback as ", " and get pass-by-value, but you're just moving the copy to method-call-time. There's no avoiding the copy if you intend on modifying the grid, wether you're in Python or C++.", "There is no need to convert back to tuple however, ROS's python message serialization accepts either ", " or ", ".", "You can gain quite a bit of efficiency as well if you can do some of your processing work during that copy (saves an iteration over the grid). Though I don't know exactly what you're trying to do, so I don't know the feasibility of that.", "The fact that tuples are immutable is supposed to be ", ".\nSo if you need to make changes, the data probably ought not to be in tuple form in the first place.\nCan't you have a list from begin to end? (I do not know ROS)", "If that is impossible, I'd say you either have a serious problem with the software design or you are trying to solve the wrong problem."], "answer_code": ["tuple", "bool", "tuple", "const OccupancyGridConstPtr&", "OccupancyGrid message", "list", "tuple", "const Vector&"], "url": "https://stackoverflow.com/questions/28861303/setting-values-in-large-tuples-efficiently"}
,{"title": "How to call a C++ function from a python (py) file?", "time": "2019-07-22 22:51:25Z", "post_content": ["I am aware of the boost python library but what I need is to call a C++ function which is in a cpp file from a python file (py). Here is a simple python code that moves the arm of the PR2 robot.", "The following code is in a py file", "Here is my c++ code in cpp file", "What I am trying to do here is I am trying to open and close the gripper of the robot by calling OpenGripper and closedGripper functions. These functions are being called within the cpp file from opGripper and closGripper functions. So, I need to call the opGripper and closGripper functions from the python file so that they are executed from the C++ file and do whatever necessary. How do I do that?"], "answer": ["What I would do is wrap your C++ code in a node that exposes open and close gripper services. ", "You can call the service from your python code or any other ROS code in any language. The behavior isn't as efficient as calling raw C++ but you are already calling it from python so the latency will be negligible. It will behave as if you are calling the function directly, because your code will block until the service returns. Also you will be able to keep these interfaces language independent, which makes things easier to maintain."], "question_code": ["#!/usr/bin/env python\n\nimport sys\nimport copy\nimport rospy\nimport roscpp\nimport moveit_commander\nimport moveit_msgs.msg\nimport geometry_msgs.msg\nfrom geometry_msgs.msg import PoseStamped\nimport tf\nimport roslib\nimport traceback\n\n\ndef move_group_python_interface_tutorial():\n  ## Initialize moveit commander\n  print \"============ Starting setup\"\n  moveit_commander.roscpp_initialize(sys.argv)\n  rospy.init_node('move_group_python_interface_tutorial',\n              anonymous=True)\n\n  ## Instantiate a RobotCommander object.  This object is an interface to\n  ## the robot as a whole.\n  scene = moveit_commander.PlanningSceneInterface()\n  robot = moveit_commander.RobotCommander()\n\n  rospy.sleep(2)\n\n  group = moveit_commander.MoveGroupCommander(\"right_arm\")\n\n\n  display_trajectory_publisher = rospy.Publisher(\n                                  '/move_group/display_planned_path',\n                                  moveit_msgs.msg.DisplayTrajectory)\n\n  ## Wait for RVIZ to initialize. This sleep is ONLY to allow Rviz to come up.\n  print \"============ Waiting for RVIZ...\"\n  rospy.sleep(10)\n\n # I want to call the openGripper() function here\n\n  print \"============ Generating plan 1\"\n\n  #[ 0.5, -0.5, 0.5, 0.5 ]\n  pose_source = geometry_msgs.msg.Pose()\n  pose_source.orientation.x = 0.5\n  pose_source.orientation.y = 0.5\n  pose_source.orientation.z = 0.5\n  pose_source.orientation.w = 0.5\n  pose_source.position.x = 0.68\n  pose_source.position.y = -0.01\n  pose_source.position.z = 1.1\n  #group.set_planning_time(10);\n\n\n  group.set_pose_target(pose_source)\n\n\n  ## Now, we call the planner to compute the plan\n  ## and visualize it if successful\n  ## Note that we are just planning, not asking move_group \n  ## to actually move the robot\n\n  plan1 = group.plan()\n\n  print \"============ Waiting while RVIZ displays plan1...\"\n  rospy.sleep(5)\n\n  # Uncomment below line when working with a real robot\n\n  group.go(wait=True)\n\n  # I want to call the closedGripper() function here\n\n\n  group.clear_pose_targets()\n\n\n  ## When finished shut down moveit_commander.\n  moveit_commander.roscpp_shutdown()\n\n  print \"============ STOPPING\"\n\n\nif __name__=='__main__':\n  try:\n    move_group_python_interface_tutorial()\n  except rospy.ROSInterruptException:\n    pass\n", "#include <ros/ros.h>\n\n// MoveIt!\n#include <moveit/planning_scene_monitor/planning_scene_monitor.h>\n#include <moveit/move_group_interface/move_group.h>\n#include <geometric_shapes/solid_primitive_dims.h>\n#include <string>\n#include <unistd.h>\n//#include <vector>\n\n//static const std::string ROBOT_DESCRIPTION=\"robot_description\";\n\nopGripper(){\n  //std::vector<moveit_msgs::Grasp> grasps;\n  moveit_msgs::Grasp g;\n  g.pre_grasp_approach.direction.vector.x = 1.0;\n  g.pre_grasp_approach.direction.header.frame_id = \"r_wrist_roll_link\";\n  g.pre_grasp_approach.min_distance = 0.2;\n  g.pre_grasp_approach.desired_distance = 0.4;\n\n  g.post_grasp_retreat.direction.header.frame_id = \"base_footprint\";\n  g.post_grasp_retreat.direction.vector.z = 1.0;\n  g.post_grasp_retreat.min_distance = 0.1;\n  g.post_grasp_retreat.desired_distance = 0.25;\n  openGripper(g.pre_grasp_posture);\n}\n\nclosGripper(){\n\n  moveit_msgs::Grasp h;\n  h.pre_place_approach.direction.vector.z = -1.0;\n  h.post_place_retreat.direction.vector.x = -1.0;\n  h.post_place_retreat.direction.header.frame_id = \"base_footprint\";\n  h.pre_place_approach.direction.header.frame_id = \"r_wrist_roll_link\";\n  h.pre_place_approach.min_distance = 0.1;\n  h.pre_place_approach.desired_distance = 0.2;\n  h.post_place_retreat.min_distance = 0.1;\n  h.post_place_retreat.desired_distance = 0.25;\n\n\n  closedGripper(g.grasp_posture);\n}\n\n\nvoid openGripper(trajectory_msgs::JointTrajectory& posture){\n\n  posture.joint_names.resize(6);\n  posture.joint_names[0] = \"r_gripper_joint\";\n  posture.joint_names[1] = \"r_gripper_motor_screw_joint\";\n  posture.joint_names[2] = \"r_gripper_l_finger_joint\";\n  posture.joint_names[3] = \"r_gripper_r_finger_joint\";\n  posture.joint_names[4] = \"r_gripper_r_finger_tip_joint\";\n  posture.joint_names[5] = \"r_gripper_l_finger_tip_joint\";\n\n  posture.points.resize(1);\n  posture.points[0].positions.resize(6);\n  posture.points[0].positions[0] = 1;\n  posture.points[0].positions[1] = 1.0;\n  posture.points[0].positions[2] = 0.477;\n  posture.points[0].positions[3] = 0.477;\n  posture.points[0].positions[4] = 0.477;\n  posture.points[0].positions[5] = 0.477;\n }\n\nvoid closedGripper(trajectory_msgs::JointTrajectory& posture){\n  posture.joint_names.resize(6);\n  posture.joint_names[0] = \"r_gripper_joint\";\n  posture.joint_names[1] = \"r_gripper_motor_screw_joint\";\n  posture.joint_names[2] = \"r_gripper_l_finger_joint\";\n  posture.joint_names[3] = \"r_gripper_r_finger_joint\";\n  posture.joint_names[4] = \"r_gripper_r_finger_tip_joint\";\n  posture.joint_names[5] = \"r_gripper_l_finger_tip_joint\";\n\n  posture.points.resize(1);\n  posture.points[0].positions.resize(6);\n  posture.points[0].positions[0] = 0;\n  posture.points[0].positions[1] = 0;\n  posture.points[0].positions[2] = 0.002;\n  posture.points[0].positions[3] = 0.002;\n  posture.points[0].positions[4] = 0.002;\n  posture.points[0].positions[5] = 0.002;\n}\n"], "url": "https://stackoverflow.com/questions/57154680/how-to-call-a-c-function-from-a-python-py-file"}
,{"title": "Data structure to store a grid (that will have negative indices)", "time": "2019-08-27 13:43:08Z", "post_content": ["I'm studying robotics at the university and I have to implement on my own SLAM algorithm. To do it I will use ROS, Gazebo and C++.", "I have a doubt about what data structure I have to use to store the map (and what I'm going to store it, but this is another story).", "I have thought to represent the map as a 2D grid and robot's start location is (0,0). But I don't know where exactly is the robot on the world that I have to map. It could be at the top left corner, at the middle of the world, or in any other unknonw location inside the world.", "Each cell of the grid will be 1x1 meters. I will use a laser to know where are the obstacles. Using current robot's location, I will set to 1 on all the cells that represent an obstacle. For example, it laser detects an obstacle at 2 meters in front of the robot, I will set to 1 the cell at (0,2).", "Using a vector, or a 2D matrix, here is a problem, because, vector and matrices indices start at 0, and there could be more room behind the robot to map. And that room will have an obstacle at (-1,-3).", "On this data structure, I will need to store the cells that have an obstacle and the cells that I know they are free.", "Which kind of data structure will I have to use?", "The process to store the map will be the following:", "The robot will detect the obstacles that are in front of it and to the sides, but never behind it.", "My problem comes when the robot detects an obstacle on a negative cell (like (0,-1). I don't know how to store that obstacle if I have previously stored only the obstacle on \"positive\" cells. So, maybe the \"offset\", it is not a solution here (or maybe I'm wrong)."], "answer": ["This is where you can write a ", " to help you:", "The options you have:", "You can use a ", " to represent a grid layout by using a ", " class you create. It contains a ", " and ", " variable and can therefore be used to intuitively be used to find points inside the grid. You can also use a ", " if you want to store information about a certain location inside the grid.", "Please don't forget to fulfill the C++ named requirements for ", "/", " such as ", " if you don't want to provide a comparison operator externally.", "example:\nposition.h", "\nThe above class was used by me in a similar setting and we used a ", " defined as: ", "To store if we had found any walls at a certain position.\n", "\nBy using this ", " based method you avoid having to do math to know what offset you have to have inside an 2D array (or some structure like that). It also allows you to move freely as there is no chance that you'll travel outside of the predefined bounds you set at construction. This structure is also more space efficient against a 2D array as this structure only saves the areas where the robot has been. This is also a C++ way of doing things: relying on the STL instead of creating your own 2D map using C constructs.", "With offset solution (translation of values by fixed formula (we called it \"mapping function\" in math class), like doing \"+50\" to all coordinates, i.e. [-30,-29] will become [+20,+21] and [0,0] will become [+50,+50] ) you still need to have idea what is your maximum size.", "In case you want to be dynamic like ", " going from 0 to some N (as much as free memory allows), you can create more complex mapping function, for example map(x) = x*2 when (0 <= x) and x*(-2)-1 when (x < 0) ... this way you can use standard ", " and let it grow as needed by reaching new maximum coordinates.", "With 2D grid vs ", " this is a bit more complicated as vector of vectors is sometimes not the best idea from performance point of view, but as long as your code can prefer shortness and simplicity over performance, maybe you can use the same mapping for both coordinates and use vector of vectors (using ", " on all of them with some reasonable default to avoid resizing of vectors in common use cases, like if you know the 100m x 100m area will be usual maximum, you can reserve everything to capacity 201 initially to avoid vector resizing for common situations, but it can still grow infinitely (until heap memory is exhausted) in less common situations.", "You can also add another mapping function converting 2D coordinates to 1D and use single vector only, and if you want really complicate things, you can for example map those 2D into 0,1,2,... sequence growing from area around center outward to save memory usage for small areas... you will probably easily spend 2-4 weeks on debugging it, if you are kinda fresh to C++ development, and you don't use unit testing and TDD approach (I.e. just go by simple vector of vectors for a start, this paragraph is JFYI, how things can get complicated if you are trying to be too smart :) ).", "Class     robotArray", "{", "Int* left,right;", "}", "RobotArray::RobotArray ()", "{", "Int* a=new int [50][50];", "Int* b=new int[50][50];", "//left for the -ve space and right for the positive space with", "0,0 of the two arrays removed", "Left=a+1;", "Right=b+1;", "}", "I think I see what you are after here: you don't know how big the space is, or even what the coordinates may be. ", "This is very general, but I would create a class that holds all of the data using vectors (another option -- vector of pairs, or vector of Eigen (the library) vectors).  As you discover new regions, you'll add the coordinates and occupancy information to the Map (via AddObservation(), or something similar).  ", "Later, you can determine the minimum and maximum x and y coordinates, and create the appropriate grid, if you like. "], "question_code": ["[i-OFFSET]"], "answer_code": ["class", "class RoboArray \n{\n     constexpr int width_ = ...\n     constexpr int height_ = ...\n     Cell grid_[width_ * 2][height_ * 2];\n     ...\n public:\n     ...\n     Cell get(int x, int y) // can make this use [x][y] notation with a helper class\n     {\n           return grid_[x + width_][y + height];\n     }\n     ...\n}\n", "std::set", "position", "x", "y", "std::map", "set", "map", "/* this class is used to store the position of things\n * it is made up by a horizontal and a vertical position.\n */\nclass position{\nprivate:\n    int32_t horizontalPosition;\n    int32_t verticalPosition;\npublic:\n    position::position(const int hPos = 0,const int vPos = 0) : horizontalPosition{hPos}, verticalPosition{vPos}{}\n    position::position(position& inputPos) : position(inputPos.getHorPos(),inputPos.getVerPos()){}\n    position::position(const position& inputPos) : position((inputPos).getHorPos(),(inputPos).getVerPos()){}\n\n    //insertion operator, it enables the use of cout on this object: cout << position(0,0) << endl;\n    friend std::ostream& operator<<(std::ostream& os, const position& dt){\n        os << dt.getHorPos() << \",\" << dt.getVerPos();\n        return os;\n    }\n\n    //greater than operator\n    bool operator>(const position& rh) const noexcept{\n        uint64_t ans1 = static_cast<uint64_t>(getVerPos()) | static_cast<uint64_t>(getHorPos())<<32;\n        uint64_t ans2 = static_cast<uint64_t>(rh.getVerPos()) | static_cast<uint64_t>(rh.getHorPos())<<32;\n\n        return(ans1 < ans2);\n    }\n\n    //lesser than operator\n    bool operator<(const position& rh) const noexcept{\n        uint64_t ans1 = static_cast<uint64_t>(getVerPos()) | static_cast<uint64_t>(getHorPos())<<32;\n        uint64_t ans2 = static_cast<uint64_t>(rh.getVerPos()) | static_cast<uint64_t>(rh.getHorPos())<<32;\n\n        return(ans1 > ans2);\n    }\n\n    //equal comparison operator\n    bool operator==(const position& inputPos)const noexcept {\n        return((getHorPos() == inputPos.getHorPos()) && (getVerPos() == inputPos.getVerPos()));\n    }\n\n    //not equal comparison operator\n    bool operator!=(const position& inputPos)const noexcept {\n        return((getHorPos() != inputPos.getHorPos()) || (getVerPos() != inputPos.getVerPos()));\n    }\n\n    void movNorth(void) noexcept{\n        ++verticalPosition;\n    }\n    void movEast(void) noexcept{\n        ++horizontalPosition;\n    }\n    void movSouth(void) noexcept{\n        --verticalPosition;\n    }\n    void movWest(void) noexcept{\n        --horizontalPosition;\n    }\n\n    position getNorthPosition(void)const noexcept{\n        position aPosition(*this);\n        aPosition.movNorth();\n        return(aPosition);\n    }\n    position getEastPosition(void)const noexcept{\n        position aPosition(*this);\n        aPosition.movEast();\n        return(aPosition);\n    }\n    position getSouthPosition(void)const noexcept{\n        position aPosition(*this);\n        aPosition.movSouth();\n        return(aPosition);\n    }\n    position getWestPosition(void)const noexcept{\n        position aPosition(*this);\n        aPosition.movWest();\n        return(aPosition);\n    }\n\n    int32_t getVerPos(void) const noexcept {\n        return(verticalPosition);\n    }\n    int32_t getHorPos(void) const noexcept {\n        return(horizontalPosition);\n    }\n};\n", "std::set<position> gridNoData;\nstd::map<position, bool> gridWithData;\n\ngridNoData.insert(point(1,1));\ngridWithData.insert(point(1,1),true);\n\ngridNoData.insert(point(0,0));\ngridWithData.insert(point(0,0),true);\n\nauto search = gridNoData.find(point(0,0));\nif (search != gridNoData.end()) {\n    std::cout << \"0,0 exists\" << '\\n';\n} else {\n    std::cout << \"0,0 doesn't exist\\n\";\n}\n\nauto search = gridWithData.find(point(0,0));\nif (search != gridWithData.end()) {\n    std::cout << \"0,0 exists with value\" << search->second  << '\\n';\n} else {\n    std::cout << \"0,0 doesn't exist\\n\";\n}\n", "std::map", "std::map<position,directionalState> exploredMap;\n", "std::map", "std::vector<>", "std::vector", "std::vector", "reserve(..)", "class RoboMap{\npublic:\n    vector<int> map_x_coord;\n    vector<int> map_y_coord;\n    vector<bool> occupancy;\n\n    RoboMap();\n\n\n    void AddObservation(int x, int y, bool in_out){\n        map_x_coord.push_back(x);\n        map_y_coord.push_back(y);\n\n        occupancy.push_back(in_out);\n    }\n\n};\n"], "url": "https://stackoverflow.com/questions/57675404/data-structure-to-store-a-grid-that-will-have-negative-indices"}
,{"title": "Delay in Real-Time Reading from Multiple Serial Ports (GPS, through RS232 - USB adapter)", "time": "2019-12-11 03:34:18Z", "post_content": ["At the moment i am working on a ROS system with multiple sensors\nthrough various interfaces. Two of the most important sensors are GPS\nand Gyro that are connected through RS232-USB adapter.", "I would like to emphasize that i am not in anyway familiar or expert\nin serial connections.", "I use python to read the serial data and publish them to ROS-topic and\nsubscribe them via Matlab Simulink. ", "I had been using one GPS and Gyro simultaneously and there were no\nproblem at all (adapters from different manufacturer were used for\neach, let's say, i have 2 RS232-USB adapter manufacturers; TA and TB).", "Due to some purposes, i decided to install an additional GPS (hence 2\nGPS(s) and a Gyro simultaneously were used in real time). Let's say i\nput those 2 GPS quite close; less than 1m.", "Those two GPS have identical serial port setting (same baud rate, same\nparity, same stopbits, same update frequency, etc.) and i used the\nsame RS232-USB adapter TA type for both GPS.", "However, there was a significant delay when subscribing in Matlab\nSimulink (i used simulation data inspection/logger). One of the GPS\nwas late! What i mean by late is that one GPS did not update in real\ntime.", "For example, at t(time)=3, both GPS should be at p(position)=10. But\none GPS reaches p=10 after 40~60 seconds ", " the other GPS; GPS\nwhich is correct (time vs position is real time). Below i attach a graph.", "\n", "I dont know what might have caused this problem, Gyro has no delay\nproblem at all, it seems only those 2 GPS are racing each other to\nsend the data.", "Edit (12/11/2019 12:34 GMT+9)", "Below is my code for one GPS, and for other GPS i simply create a new .py, and use exactly the same code but with different node name and rostopic.", "I used Matlab to subscribe and log all the data from the sensors. At the moment the only calculation that i am doing in Matlab is just a conversion of GPS long/lat data to XY coordinates to get the real time trajectory of my vessel. This conversion is a very simple calculation which i dont think will cause a serious delay.", "If you could give me solution, or even an insight, it would be very\nappreciated.\nThank you very much.", "Warmest regards"], "answer": ["I do not have enough rep to post a comment, so this is not really an answer. There are some issues with the way you have set up your python node. It might appear to be working, but it is definitely doing it quite inefficiently. There might be more issues, but the following issues should be solved:", "Some more notes on the code:"], "quote": ["Edit (12/11/2019 12:34 GMT+9)"], "question_code": ["#!/usr/bin/env python\n\nimport serial\nimport types\nimport re\nimport rospy\nimport time\nimport threading\n\nfrom datetime import datetime\nfrom shipcon.msg import gps_position\nfrom shipcon.msg import gps_local_position\nfrom shipcon.msg import gps_navinfo\nfrom shipcon.msg import gps_time\n\n\n#Constants-----------------------------------------------------------------------------------------\nPUBLISH_RATE = 10 #Hz\nSERIAL_PORT = \"/dev/ttyUSB1\"\nBAUD_RATE = 115200\n\n#Class-----------------------------------------------------------------------------------------\nclass GpsSerial:\n    def __init__(self, serial_port, baud_rate):\n        self.gpsArr = []\n        self.gpsStr = \"\"\n        self.pos = gps_position()\n        self.localpos = gps_local_position()\n        self.navinfo = gps_navinfo()\n        self.time = gps_time()\n        self.ser = serial.Serial(\n            port = serial_port,\n            baudrate = baud_rate,\n            parity = serial.PARITY_NONE,\n            bytesize = serial.EIGHTBITS,\n            stopbits = serial.STOPBITS_ONE,\n            timeout = None,\n            xonxoff = 0, #Enable software flow control\n            rtscts = 0, #Enable Hardware(RTS,CTS) flow control\n            )\n\n    def get_gps(self):\n        self.gpsStr = self.ser.readline()\n        self.gpsArr = self.gpsStr.split(',')\n\n        if re.match(r\"^\\$.*\", self.gpsArr[0]):\n\n            if self.gpsArr[0] == '$PTNL':\n                if self.gpsArr[1] == 'GGK':\n                    self.pos.latitude_deg = int(float(self.gpsArr[4]) // 100)\n                    self.pos.latitude_min = float(self.gpsArr[4])  - (self.pos.latitude_deg * 100)\n                    self.pos.latitude_dir = self.gpsArr[5]\n                    self.pos.longitude_deg = int(float(self.gpsArr[6]) // 100)\n                    self.pos.longitude_min = float(self.gpsArr[6])  - (self.pos.longitude_deg * 100)\n                    self.pos.longitude_dir = self.gpsArr[7]\n                    self.pos.gps_quality = int(self.gpsArr[8])\n                    self.pos.satellite_number = int(self.gpsArr[9])\n                elif self.gpsArr[1] == 'VGK':\n                    if self.gpsArr[4] =='-' or self.gpsArr[4] == '':\n                        pass\n                    else:\n                        self.localpos.localpos_e = float(self.gpsArr[4])#float( re.sub(r'\\+', \"\", self.gpsArr[4]) )\n                    if self.gpsArr[5] =='-' or self.gpsArr[5] == '':\n                        pass\n                    else:\n                        self.localpos.localpos_n = float(self.gpsArr[5])#float( re.sub(r'\\+', \"\", self.gpsArr[5]) )\n                    if self.gpsArr[6] =='-' or self.gpsArr[6] == '':\n                        pass\n                    else:\n                        self.localpos.localpos_z = float(self.gpsArr[6])#float( re.sub(r'\\+', \"\", self.gpsArr[6]) )\n                elif self.gpsArr[1] == 'VHD':\n                    self.localpos.local_azimath = float(self.gpsArr[4])\n                    self.localpos.local_vertical = float(self.gpsArr[6])\n                    self.localpos.local_range = float(self.gpsArr[8])\n\n            elif self.gpsArr[0] == '$GPGST':\n                self.pos.latitude_err = float(self.gpsArr[6])\n                self.pos.longitude_err = float(self.gpsArr[7])\n                self.pos.ellipse_err_maj = float(self.gpsArr[3])\n                self.pos.ellipse_err_min = float(self.gpsArr[4])\n                self.navinfo.truenorth_heading_err = float(self.gpsArr[5])\n\n            elif self.gpsArr[0] == '$GPROT':\n                if self.gpsArr[1] =='-' or self.gpsArr[1] == '':\n                    pass\n                else:\n                    self.navinfo.rotation_rate = float(self.gpsArr[1])\n\n            elif self.gpsArr[0] == '$GPVTG':\n                if self.gpsArr[1] =='' or self.gpsArr[5]=='' or self.gpsArr[7]=='':\n                    pass\n                else:\n                    self.navinfo.truenorth_heading = float(self.gpsArr[1])\n                    self.navinfo.speed_knot = float(self.gpsArr[5])\n                    self.navinfo.speed_km = float(self.gpsArr[7])\n\n            elif self.gpsArr[0] == '$GPZDA':\n                tmptime = datetime.strptime(self.gpsArr[1]+','+self.gpsArr[4]+self.gpsArr[3]+self.gpsArr[2], '%H%M%S.%f,%Y%m%d')\n                self.time.day = tmptime.day\n                self.time.month = tmptime.month\n                self.time.year = tmptime.year\n                self.time.hour = tmptime.hour\n                self.time.min = tmptime.minute\n                self.time.sec = tmptime.second\n\n        elif self.gpsArr[0] == '$GPGGA':\n                self.pos.latitude_deg = int(float(self.gpsArr[2]) // 100)\n                self.pos.latitude_min = float(self.gpsArr[2])  - (self.pos.latitude_deg * 100)\n                self.pos.latitude_dir = self.gpsArr[3]\n                self.pos.longitude_deg = int(float(self.gpsArr[4]) // 100)\n                self.pos.longitude_min = float(self.gpsArr[4])  - (self.pos.longitude_deg * 100)\n                self.pos.longitude_dir = self.gpsArr[5]\n                #self.pos.gps_quality = int(self.gpsArr[8])\n                #self.pos.satellite_number = int(self.gpsArr[7]) \n\nclass RosPublish:\n    def __init__(self):\n        self.pub_pos = rospy.Publisher('gps_position', gps_position, queue_size = 1)\n        self.pub_localpos = rospy.Publisher('gps_localposition', gps_local_position, queue_size = 1)\n        self.pub_navinfo = rospy.Publisher('gps_navinfo', gps_navinfo, queue_size = 1)\n        self.pub_time = rospy.Publisher('gps_time', gps_time, queue_size = 1)\n\n    def ros_log(self, pos, localpos, navinfo, time):\n        rospy.loginfo(pos)\n        rospy.loginfo(localpos)\n        rospy.loginfo(navinfo)\n        rospy.loginfo(time)\n\n    def ros_pub(self, pos, localpos, navinfo, time):\n        self.pub_pos.publish(pos)\n        self.pub_localpos.publish(localpos)\n        self.pub_navinfo.publish(navinfo)\n        self.pub_time.publish(time)        \n\n\n\n#Function-----------------------------------------------------------------------------------------\ndef publish_gps(gps):\n    rospy.init_node('NODE_Gps', anonymous = True)\n    ros = rospy.Rate(PUBLISH_RATE)\n    pub = RosPublish()\n\n    pub.ros_log(gps.pos, gps.localpos, gps.navinfo, gps.time)\n    pub.ros_pub(gps.pos, gps.localpos, gps.navinfo, gps.time)\n    ros.sleep()\n\n\ndef refresh_gps(gps):\n    while not rospy.is_shutdown():\n        gps.get_gps()\n\n\n\n#Main-----------------------------------------------------------------------------------------\nif __name__ == '__main__':\n    try:\n        gps = GpsSerial(SERIAL_PORT, BAUD_RATE)\n        thread_1 = threading.Thread(target = refresh_gps, args = (gps,))\n        thread_1.start()\n\n        while not rospy.is_shutdown():\n            publish_gps(gps)\n\n    except rospy.ROSInterruptException:\n        pass\n"], "answer_code": ["rospy.init_node('NODE_Gps', anonymous = True)", "self.pub_... = rospy.Publisher(...)", "ros = rospy.Rate(PUBLISH_RATE)"], "url": "https://stackoverflow.com/questions/59242414/delay-in-real-time-reading-from-multiple-serial-ports-gps-through-rs232-usb"}
,{"title": "How to bypass python function definition with decorator?", "time": "2020-02-16 01:16:56Z", "post_content": ["I would like to know if its possible to control Python function definition based on global settings (e.g. OS). Example:", "Then, if someone is using Linux, the first definition of ", " will be used and the second will be silently ignored."], "answer": ["If the goal is to have the same sort of effect in your code that #ifdef WINDOWS / #endif has.. here's a way to do it (I'm on a mac btw). ", "So with this implementation you get same syntax you have in your question.", "What the code above is doing, essentially, is assigning zulu to zulu if the platform matches. If the platform doesn't match, it'll return zulu if it was previously defined. If it wasn't defined, it returns a placeholder function that raises an exception.", "Decorators are conceptually easy to figure out if you keep in mind that", "is analogous to:", "Here's an implementation using a parameterized decorator:", "Parameterized decorators are analogous to ", ".", "I've updated the answer quite a bit. In response to comments, I've expanded its original scope to include application to class methods and to cover functions defined in other modules. In this last update, I've been able to greatly reduce the complexity involved in determining if a function has already been defined.", "[A little update here... I just couldn't put this down - it's been a fun exercise] I've been doing some more testing of this, and found it works generally on callables - not just ordinary functions; you could also decorate class declarations whether callable or not. And it supports inner functions of functions, so things like this are possible (although probably not good style - this is just test code):", "The solution presented has applicability beyond mimicking C #ifdef behavior. Note in the question it's stated, \"Its not about determining the OS, its about function definition / decorators.\" ", "The above demonstrates the basic mechanism of decorators, how to access the caller's scope, and how to simplify multiple decorators that have similar behavior by having an internal function containing the common algorithm defined. ", "Decorators can do pretty much anything with the object they decorate (functions are objects, as well as classes, etc.) When the decorator receives the object as a parameter, it could wrap it, ignore it and supply something else, perform some sort of analysis on it and return it, access code objects directly and make modifications (like injecting code), etc.. Just returning the target object is efficient because the runtime code can access it directly. ", "If more actions need to be performed on the target object when it's called (or accessed) at runtime, then it could be wrapped in another callable object (or not callable depending on what the decorator is to be applied to). Decorators are very versatile and effective for a wide variety of uses.", "While ", " syntax looks nice, you get ", " behaviour as desired with a simple ", ".", "Below is one possible implementation for this mechanic. As noted in the comments, it may be preferable to implement a \"master dispatcher\" interface, such as that seen in ", ", to keep track of the state associated with the multiple overloaded definitions. My hope is the this implementation will at least offer some insight into the problems that you may have to deal with when developing this functionality for a larger codebase.", "I have only tested that the implementation below works as specified on Linux systems, so I cannot guarantee that this solution adequately enables the creation of platform-specialized functions. Please do not use this code in a production setting without thoroughly testing it yourself first.", "In order to use this decorator, we must work through two levels of indirection. First, we must specify what platform we want the decorator to respond to. This is accomplished by the line ", " and its Window's counterpart above. Next, we need to pass along the existing definition of the function being overloaded. This step must be accomplished at the definition site, as demonstrated below.", "To define a platform-specialized function, you may now write the following:", "Calls to ", " will be appropriately dispatched to the provided platform-specific definition.", "Personally, I would not advise using this technique in production code. In my opinion, it is better to be explicit about platform-dependent behavior at each location where these differences occur.", "I wrote my code before read other answers. After I finished my code, I found @Todd's code is the best answer.\nAnyway I post my answer because I felt fun while I was solving this problem. I learned new things thanks to this good question.\nThe drawback of my code is that there exists overhead to retrieve dictionaries every time functions are called."], "question_code": ["@linux\ndef my_callback(*args, **kwargs):\n    print(\"Doing something @ Linux\")\n    return\n\n@windows\ndef my_callback(*args, **kwargs):\n    print(\"Doing something @ Windows\")\n    return\n", "my_callback", "my_callback = windows(<actual function definition>)", "my_callback", "windows()", "import", "functools.singledispatch", "register", "uuid.getnode()"], "answer_code": [">>> def _ifdef_decorator_impl(plat, func, frame):\n...     if platform.system() == plat:\n...         return func\n...     else:\n...         if func.__name__ in frame.f_locals:\n...             return frame.f_locals[func.__name__]\n...         else:\n...             def _not_implemented(*args, **kwargs):\n...                 raise NotImplementedError(\n...                     f\"Function {func.__name__} is not defined \"\n...                     f\"for platform {platform.system()}.\")\n...             return _not_implemented\n...             \n...\n>>> def windows(func):\n...     return _ifdef_decorator_impl('Windows', func, sys._getframe().f_back)\n...     \n>>> def macos(func):\n...     return _ifdef_decorator_impl('Darwin', func, sys._getframe().f_back)\n", ">>> @macos\n... def zulu():\n...     print(\"world\")\n...     \n>>> @windows\n... def zulu():\n...     print(\"hello\")\n...     \n>>> zulu()\nworld\n>>> \n", "@mydecorator\ndef foo():\n    pass\n", "foo = mydecorator(foo)\n", ">>> def ifdef(plat):\n...     frame = sys._getframe().f_back\n...     def _ifdef(func):\n...         return _ifdef_decorator_impl(plat, func, frame)\n...     return _ifdef\n...     \n>>> @ifdef('Darwin')\n... def ice9():\n...     print(\"nonsense\")\n", "foo = mydecorator(param)(foo)", ">>> @macos\n... class CallableClass:\n...     \n...     @macos\n...     def __call__(self):\n...         print(\"CallableClass.__call__() invoked.\")\n...     \n...     @macos\n...     def func_with_inner(self):\n...         print(\"Defining inner function.\")\n...         \n...         @macos\n...         def inner():\n...             print(\"Inner function defined for Darwin called.\")\n...             \n...         @windows\n...         def inner():\n...             print(\"Inner function for Windows called.\")\n...             \n...         print(\"Invoking inner function...\")\n...         \n...         inner()\n...         \n...         print(\"Don't ever call me late for inner().\")\n...         \n...     @macos\n...     class InnerClass:\n...         \n...         @macos\n...         def inner_class_function(self):\n...             print(\"Called inner_class_function() Mac.\")\n...             \n...         @windows\n...         def inner_class_function(self):\n...             print(\"Called inner_class_function() for windows.\")\n", "macos", "windows", "zulu", "None", "@decorator", "if", "linux = platform.system() == \"Linux\"\nwindows = platform.system() == \"Windows\"\nmacos = platform.system() == \"Darwin\"\n\nif linux:\n    def my_callback(*args, **kwargs):\n        print(\"Doing something @ Linux\")\n        return\n\nif windows:\n    def my_callback(*args, **kwargs):\n        print(\"Doing something @ Windows\")\n        return\n", "def callback_windows(...)", "def callback_linux(...)", "if windows: callback = callback_windows", "functools.singledispatch", "import platform\nfrom functools import wraps\nfrom typing import Callable, Optional\n\n\ndef implement_for_os(os_name: str):\n    \"\"\"\n    Produce a decorator that defines a provided function only if the\n    platform returned by `platform.system` matches the given `os_name`.\n    Otherwise, replace the function with one that raises `NotImplementedError`.\n    \"\"\"\n    def decorator(previous_definition: Optional[Callable]):\n        def _decorator(func: Callable):\n            if previous_definition and hasattr(previous_definition, '_implemented_for_os'):\n                # This function was already implemented for this platform. Leave it unchanged.\n                return previous_definition\n            elif platform.system() == os_name:\n                # The current function is the correct impementation for this platform.\n                # Mark it as such, and return it unchanged.\n                func._implemented_for_os = True\n                return func\n            else:\n                # This function has not yet been implemented for the current platform\n                @wraps(func)\n                def _not_implemented(*args, **kwargs):\n                    raise NotImplementedError(\n                        f\"The function {func.__name__} is not defined\"\n                        f\" for the platform {platform.system()}\"\n                    )\n\n                return _not_implemented\n        return _decorator\n\n    return decorator\n\n\nimplement_linux = implement_for_os('Linux')\n\nimplement_windows = implement_for_os('Windows')\n", "implement_linux = implement_for_os('Linux')", "@implement_linux(None)\ndef some_function():\n    ...\n\n@implement_windows(some_function)\ndef some_function():\n   ...\n\nimplement_other_platform = implement_for_os('OtherPlatform')\n\n@implement_other_platform(some_function)\ndef some_function():\n   ...\n\n", "some_function()", "implement_for_os", "from collections import defaultdict\nimport inspect\nimport os\n\n\nclass PlatformFunction(object):\n    mod_funcs = defaultdict(dict)\n\n    @classmethod\n    def get_function(cls, mod, func_name):\n        return cls.mod_funcs[mod][func_name]\n\n    @classmethod\n    def set_function(cls, mod, func_name, func):\n        cls.mod_funcs[mod][func_name] = func\n\n\ndef linux(func):\n    frame_info = inspect.stack()[1]\n    mod = inspect.getmodule(frame_info.frame)\n    if os.environ['OS'] == 'linux':\n        PlatformFunction.set_function(mod, func.__name__, func)\n\n    def call(*args, **kwargs):\n        return PlatformFunction.get_function(mod, func.__name__)(*args,\n                                                                 **kwargs)\n\n    return call\n\n\ndef windows(func):\n    frame_info = inspect.stack()[1]\n    mod = inspect.getmodule(frame_info.frame)\n    if os.environ['OS'] == 'windows':\n        PlatformFunction.set_function(mod, func.__name__, func)\n\n    def call(*args, **kwargs):\n        return PlatformFunction.get_function(mod, func.__name__)(*args,\n                                                                 **kwargs)\n\n    return call\n\n\n@linux\ndef myfunc(a, b):\n    print('linux', a, b)\n\n\n@windows\ndef myfunc(a, b):\n    print('windows', a, b)\n\n\nif __name__ == '__main__':\n    myfunc(1, 2)\n"], "url": "https://stackoverflow.com/questions/60244570/how-to-bypass-python-function-definition-with-decorator"}
,{"title": "Right way to use CUDA based functions in a ROS context", "time": "2018-05-02 11:04:11Z", "post_content": ["I am working on a ROS-based pipeline whose main function is to subscribe to image topics and execute functions such as feature detection, matching etc continuously. To make this pipeline faster, I am trying to use CUDA based detection and matching modules as part of my package. In the context of this question, I am assuming a simple pipeline where I subscribe to an image topic, and in the subscriber callback which is called every time an image is available, two member functions of different classes are called: one for detection, another to match, each containing its own CUDA kernel. Somewhat similar to executing those two functions in a loop.", "The first function takes the image data and computes feature keypoints and descriptors, returning them to the host. I then copy these descriptors back into the GPU memory and I need to match them with another set of descriptors which belong to a reference image. ", "For example, this is how the standalone matching function looks like:", "In this context, I have a few questions, as it is my first foray into GPU-based development. "], "answer": ["Should I free the device memory pointers for these after performing matching every time and reallocate (cudaMalloc()) in the next callback? ", "Probably not.  This would appear to be unnecessary and time-consuming.", "Or is there a more efficient way to allocate memory only once and reuse it?", "Probably.  For example, you could determine the maximum size possibly needed, allocate for that, then pass a pointer to it into your event processing loop, and reuse the allocation.", "The detection and matching functions also make use of objects such as cudaResourceDesc and cudaTextureDesc, which will go out of scope at the end of every execution and thus should be destroyed. Should I handle them in any other specific way?", "Similarly, you could create them at a higher scope, and pass references to them into your event processing system.  However, I think that the main time consumers here will be the data copy to populate the texture, and the binding of the texture.  These would have to be repeated anyway (presumably).  But if you have an underlying allocation for the backing store for the texture object, then you probably would not need to reallocate for that, see previous comments.", "I assume I need cudaDeviceSynchronize() after executing each of these two functions. Am I correct?", "It's not obvious to me that it is needed.  You haven't shown a complete example, but if, at the end of your functions, there is a copy of data from device to host, that will probably suffice. ", " is a blocking function.  If you are operating in a physically/logically unified memory situation such as TX1/TX2, then yes, you may need a sync point to ensure that data is valid before you consume it in host code.", "Can I safely leave the \"reference\" descriptors in GPU memory and only update them when I need to?", "I don't know why not.  An allocation created by ", " does not \"go out of scope\" until either application termination, or explicitly free'd with ", ".  If you copy data to such an allocation, it should remain there, unchanged, for the duration of your application, unless you overwrite it somehow (or free the underlying allocation)."], "quote": ["Should I free the device memory pointers for these after performing matching every time and reallocate (cudaMalloc()) in the next callback? ", "Or is there a more efficient way to allocate memory only once and reuse it?", "The detection and matching functions also make use of objects such as cudaResourceDesc and cudaTextureDesc, which will go out of scope at the end of every execution and thus should be destroyed. Should I handle them in any other specific way?", "I assume I need cudaDeviceSynchronize() after executing each of these two functions. Am I correct?", "Can I safely leave the \"reference\" descriptors in GPU memory and only update them when I need to?"], "question_code": ["// Detection module returns a struct featureData, containing keypoints and descriptors \n// in featureData.kps and featureData.desc\n\nuint64_t* d_desc;\ncudaMalloc(&d_desc, 64 * featureData.kps.size());\ncudaMemcpy(d_desc, &featureData., 64 * (featureData.kps.size()), cudaMemcpyHostToDevice);\n\ncudaDeviceSetCacheConfig(cudaFuncCachePreferL1);\ncudaDeviceSetSharedMemConfig(cudaSharedMemBankSizeEightByte);\n\n// Create texture object for descriptors\n\nstruct cudaResourceDesc resDesc;\nmemset(&resDesc, 0, sizeof(resDesc));\nresDesc.resType = cudaResourceTypeLinear;\nresDesc.res.linear.devPtr = d_desc;\nresDesc.res.linear.desc.f = cudaChannelFormatKindUnsigned;\nresDesc.res.linear.desc.x = 32;\nresDesc.res.linear.desc.y = 32;\nresDesc.res.linear.sizeInBytes = 64 * featureData.kps.size();\n\nstruct cudaTextureDesc texDesc;\nmemset(&texDesc, 0, sizeof(texDesc));\ntexDesc.addressMode[0] = cudaAddressModeBorder;\ntexDesc.addressMode[1] = cudaAddressModeBorder;\ntexDesc.filterMode = cudaFilterModePoint;\ntexDesc.readMode = cudaReadModeElementType;\ntexDesc.normalizedCoords = 0;\ncudaTextureObject_t tex_q = 0;\ncudaCreateTextureObject(&tex_q, &resDesc, &texDesc, nullptr);\n\n// Allocate space for match results\nint* d_matches;\ncudaMalloc(&d_matches, 4 * featureData.kps.size());\n\n// Launch the matching kernel\nCUDAmatch(d_descRef, static_cast<int>(refData.kps.size()), tex_q, static_cast<int>(featureData.kps.size()), d_matches, threshold);\n\n// d_descRef is memory pointed to by a uint64_t* for the reference descriptors.\n", "cudaMalloc()", "cudaResourceDesc", "cudaTextureDesc", "cudaDeviceSynchronize()"], "answer_code": ["cudaMemcpy", "cudaMalloc", "cudaFree"], "url": "https://stackoverflow.com/questions/50127017/right-way-to-use-cuda-based-functions-in-a-ros-context"}
,{"title": "How should CMakeLists.txt be written for ROS Groovy with PCL-1.6 integration", "time": "2013-12-20 09:27:18Z", "post_content": ["I am asking here since answers.ros.org is hanging when posting... ", "we are currently compiling a ", " software using ", " build system on 64-bit Ubuntu Linux 12.10 Quantal Quetzal. We are using ", " installed in the default path (Groovy and Hydro installed on the same system, Groovy workspace sourced while working now on groovy). ", "We have been referring to wiki tutorias of ros (cannot link with my karma here) to draft a CMakeLists.txt setup for the project. Since the tutorial only states 2 lines about CMakeLists.txt and recommends using the default template we are asking for guidance here.", "The project is using a PCL software that supposedly should run in a ROS node sending data to the network. We have the original implementation in PCL-1.7 but with minimal modifications it runs on PCL-1.6, too, and now we are integrating it into ROS.", "We have added ROS required headers in the code, and ros::init, and ros::NodeHandle, but what else is absolutely required for the ROS node to run PCL-1.6? ", "To make things not easier the least, OpenCV and BOOST are being used, too! (They are absolutely amazing libraries, when they work)", "Currently, a problem is: a warning about conflicting libraries", "even though no paths with pcl-1.7 are provided to catkin. I did create the package with pcl-1.7 dependency, but long since has removed dependency of pcl-1.7 from CMakeLists.txt, package.xml, and did catkin_make clean (does this not remove the dependency from all cmake files?).", "My question is how should I change my CMakeLists.txt setup to solve this linking error? Ultimately, the problem leads to segmentation faults in the program => PCL RANSAC segmentation filters crash.", "Here's the current CMakeLists.txt (in short) that successfully compiles and runs the project that we have written:", "Should be added, this CMakeLists.txt compiles ", " against stand-alone PCL installation (1.6 or 1.7) nicely.\nand here is the ", ":", "I have tried to trace down the segfault with GDB and we can interestingly see that sample_consensus library changes in the middle of things from 1.6 to 1.7", "What should we do with CMakeLists.txt in order to solve the problem?\nHopefully someone can guide us in the right direction, while at it, happy holidays everyone! "], "answer": ["Not sure if this will help ...\nI'm using OpenCV, Boost and PCL in a catkin package. What worked for me was ", "in package.xml", "in CMakeLists.txt", "Now you need to include pcl headers with ", "And then you dont need ", "nor linking ${PCL_LIBRARIES}. It will be contained in ${catkin_LIBRARIES}.", "Hope this works. Cheers"], "question_code": ["/usr/bin/ld: warning: libpcl_sample_consensus.so.1.6, needed by>\nopt/ros/groovy/lib/libpcl_filters.so, may conflict with > libpcl_sample_consensus.so.1.7\n/usr/bin/ld: warning: libpcl_io.so.1.6, needed by /opt/ros/groovy/lib/libpcl_visualization.so, may conflict with libpcl_io.so.1.7\n/usr/bin/ld: warning: libpcl_common.so.1.7, needed by /usr/lib/gcc/x86_64-linux-gnu/4.7/../../../../lib/libpcl_sample_consensus.so, may conflict with libpcl_common.so.1.6\n", "cmake_minimum_required(VERSION 2.8.9 FATAL_ERROR)\nproject(famous_emutanen_bv)\nset(famous_emutanen_bv_srcs src/disparity.cpp)\n\nfind_package(catkin REQUIRED COMPONENTS\n  geometry_msgs\n#  pcl\n  pcl_ros\n  roscpp\n  rospy\n  sensor_msgs\n  std_msgs\n)\nfind_package(PCL 1.6 REQUIRED)\nfind_package(OpenCV 2.2 REQUIRED)\nfind_package(Boost REQUIRED COMPONENTS system thread)\n\ncatkin_package(\n  INCLUDE_DIRS include\n#  LIBRARIES famous_emutanen_bv\n#  CATKIN_DEPENDS geometry_msgs pcl-1.7 pcl_ros roscpp rospy sensor_msgs std_msgs\n#  DEPENDS system_lib\n)\n\ninclude_directories(include\n  ${catkin_INCLUDE_DIRS}\n  ${PCL_INCLUDE_DIRS}\n  ${OpenCV_INCLUDE_DIRS}\n  ${Boost_INCLUDE_DIRS}\n)\ninclude_directories(/usr/include/vtk-5.8)\n\nlink_directories(${PCL_LIBRARY_DIRS} ${OpenCV_LIBRARY_DIRS}) # \nadd_definitions(${PCL_DEFINITIONS} ${OpenCV_DEFINITIONS}) #\nadd_executable(famous_emutanen_bv ${famous_emutanen_bv_srcs})\n\ntarget_link_libraries(famous_emutanen_bv ${catkin_LIBRARIES} ${PCL_LIBRARIES} ${OpenCV_LIBRARIES} ${Boost_LIBRARIES} libvtkCommon.so libvtkFiltering.so libvtkRendering.so) #\n", "<?xml version=\"1.0\"?>\n<package>\n  <name>famous_emutanen_bv</name>\n  <version>0.0.0</version>\n  <description>The famous_emutanen_bv package</description>     \n  <maintainer email=\"emutanen@xx\">emutanen</maintainer>\n  <license>GPLv3</license>\n  <buildtool_depend>catkin</buildtool_depend>\n  <build_depend>geometry_msgs</build_depend>\n  <build_depend>pcl_ros</build_depend>\n  <build_depend>roscpp</build_depend>\n  <build_depend>rospy</build_depend>\n  <build_depend>sensor_msgs</build_depend>\n  <build_depend>std_msgs</build_depend>\n  <run_depend>geometry_msgs</run_depend>\n  <run_depend>pcl_ros</run_depend>\n  <run_depend>roscpp</run_depend>\n  <run_depend>rospy</run_depend>\n  <run_depend>sensor_msgs</run_depend>\n  <run_depend>std_msgs</run_depend>\n  <export>\n    <!-- <metapackage/> -->\n  </export>\n</package>\n", "(gdb) backtrace\n#0  0x00007ffff396caed in pcl::SampleConsensusModelCylinder<pcl::PointXYZ, pcl::Normal>::computeModelCoefficients(std::vector<int, std::allocator<int> > const&, Eigen::Matrix<float, -1, 1, 0, -1, 1>&) ()\n   from /usr/lib/libpcl_sample_consensus.so.1.7\n#1  0x00007ffff4cb6166 in pcl::RandomSampleConsensus<pcl::PointXYZ>::computeModel(int) () from /opt/ros/groovy/lib/libpcl_segmentation.so.1.6\n#2  0x00007ffff4cafd1c in pcl::SACSegmentation<pcl::PointXYZ>::segment(pcl::PointIndices_<std::allocator<void> >&, pcl::ModelCoefficients_<std::allocator<void> >&) () from /opt/ros/groovy/lib/libpcl_segmentation.so.1.6\n#3  0x000000000049ac23 in famous::segmentCylinder(boost::shared_ptr<pcl::PointCloud<pcl::PointXYZ> >&, boost::shared_ptr<pcl::ModelCoefficients_<std::allocator<void> > >) ()\n#4  0x00000000004a1164 in famous::updatePointCloud() ()\n#5  0x00000000004a6fa7 in main ()\n"], "answer_code": ["<?xml version=\"1.0\"?>\n...\n  <buildtool_depend>catkin</buildtool_depend>\n...\n<build_depend>pcl_ros</build_depend>\n<build_depend>pcl</build_depend>\n<run_depend>pcl</run_depend>\n<run_depend>pcl_ros</run_depend>\n...\n</package>\n", "find_package(catkin REQUIRED\n  ...\n  pcl\n  pcl_ros\n  ...\n)\n\ncatkin_package(\n  INCLUDE_DIRS include\n  LIBRARIES famous_emutanen_bv\n  CATKIN_DEPENDS geometry_msgs pcl pcl_ros roscpp rospy sensor_msgs std_msgs\n)\n", "#include <pcl-1.6/pcl/...>", "link_directories(${PCL_LIBRARY_DIRS}) \nadd_definitions(${PCL_DEFINITIONS})\n"], "url": "https://stackoverflow.com/questions/20700212/how-should-cmakelists-txt-be-written-for-ros-groovy-with-pcl-1-6-integration"}
,{"title": "Why does Popen.stdout contain only part of output?", "time": "2015-08-06 10:40:24Z", "post_content": ["I am running two processes simultaneously in python using the subprocess module:", "These are ", " processes: ", " listens for a ", " file to be played and outputs certain information from that ", " file to the stdout stream; I want to then access this output using the ", " object (which behaves as a file).", "However, what I find happening is that the ", " object only contains the first ~1/3 of the output lines it should have - that is, in comparison to running the two commands manually, simultaneously in two shells side by side.", "I've tried waiting for many seconds for output to finish, but this doesn't change anything, its approximately the same ratio of lines captured by ", " each time. Any hints on what this could be would be greatly appreciated!", "EDIT:", "Here's the reading code:", "Note that the value X in time.sleep(X) doesn't make any difference"], "answer": ["By default, when a process's ", " is not connected to a terminal, the output is block buffered. When connected to a terminal, it's line buffered. You expect to get complete lines, but you can't unless ", " unbuffers or explicitly line buffers its ", " (if it's a C program, you can use ", " to make this automatic).", "The other (possibly overlapping) possibility is that the pipe buffer itself is filling (pipe buffers are usually fairly small), and because you never drain it, ", " fills the pipe buffer and then blocks indefinitely until you kill it, leaving only what managed to fit in the pipe to be drained when you read the process's ", ". In that case, you'd need to either spawn a thread to keep the pipe drained from Python, or have your main thread use ", " module components to monitor and drain the pipe (intermingled with polling the other process). The thread is generally easier, though you do need to be careful to avoid thread safety issues.", "is it worth trying process communicate/wait? rather than sleep and would that solve your issue?", "i have this for general purpose so not sure if you can take this and change it to what you need?"], "question_code": ["p_topic = subprocess.Popen(['rostopic','echo','/msg/address'], stdout=PIPE)\np_play = subprocess.Popen(['rosbag','play',bagfile_path])\n", "p_topic", ".bag", ".bag", "p_topic.stdout", "p_topic.stdout", "p_topic.stdout", "#wait for playing to stop\nwhile p_play.poll() == None:\n    time.sleep(.1)\n\ntime.sleep(X)#wait for some time for the p_topic to finish\np_topic.terminate()\n\noutput=[]\nfor line in p_topic.stdout:\n    output.append(line)\n", "read", "check_output"], "answer_code": ["stdout", "rostopic", "stdout", "setvbuf", "rostopic", "stdout", "select", "    executable_Params = \"{0} {1} {2} {3} {4}\".format(my_Binary, \n                                                       arg1, \n                                                       arg2, \n                                                       arg3, \n                                                       arg4)\n\n    # execute the process\n    process = subprocess.Popen(shlex.split(executable_Params), \n                               shell=False, \n                               stderr=subprocess.PIPE, \n                               stdout=subprocess.PIPE)\n\n\n    stdout, stderr = process.communicate()\n    ret_code = process.wait()\n\n    if ret_code == 0:\n        return 0\n    else:\n        #get the correct message from my enum method\n        error_msg = Process_Error_Codes(ret_code).name\n        raise subprocess.CalledProcessError(returncode=ret_code, \n                                            cmd=executable_Params)\n"], "url": "https://stackoverflow.com/questions/31853014/why-does-popen-stdout-contain-only-part-of-output"}
,{"title": "Is there a way to have a precedence between two ROS nodes?", "time": "2016-12-01 13:43:26Z", "post_content": ["I'm asking you if there is a way to have a precedence between two ROS nodes. In particular, i have a ROS node that makes an output that is a text file with 60 data in it, and it recreates it every time because the data are changing. Then i have a node that has to analyze that text file. Basically, what i need is to make some changes to have a mechanism that stops the analyzer node when the writer node is running, then it has to send a signal to the analyzer node to make it able to run and analyze the text file. And then the writer node has to return let's say \"in charge\" to be able to re-write the text file again. So, in simple words, is a loop. Someone told me that a possible solution can be something like a \"semaphore\" topic in which the writer node writes, for example, a boolean value of 1 when is doing the opening, the writing and the closing of the text file, so the analyzer node knows that cannot do its elaboration, since the file is not ready yet. And, when the writer has finished and closed the text file, it has to be published a value 0 that permits the analysis by the analyzer node. I searched for the publishing of boolean values and i found a code that can be something like this:", "I don't know if i have only to use the publisher in the writer node and the subscriber in the analyzer node. Maybe i have to use both of them in the two nodes, something like: writer put a 1 in the topic semaphore so the analyzer knows that cannot access the text file, makes the text file and then put a 0 in the topic and subscribe to the topic waiting again a 1; the analyzer does something similar but in reverse. I put the two codes below, because i don't have any idea where to put the publisher and the the subscriber and how to make them working well. If possible, i have to keep this structure of working flow in my codes. \nNOTE: a new text file is created almost every 10 seconds, since in the text file are written data coming from another ROS topic and the code in the writer has a mechanism to do this kind of elaboration.\nThank you in advance!!!\nEDIT: Now the codes are corrected with a topic based solution as i explain in my last comment.", "Writer code:", "Analyzer code:"], "answer": ["This could be done simply using ", ". Basically, when your node A gets the message, it does what it needs (write file) and then asks for a serice from node B (analyse the file).", "The only con I see is that node A will have to wait for node B service to finish. If B dosen't need too much time, it wouldn't raise a problem. ", "Code Snippet :", " :", "create a service named \"analyse_heart_rate.srv\" in the srv folder of your package (I supposed it's name \"heart_rate_monitor\").", "specify the request/response of your service structure in the file: ", " : ", "add the following lines : ", " :", "This way, whenever a message comes in the node \"Service Client\", It will process it and eventually write it to the file. Then it asks the \"Service Server\" to process the file created previously...", "Of course, this is just a snippet, costumize it to your needs.", "Cheers."], "question_code": ["ros::Publisher pub = n.advertise<std_msgs::Bool>(\"semaphore\", 1000);\nstd_msgs::Bool state;\nstate.data = 1;\n", "#include \"ros/ros.h\"\n#include \"std_msgs/String.h\"\n#include \"std_msgs/Bool.h\"\n#include \"../include/heart_rate_monitor/wfdb.h\"\n#include <stdio.h>\n#include <sstream>\n#include <iostream>\n#include <fstream>\n#include <iomanip>\n#include <algorithm>\n#include <deque>\n#include \"heart_rate_monitor/analyse_heart_rate.h\"\n\nusing namespace std;\n\n\n\nstatic std::deque<std::string> queue_buffer;\nstatic int entries_added_since_last_write = 0;\n\nros::Publisher pub;\n\nvoid write_data_to_file()\n{\n// open file;\nstd::ofstream data_file(\"/home/marco/catkin_ws/src/heart_rate_monitor/my_data_file.txt\");\nif (data_file.is_open())\n{\nfor (int i = 0; i < queue_buffer.size(); ++i)\n{\n  data_file << queue_buffer[i] << std::endl;\n}\n}\nelse\n{\nstd::cout << \"Error - Cannot open file.\" << std::endl;\nexit(1);\n}\ndata_file.close();\n\nstd_msgs::Bool state;\nstate.data = 0;\n\npub.publish(state);\n\n}\n\nvoid process_message(const std_msgs::String::ConstPtr& string_msg)\n{\nstd_msgs::Bool state;\nstate.data = 1;\n\npub.publish(state);\n\n// if buffer has already 60 entries, throw away the oldest one\nif (queue_buffer.size() == 60)\n{\nqueue_buffer.pop_front();\n}\n\n// add the new data at the end\nqueue_buffer.push_back(string_msg->data);\n\n// check if 10 elements have been added and write to file if so\nentries_added_since_last_write++;\n\nif (entries_added_since_last_write >= 10\n  && queue_buffer.size() == 60)\n{\n// write data to file and reset counter\nwrite_data_to_file();\nentries_added_since_last_write = 0;\n}\n\n}\n\n\nint main(int argc, char **argv)\n{\n\nros::init(argc, argv, \"writer\");\n\nros::NodeHandle n;\n\nros::Subscriber sub = n.subscribe(\"/HeartRateInterval\", 1000, process_message);\npub = n.advertise<std_msgs::Bool>(\"/semaphore\", 1000);\n\nros::spin();\n\nreturn 0;\n}\n", "#include \"ros/ros.h\"\n#include \"std_msgs/String.h\"\n#include \"std_msgs/Bool.h\"\n#include \"../include/heart_rate_monitor/wfdb.h\"\n#include <stdio.h>\n#include <sstream>\n#include <iostream>\n#include <fstream>\n#include <iomanip>\n#include <algorithm>\n#include <deque>\n#include \"heart_rate_monitor/analyse_heart_rate.h\"\n\nvoid orderCallback(const std_msgs::Bool::ConstPtr& msg)\n{\n\nif (msg->data == 0)\n{\nchdir(\"/home/marco/catkin_ws/src/heart_rate_monitor\");\n\nsystem(\"get_hrv -R my_data_file.txt >doc.txt\");\n}\n}\n\n\nint main(int argc, char **argv)\n{\n\nros::init(argc, argv, \"analyzer\");\n\nros::NodeHandle n;\n\nros::Subscriber sub = n.subscribe(\"/semaphore\", 1000, orderCallback);\n\nros::spin();\n\nreturn 0;\n}\n"], "answer_code": ["string filename\n---\nbool result\n", "add_service_files(\n  FILES\n  analyse_heart_rate.srv\n)\n", " #include \"ros/ros.h\"\n #include \"heart_rate_monitor/analyse_heart_rate.h\"\n\n\nbool analyse(heart_rate_monitor::analyse_heart_rate::Request  &req,\n     heart_rate_monitor::analyse_heart_rate::Response &res)\n\n{\n  res.result = analyse_text_file(req.filename);\n  return true;\n}\n\nint main(int argc, char **argv)\n{\n  ros::init(argc, argv, \"heart_rate_analyser_server\");\n  ros::NodeHandle n;\n\n  ros::ServiceServer service = n.advertiseService(\"heart_rate_analyser\", analyse);\n  ROS_INFO(\"Ready to analyse requests.\");\n  ros::spin();\n\n  return 0;\n}\n", "#include \"ros/ros.h\"\n#include \"heart_rate_monitor/analyse_heart_rate.h\"\n\nvoid process_message(const std_msgs::String::ConstPtr& string_msg)\n{\n    std::string output_filename;\n    do_staff_with_message();\n    write_data_to_file_(output_filename);\n\n     heart_rate_monitor::analyse_heart_rate srv;\n     srv.filename = output_filename ;\n     if (client.call(srv))\n     {\n        ROS_INFO(\"Result: %d\", (bool)srv.response.result);\n     }\n     else\n     {\n        ROS_ERROR(\"Failed to call service heart_rate_analyser\");\n     }\n}\n\nint main(int argc, char **argv)\n{\n  ros::init(argc, argv, \"add_two_ints_client\");\n  ros::NodeHandle n;\n  ros::ServiceClient client = n.serviceClient<heart_rate_monitor::analyse_heart_rate>(\"heart_rate_analyser\");\n  ros::Subscriber sub = n.subscribe(\"/HeartRateInterval\", 1000, process_message);\n\n  return 0;\n}\n"], "url": "https://stackoverflow.com/questions/40841540/is-there-a-way-to-have-a-precedence-between-two-ros-nodes"}
,{"title": "Reading a variable out from app created by QT Creator and publishing it on ROS", "time": "2019-06-26 13:17:31Z", "post_content": ["I have been given a GUI created with QT Creator that reads and updates the torques from a quadruped robot. However, I need to be able to publish this torque variable to ros through a publisher so that it can be used in the controller.", "I am new to ROS, QT and C++. ", "i have tried to look at ros_qt but am unsure whether this would work for my code.", "main.cpp", "mainwindow.hh", "(This is where i see the torque value which I want to publish (picture attached)", "ServoTable.hh", "ServoTable.cc", "function:Torque() defined in another file", "basically returns a private variable from another class", "My attempted publisher:", "The error i get is that DogBotN::JointC::Torque() cannot be called without an object. Can't I just read it off the GUI thread which is in charged of the updates?"], "answer": [], "question_code": ["#include \"mainwindow.hh\n#include <QApplication>\nint main(int argc, char *argv[])\n{\nQApplication a(argc, argv);\nMainWindow w;\nw.show();\nreturn a.exec();\n}\n", "#include \"ServoTable.hh\"\nnamespace Ui {\nclass MainWindow;\n}\n\nclass MainWindow : public QMainWindow\n{\nQ_OBJECT\n\npublic:\n  explicit MainWindow(QWidget *parent = 0);\n  ~MainWindow();\n\nprotected:\n  void timerEvent(QTimerEvent *event) override;\n.....\n", "#include <QAbstractTableModel>\n#include \"dogbot/Servo.hh\"\nclass ServoTable\n  : public QAbstractTableModel\n{\nQVariant data(const QModelIndex &index, int role) const override;\n....\n\nprivate slots:\n  //! Queue an update for a row\nvoid queueDataUpdate();\n...\n};\n", "#include \"ServoTable.hh\"\n\n....\n\nQVariant ServoTable::data(const QModelIndex &index, int role) \nconst\n{\n  auto it = m_row2joint.find(index.row());\n  if(it == m_row2joint.end()) {\n  return QVariant(); // Doesn't seem to exist.\n }\n const DogBotN::JointC *joint = it->second;\n const DogBotN::ServoC *servo = dynamic_cast<const DogBotN::ServoC *>(joint);\n\n if (role == Qt::DisplayRole) {\n switch(index.column())\n {\n    case ColumnTorque: {\n      QString numStr;\n      numStr.setNum(joint->Torque(),'f',2);\n      return numStr;\n    }\n  }\n  return QVariant();\n}\n", "float Torque() const\n{ return m_torque; }\n", "#include \"GUI/Servo.hh\"\n#include \"std_msgs/String.h\"\n\n#include <ros/ros.h>\n#include <sstream>\n\n\nint main(int argc, char **argv)\n{\n\n  ros::init(argc, argv, \"talker\");\n  ros::NodeHandle n;\n\n  ros::Publisher chatter_pub = n.advertise<std_msgs::String>(\"chatter\", 1000);\n  ros::Rate loop_rate(10);\n\n  int count = 0;\n  while (ros::ok())\n  {\n    std_msgs::String msg;\n\n    std::stringstream ss;\n    ss << DogBotN::JointC::Torque() << count;\n    msg.data = ss.str();\n\n    ROS_INFO(\"%s\", msg.data.c_str());\n\n    chatter_pub.publish(msg);\n\n    ros::spinOnce();\n\n    loop_rate.sleep();\n    ++count;\n  }\n\n\n  return 0;\n}\n"], "url": "https://stackoverflow.com/questions/56773762/reading-a-variable-out-from-app-created-by-qt-creator-and-publishing-it-on-ros"}
,{"title": "How does action server and controllers interact", "time": "2017-01-11 08:34:58Z", "post_content": ["How does action server and controllers interact. For example action client sends trajectory msgs to action server, than how does action server sends the same trajectory msgs to joint trajectory controller, and why to use action interface between the controller and action client?"], "answer": ["The ", " instantiates an action server. The choice of actionlib for this controller comes naturally from the nature of the the task. A client sends a trajectory to the controller, which will then play it until it is done or canceled.", "Since ROS interfaces are not real-time-safe, the action server is typically separated from the real-time thread that is in charge of playing the current trajectory on the actual hardware, but both the real-time part and the action server run in the same process."], "answer_code": ["joint_trajectory_controller"], "url": "https://stackoverflow.com/questions/41586052/how-does-action-server-and-controllers-interact"}
,{"title": "Use GPIO pin on Raspberry Pi 2 Model B to control P3DX robot running ROS", "time": "2016-03-17 15:40:45Z", "post_content": ["We want to control a P3DX robot using values obtained from a potentiometer connected to a GPIO pin on the Raspberry pi 2. Currently we have two Python files: one that moves the robot, and one that reads the GPIO pin connected to a potentiometer. Both files are already working on their own. But is it possible to combine the two files into just one file and run it? Because I was thinking that the Python file interfacing with ROS would need to run separately. If not, what's the easiest way to implement what we want to do?", "***Update:\nEssentially we are trying to use a catenary method to move two robots in formation. So we want to measure the angle the potentiometer makes with a rope, in which the other end is attached to another robot. Based on the angle, it gives the orientation of the robot, and then we can make the proper adjustments to realign the robot to the centerline so that the robot follows the first robot in front. ", "We followed this link on how to connect potentiometer to Raspberry Pi 2 and read values. It also includes the script file: \n", "Here's the file for moving the P3DX:`", "`\nHere's the link we used for reading the potentiometer voltage level values:\n", "\nIgnore the volume stuff, we didn't include them. Just reading the pot."], "answer": ["Yes you can do this - And what you need to look into is ", ".", "This can be rather a difficult task (not sure of your programming level) - It also depends on how you want to display the information.", "PyQt5 has VERY Good support for running multiple threads and outputting the display in a common Gui Interface, if you are not planning on using a GUI (and on a Raspberry I guess you would not) then you need to look at the native ", " module.", "As a matter of design, if you are wanting to get that working in ROS, I won't recommend getting them combined. The reason is that ROS nodes shoud have a specific and the simplest possible task to perform as explained on ", ". So in your case, one reading and the other controling, fine. ", "In the other part, if you really to get them combined, you may use what Tim suggested. Multithreading is a good solution. So, you have to implement two threads working separately and maybe sharing a ", ", the one reading from the GPIO uses a ", " and the one who drives uses a ", "."], "question_code": ["#!/usr/bin/env python\nimport getch\nimport roslib; roslib.load_manifest('p3dx_mover')\nimport rospy\n\nfrom geometry_msgs.msg import Twist\n\nKEY_UP = 65\nKEY_DOWN = 66\nKEY_RIGHT = 67\nKEY_LEFT = 68\nUSER_QUIT = 100\n\nMAX_FORWARD = 1.1\nMAX_LEFT = 0.3\nMIN_FORWARD = -1.1\nMIN_LEFT = -0.3\n\nforward = 0.0\nleft = 0.0\nkeyPress = 0\n\nwhile(keyPress != USER_QUIT):\n    pub = rospy.Publisher('RosAria/cmd_vel', Twist)\n    rospy.init_node('p3dx_mover')\n\n    twist = Twist()\n\n    keyPress = getch.getArrow()\n\n    if((keyPress == KEY_UP) and (forward <= MAX_FORWARD)):\n        forward += 0.1\n    elif((keyPress == KEY_DOWN) and (forward >= MIN_FORWARD)):\n        forward -= 0.1\n    elif((keyPress == KEY_LEFT) and (left <= MAX_LEFT)):\n        left += 0.1\n    elif((keyPress == KEY_RIGHT) and (left >= MIN_LEFT)):\n        left -= 0.1\n\n    twist.linear.x = forward\n    twist.angular.z = left\n    pub.publish(twist)\n\npub = rospy.Publisher('RosAria/cmd_vel', Twist)\nrospy.init_node('p3dx_mover')\ntwist = Twist()\npub.publish(twist)\nexit()\n"], "answer_code": [".push_back", ".pop_front"], "url": "https://stackoverflow.com/questions/36049924/use-gpio-pin-on-raspberry-pi-2-model-b-to-control-p3dx-robot-running-ros"}
,{"title": "Turtlebot does not always drive in a straight line", "time": "2016-12-01 14:41:53Z", "post_content": ["I have some C++ code in which i give the turtlebot a coordinate using:", "The robot moves from one point to another. However only rarely does it do this in a straight line. It seems as though the turtlebot starts moving before it is done rotating. There aren't any obstacles in between the points. It is able to get to every point, but it tends to move in small arc between them.", "Edit: I use ", " and ", "."], "answer": ["It actually is what Dave suggested, that the wheels are moving at different speeds and a two-wheeled robot will follow an arc around the wheel that is moving slower. But this is not because of variations of the wheel diameter,  but because no two motors are identical (due to manufacturing) and therefore even the motors of the same model will have slight variations. Given the same current and voltage, the motors will drive at a slightly different speed; which makes the robot follow an arc. ", "The solution is in implement a feedback control, where you get the rotation feedback and implement the error in a simple control scheme such as PID control. Pseudocode for PID is as follows:"], "question_code": ["goal.target_pose.pose.position.x = mypoint.point.x\ngoal.target_pose.pose.position.y = mypoint.point.y\n", "turtlebot_bringup minimal.launch", "turtlebot_navigation gmapping_demo.launch"], "answer_code": ["Kp = ..                                   //constant\n    Loop forever\n       read sensors    \n       error = TargetValue - offset       \n       integral = integral + error        // calculate the integral \n       derivative = error - lastError     // calculate the derivative\n       Turn = Kp*error + Ki*integral + Kd*derivative  \n       lastError = error                  // save the current error so it can be the lastError next time around\n    end loop forever                      \n"], "url": "https://stackoverflow.com/questions/40911800/turtlebot-does-not-always-drive-in-a-straight-line"}
,{"title": "roslaunch activation failure what should i do?", "time": "2019-11-04 06:06:32Z", "post_content": ["i tried to launch the sdk package by typing", "however every time i get this error:", "here is the steps that i followed to activate the drone:", "where i edit the baud rate/app id/ enc key/ and serial name.", "app_id: 1079440\nbaud_rate: 921600\nserial_name: /dev/ttyUSB0\nenc_key: 39d353a8e9ad01b6c659111904bae57ebb138785aa5159699383f28da3f56563", "and i continued with the following commands:", "its where i got the error.", "i'm using USB-TTL cable to connect manifold 2-c with M210 RTK V2, also i got the permission first before typing any code by typing :", "and then log out and log in\nthen i typed :", "to read and give permission to serial port.", "TX (green wire) and Rx (white wire) and ground (black wire) there were put respectively.", "so now what should i do?"], "answer": ["There are too many possibility\nPlease refer my previous answers and check them one by one", "Information you have given is not enough, there could be many possibilities. Please go through with the following checklist (this is what first comes to my mind, if I remember sth new, I`ll add it in)", "The list is meant for error such as  Drone version not obtained  or  new device error  or  first success connection(get firmware) then failed activation for Both DJI OSDK and DJI OSDK-ROS. Assuming you already enabled the API control, then check", "Does UART on RPI is enabled? if not, enable it. Are you using the correct serial ID as well? If not, set it right. Recommend using /dev/serial/by-id/usb-XXX method", "Does Baud rate in DJI assisatnt2 is same as the one in the USERCONFIG file of OSDK? if not, make it same", "Did u give permission to the serial device e.g sudo chmod a+rw  or  sudo usermod -a -G dialout $USER   or  set the udev rule .  If not choose a way to get it right.", "FTDI series problems", "4.1 Did you use this FTDI cable successfully on other platform before?(to make sure tx rx is correct)  ", "4.2 Is this FTDI 3.3V? If not, high chance your FCU board is already burned. Send it back for repair. ", "4.3 Measure the voltage on Tx and RX pin while everything is connected, is it being pulled up at 3.3V? if less than 3 then there is a serious communication issue.  ", "4.4 Is there EMI generator around?( this one happen to me once, took me 2 weeks to isolate the issue, EMI cause unreliable connection)", "4.5 As an additional test, prob the tx and tx by Y cable using real-term to see if you can see any proper communication happening.", "Did u forget to turn on the RC ? If so turn it on while calling the sdk.launch", "GO app side issue", "6.1 Did u connect the Go app while running sdk.launch? If not connect by GO app, connect it as it will pop up sth. ", "6.2 Did you login to your account which creates the app id?If not, login to it. ", "6.3 And is your account being banned for flying in the non-authorized area before(e.g caught by DJI aeroscope/Flyhub) and police is actually going after you? If so, stop playing the drone and surrender urself in. Normally it should be max of one year Jail time, but if you resist, the punishment can be more deadly.", "Did u give authority from GO app? click ok or confirm on the GO App once you run sdk.launch in the RPI. Once you launch the sdk, ", " After changing the firmware, you should experience this again.", "Did u tried the hardware with the 3.8 with a Normal X86/X64 Intel PC/notebook with Ubuntu 16/18 before? is it working? ( rule out hardware / connection issue ) If can work, then its RPI issue. If can not, high chance drone/RC side.  I do have couple RPI burn down experience b4. ", "Did u have valid/correct app id and enc key? double check it. If not, enter is correct.", "Is the voltage supplied to A3 stable and clean?", "Have you tried this way of calling? /the_sample_u_wish_to_run UserConfig.txt /dev/ttyACM0  (this is what I gathered from other peoples experience)", "Which version of RPI you are using, if you are using 2 series, the high chance you have to use ", " with older version firmware.  I only tested with RPI 3B. Can not guarantee the function of other versions. That's why number 8 is important to isolate the issue. ", "Are you calling the sdk.launch from somewhere else? make sure you only call it once and prevent it from being calling again. Make sure the serial port is not occupied. ", "Make sure API is enabled in DJI assistant2. Close everything power on and connect to DJI assistant 2 again to verify this. If by any chance the board has an issue, the API enable you set in the previous run will get auto deselected. This is to rule out burned FCU board issue. ", "If by now it is still can not work, then you should try other 3.8 or 3.7 with firmware 1.7.7 and 1.7.5 or whatever firmware you can access. as far as I know, their delay+ wait for ACK always have all sorts of issues. Maybe adding more delay in the wait for serial ack will help you(solution from other github dji_osdk post)", "In case of this particular A3 burned, swap another fresh open A3 and proven working FTDI cable(test with Arduino) to rule out the A3 problem", "If still no luck, file a ticket to dev@dji.com + send a complaint to Samuel@DJI. Send them the long list of thing you tested, and if they say high chance it is a hardware issue. Do send it back for RMA. I do have experience of one Normal A3 and one M600 A3 has burned FCU board issue before.", "After this, if you encounter can not fly GPS mission by OSDK or can not do local flight control. Just try different firmware version. DJI firmware release is usually very buggy for developer. ", "For you case, use windows. as i have no issue with windows based method\nMake sure the slider to the right with my image view. I have no MAC so cant test MAC solution. ", "YOu might need to plug in and un plug and plug in for couple time", "by default api is disabled. so you have to enable it and select the hz rate for topic you wish to receive. Good Luck. This is all I can do. "], "question_code": ["roslaunch dji_sdk sdk.launch\n", "... logging to /home/dji/.ros/log/b31d5e94-fec0-11e9-9835-74da38ebc18f/roslaunch-manifold2-18825.log\nChecking log directory for disk usage. This may take awhile.\nPress Ctrl-C to interrupt\nDone checking log file disk usage. Usage is <1GB.\n\nstarted roslaunch server http://manifold2:41911/\n\nSUMMARY\n\nPARAMETERS\n\n/dji_sdk/align_time: False\n/dji_sdk/app_id: 1079440\n/dji_sdk/app_version: 1\n/dji_sdk/baud_rate: 921600\n/dji_sdk/enc_key: 39d353a8e9ad01b6c...\n/dji_sdk/serial_name: /dev/ttyUSB0\n/dji_sdk/use_broadcast: False\n/rosdistro: kinetic\n/rosversion: 1.12.13\nNODES\n/\ndji_sdk (dji_sdk/dji_sdk_node)\n\nauto-starting new master\nprocess[master]: started with pid [18835]\nROS_MASTER_URI=http://localhost:11311\n\nsetting /run_id to b31d5e94-fec0-11e9-9835-74da38ebc18f\nprocess[rosout-1]: started with pid [18848]\nstarted core service [/rosout]\nprocess[dji_sdk-2]: started with pid [18856]\n\nSTATUS/1 @ init, L56: Attempting to open device /dev/ttyUSB0 with baudrate 921600...\n\nSTATUS/1 @ init, L66: ...Serial started successfully.\n\nERRORLOG/1 @ getDroneVersion, L1503: Drone version not obtained! Please do not proceed.\nPossible reasons:\nSerial port connection:\n\nSDK is not enabled, please check DJI Assistant2 -> SDK -> [v] Enable API Control.\nBaudrate is not correct, please double-check from DJI Assistant2 -> SDK -> baudrate.\nTX and RX pins are inverted.\nSerial port is occupied by another program.\nPermission required. Please do 'sudo usermod -a -G dialout $USER' (you do not need to replace $USER with your username). Then logout and login again\nERRORLOG/1 @ activate, L1387: Unable to initialize some vehicle components![ERROR] [1572843926.785053218]: drone activation error\n[ERROR] [1572843926.785190956]: Vehicle initialization failed\n^C[dji_sdk-2] killing on exit\n[rosout-1] killing on exit\n[master] killing on exit\nshutting down processing monitor...\n... shutting down processing monitor complete\ndone\n", "source devel/setup.bash\ncatkin_make\nrosed dji_sdk sdk.launch\n", "roslaunch dji_sdk sdk.launch\n", "usermod -a -G dialout $USER\n", "sudo chmod 666 /dev/ttyUSB0\n"], "url": "https://stackoverflow.com/questions/58688023/roslaunch-activation-failure-what-should-i-do"}
,{"title": "Recommendations for functions to update data in GUI with GTK", "time": "2019-05-10 07:41:44Z", "post_content": ["I am new to working with GTK and I am try to make a GUI to interface with ROS functionalities. To test my setup I have to be able to display and set the current values of certain parameters.", "I cannot seem to update the displayed values in the GUI.", "I have done multiple tutorials and already have my basic structure with a grid and box. I want the treeview in the box so I can add more widgets like buttons to the grid to expand the GUI further.", "This is the code:"], "answer": ["I was adding the data to the wrong structure. If you use the data that is already in the treeview it aperantly does not work", "if you use the liststore it does work", "thank you for your time"], "question_code": ["#!/usr/bin/env python\n\nimport sys\n#PyGtk library import\nimport gi\ngi.require_version(\"Gtk\",\"3.0\")\nfrom gi.repository import Gtk\nfrom gi.repository import GObject\n\n#ROS related initializations\n#import roslib; roslib.load_manifest('python_test')\nimport rospy\nimport os\nimport roslib; roslib.load_manifest('python_test')\nfrom std_msgs.msg import String\nfrom std_msgs.msg import Float32\nSpeed = 0\n\nclass MainWindow(Gtk.Window):\n    def __init__(self):\n\n        Populate = [(\"Speed\", 0 , \"M/S\"),\n            (\"Force\", 0, \"N\"),\n            (\"Get_Voltage\", 0 , \"V\"),\n            (\"Set_Voltage\", 0 , \"V\")]\n\n        Gtk.Window.__init__(self, title=\"Button clicker 2.0\")\n\n        grid  = Gtk.Grid()\n        self.add(grid)\n        newpng=roslib.packages.get_pkg_dir('python_test')+\"/src/axes.png\"\n        Layout = Gtk.Box()\n\n        Populate_List_Store = Gtk.ListStore(str, float, str)\n        for item in Populate:\n            Populate_List_Store.append(list(item))\n\n        #for row in Populate_List_Store:\n            #rospy.loginfo(row[:])\n            #rospy.loginfo(row[1])\n\n        # tree view is the iteam that is displayed\n        self.Populate_Tree_View = Gtk.TreeView(Populate_List_Store)\n\n        for i, Col_title in enumerate([\"Quantity\", \"Value\", \"Unit\"]):\n\n            # cell renderer Render means how to draw the data\n            Renderer = Gtk.CellRendererText()\n            #Create columns (text is column number)\n            Column = Gtk.TreeViewColumn(Col_title, Renderer, text=i)\n\n            # add Column to Treeview\n        self.Populate_Tree_View.append_column(Column)\n        Layout.pack_start(self.Populate_Tree_View, True, True, 0)\n        grid.add(Layout)\n            #Layout.pack_start(Populate_Tree_View, True, True, 0)\n\n        #button\n        button = Gtk.Button(label=\"Click here!\")\n        button.connect(\"clicked\", self.button_clicked)\n        grid.attach(button,1,0,2,1)\n\n        #node init\n\n        def Update_Speed(data):\n            global Speed\n            Speed = round(data.data,3)\n            rospy.loginfo(Speed)\n\n        def Update_Voltage_In(data):\n            global In_Voltage\n            In_Voltage = round(data.data,3)\n\n        self.pub = rospy.Publisher('chatter', String, queue_size=10)\n        rospy.init_node('talker')\n        self.sub1 = rospy.Subscriber('/io_states_sub_plot_node/piston_sensor_average', Float32, Update_Speed)\n        self.sub2 = rospy.Subscriber('/io_states_sub_plot_node/voltage_feed_back', Float32, Update_Voltage_In)\n\n    def Update_Param(self):\n        global Speed\n        self.Populate_Tree_View[0][1] = Speed\n\n    def button_clicked(self, widget):\n        self.talker() #Calls talker function which sends a ROS message\n        print (\"You clicked the button\")\n\n    def talker(self):\n            #ROS message hello world\n        if not rospy.is_shutdown():\n        str = \"hello world %s\"%rospy.get_time()\n        rospy.loginfo(str)\n        self.pub.publish(String(str))\n    def Timer1_timeout(self):\n        #Timer functions that sends ROS messages every second\n        self.talker()\n        return 1\n    def MainWindow_destroy(self,widget):\n        #MainWindow_destroy event\n        sys.exit(0)\n\nif __name__ == \"__main__\":\n    #start the class\n    window = MainWindow()\n    window.connect(\"delete-event\",Gtk.main_quit)\n    GObject.timeout_add(1000, window.Update_Param) #Adds a timer to the GUI, with window.Timer1_timeout as a\n    #callback function for the timer1\n    window.show_all()\n    Gtk.main()#Starts GTK\n", "update", "def talker(self):"], "answer_code": ["self.Populate_Tree_View[0][1] = Speed\n", "Populate_List_Store[0][1] = Speed\n"], "url": "https://stackoverflow.com/questions/56072402/recommendations-for-functions-to-update-data-in-gui-with-gtk"}
,{"title": "Android: NullPointerException 'double java.lang.Double.doubleValue()'", "time": "2019-10-04 07:25:11Z", "post_content": ["I'm new to android programming and I'm having a problem with my codes. Can anyone help me or point out the cause of my error because I'm not really sure why it's giving me a NullPointerException when its a text view or if that is possible.", "LogCat:", "Here is the code for that line:", "But when i run my app my voltage is setting null and here is the code for the voltage:", "Here is the full code:"], "answer": ["Check weather your created class with ", " is not null", "and then check class fields values  is not null or 0.", "You can check null before you set text on textview like the following.", "Everytime when you are setting the text to textview, you must need to check if it is not null."], "question_code": ["    java.lang.NullPointerException: Attempt to invoke virtual method 'double java.lang.Double.doubleValue()' on a null object reference\n    at com.example.app.rosbridge.MainActivity$2$1.run(MainActivity.java:133)\n", "   current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n", "   voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n", "public class MainActivity extends Activity {\n\n\nprivate TextView voltage, current, percentage, status;\nprivate SubscribedData<BatteryState> batteryStateData;\nprivate RosbridgeListener rosbridge;\nprivate boolean subscribed = false;\nprivate boolean advertised = false;\n\n/** Indicates that Lint should ignore the specified warnings for the annotated element. */\n@SuppressLint(\"ClickableViewAccessibility\")\n@Override\n\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main_activity);\n\n    Button settings_btn = (Button) findViewById(R.id.connect_btn);\n\n    voltage = findViewById(R.id.voltage_txt);\n    current = findViewById(R.id.current_txt);\n    percentage = findViewById(R.id.percentage_txt);\n    status = findViewById(R.id.status_txt);\n    connectButton = findViewById(R.id.connect_btn);\n\n    batteryStateData = new SubscribedData<>();\n    final Type batteryStateType = new TypeToken<SubscribedData<BatteryState>>() {\n    }.getType();\n\n\n    // ROSBRIDGE protocol allows access to underlying ROS messages and services as serialized JavaScript Object Notation (JSON) objects\n     WebSocket protocol communicates to a server for the connection from a user's web browser\n\n    //A connection to the rosbridge thru the IP address of the robot from the socket\n    rosbridge = new RosbridgeListener(\"ws://10.24.204.231:9090\");\n    rosbridge.setOnDataReceivedListener(new RosbridgeMessageListener() {\n\n        // a running thread that when the connection is made the data of the topic will serialize and deserialized java objects to (and from) JSON. @param msg\n\n            @Override\n            public void onDataReceived(final String msg) {\n                try {\n                    runOnUiThread(new Runnable() {\n                        @Override\n                        public void run() {\n                            batteryStateData = new Gson().fromJson(msg, batteryStateType);\n                            voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n                            current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n                            percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n                            status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n                        }\n                    });\n\n                    Log.d(\"B9T\", String.format(\"Received data: %s\", msg));\n                }\n                catch (Exception e)\n                {\n                    e.printStackTrace();\n                }\n            }\n        });\n\n    connectButton.setOnClickListener(new View.OnClickListener() {\n        @Override\n        public void onClick(View view) {\n\n            if (!subscribed) {\n                 rosbridge.Subscribe(\"/battery\", \"sensor_msgs/BatteryState\");\n                 subscribed = true;\n\n            connectButton.setText(\"Disconnect\");\n\n              } else {\n\n                rosbridge.UnSubscribe(\"/battery\");\n                subscribed = false;\n            connectButton.setText(\"Connect\");\n\n      }\n          }\n    });\n", "batteryStateData.msg.current "], "answer_code": ["batteryStateData = new Gson().fromJson(msg, batteryStateType);\nif (batteryStateData != null) {\n\n    if (batteryStateData.msg.voltage!=0)\n        voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n\n    if (batteryStateData.msg.current!=0)\n        current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n\n    if (batteryStateData.msg.percentage!=0)\n        percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n\n    if (batteryStateData.msg.values !=null)\n        status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n\n}\n", " @Override\n public void run() {\n     batteryStateData = new Gson().fromJson(msg, batteryStateType);\n\n     // check null before set text or calculate something\n     if(batteryStateData.msg.current != null){\n         current.setText(String.format(\"%.4f%s\", batteryStateData.msg.current * Math.pow(10, 6), \"A\"));\n     }\n     // you can check belows like above\n\n     voltage.setText(String.format(\"%.4f%s\", batteryStateData.msg.voltage, \"v\"));\n\n     percentage.setText(String.format(\"%.2f%s\", batteryStateData.msg.percentage, \"%\"));\n     status.setText(String.format(\"%s\", PowerSupplyStatus.values()[batteryStateData.msg.powerSupplyStatus]));\n}\n"], "url": "https://stackoverflow.com/questions/58230939/android-nullpointerexception-double-java-lang-double-doublevalue"}
,{"title": "Where is the iteration running in this code?", "time": "2015-12-02 03:02:12Z", "post_content": ["I'm using NatNet SDK to receiving data from the cameras through tcp connection. In their example code below, it can print the stream data using DataHandler function while waiting for a while(c=_getchar()) loop. I have no idea why the code can both waiting for keyboard input and at the same time printing the camera's data in the DataHandler function in real time. I didn't see the code run in multi threads. ", "My second question is that how I can get the stream data in a for loop in the main function. If someone can tell me how to use that DataHandler to get data in the main function, that will be great."], "answer": ["Very likely NatNetClient() or client->Initialize() is creating a new thread in the background. Since I do not have access to their code, I can't validate reliably. ", "You can either create a synchronous look in the main and always send and receive messages via NatNetClient::SendMessageAndWait \nor\nTo receive data asyncronously, you need to figure out a way to poll on stdin (for getch) and also wait on a lock simultaneously. I am not sure how to do this on Microsoft console. If you figure that out, then when the handler gets control, de-queue the message into a link-list and wakup a mutex to notify the main.", "The NatNet sample spins off a different thread for handling the data using the DataHandler function. The following line is where this happens: ", "I would recommend doing the processing strictly in the DataHandler function. However, if talking between threads in necessary, then it's worth looking into the C++ 11 libraries ", "Specifically ", " is used to lock and unlock threads in C++. You could create a global variable and write to it using the DataHandler function, then use that global variable in your main function. The problem is that you may read and write the data at the same time, because main and DataHandler are on different threads. So you can use the mutex library to lock a thread while reading or writing that global variable (meaning only that thread is allowed to run while doing that process).", "Note: The NatNet sample actually uses a UDP transmission not TCP."], "question_code": ["//=============================================================================\n// Copyright ?2014 NaturalPoint, Inc. All Rights Reserved.\n// \n// This software is provided by the copyright holders and contributors \"as is\" and\n// any express or implied warranties, including, but not limited to, the implied\n// warranties of merchantability and fitness for a particular purpose are disclaimed.\n// In no event shall NaturalPoint, Inc. or contributors be liable for any direct,\n// indirect, incidental, special, exemplary, or consequential damages\n// (including, but not limited to, procurement of substitute goods or services;\n// loss of use, data, or profits; or business interruption) however caused\n// and on any theory of liability, whether in contract, strict liability,\n// or tort (including negligence or otherwise) arising in any way out of\n// the use of this software, even if advised of the possibility of such damage.\n//=============================================================================\n\n\n/*\n\nSampleClient.cpp\n\nThis program connects to a NatNet server, receives a data stream, and writes that data stream\nto an ascii file.  The purpose is to illustrate using the NatNetClient class.\n\nUsage [optional]:\n\n    SampleClient [ServerIP] [LocalIP] [OutputFilename]\n\n    [ServerIP]          IP address of the server (e.g. 192.168.0.107) ( defaults to local machine)\n    [OutputFilename]    Name of points file (pts) to write out.  defaults to Client-output.pts\n\n*/\n\n#include <stdio.h>\n#include <tchar.h>\n#include <conio.h>\n#include <winsock2.h>\n\n#include \"NatNetTypes.h\"\n#include \"NatNetClient.h\"\n\n#pragma warning( disable : 4996 )\n\nvoid _WriteHeader(FILE* fp, sDataDescriptions* pBodyDefs);\nvoid _WriteFrame(FILE* fp, sFrameOfMocapData* data);\nvoid _WriteFooter(FILE* fp);\nvoid __cdecl DataHandler(sFrameOfMocapData* data, void* pUserData);     // receives data from the server\nvoid __cdecl MessageHandler(int msgType, char* msg);                    // receives NatNet error mesages\nvoid resetClient();\nint CreateClient(int iConnectionType);\n\nunsigned int MyServersDataPort = 3130;\nunsigned int MyServersCommandPort = 3131;\nint iConnectionType = ConnectionType_Multicast;\n//int iConnectionType = ConnectionType_Unicast;\n\nNatNetClient* theClient;\nFILE* fp;\n\nchar szMyIPAddress[128] = \"\";\nchar szServerIPAddress[128] = \"\";\n\nint analogSamplesPerMocapFrame = 0;\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n    int iResult;\n\n    // parse command line args\n    if(argc>1)\n    {\n        strcpy(szServerIPAddress, argv[1]); // specified on command line\n        printf(\"Connecting to server at %s...\\n\", szServerIPAddress);\n    }\n    else\n    {\n        strcpy(szServerIPAddress, \"\");      // not specified - assume server is local machine\n        printf(\"Connecting to server at LocalMachine\\n\");\n    }\n    if(argc>2)\n    {\n        strcpy(szMyIPAddress, argv[2]);     // specified on command line\n        printf(\"Connecting from %s...\\n\", szMyIPAddress);\n    }\n    else\n    {\n        strcpy(szMyIPAddress, \"\");          // not specified - assume server is local machine\n        printf(\"Connecting from LocalMachine...\\n\");\n    }\n\n    // Create NatNet Client\n    iResult = CreateClient(iConnectionType);\n    if(iResult != ErrorCode_OK)\n    {\n        printf(\"Error initializing client.  See log for details.  Exiting\");\n        return 1;\n    }\n    else\n    {\n        printf(\"Client initialized and ready.\\n\");\n    }\n\n\n    // send/receive test request\n    printf(\"[SampleClient] Sending Test Request\\n\");\n    void* response;\n    int nBytes;\n    iResult = theClient->SendMessageAndWait(\"TestRequest\", &response, &nBytes);\n    if (iResult == ErrorCode_OK)\n    {\n        printf(\"[SampleClient] Received: %s\", (char*)response);\n    }\n\n    // Retrieve Data Descriptions from server\n    printf(\"\\n\\n[SampleClient] Requesting Data Descriptions...\");\n    sDataDescriptions* pDataDefs = NULL;\n    int nBodies = theClient->GetDataDescriptions(&pDataDefs);\n    if(!pDataDefs)\n    {\n        printf(\"[SampleClient] Unable to retrieve Data Descriptions.\");\n    }\n    else\n    {\n        printf(\"[SampleClient] Received %d Data Descriptions:\\n\", pDataDefs->nDataDescriptions );\n        for(int i=0; i < pDataDefs->nDataDescriptions; i++)\n        {\n            printf(\"Data Description # %d (type=%d)\\n\", i, pDataDefs->arrDataDescriptions[i].type);\n            if(pDataDefs->arrDataDescriptions[i].type == Descriptor_MarkerSet)\n            {\n                // MarkerSet\n                sMarkerSetDescription* pMS = pDataDefs->arrDataDescriptions[i].Data.MarkerSetDescription;\n                printf(\"MarkerSet Name : %s\\n\", pMS->szName);\n                for(int i=0; i < pMS->nMarkers; i++)\n                    printf(\"%s\\n\", pMS->szMarkerNames[i]);\n\n            }\n            else if(pDataDefs->arrDataDescriptions[i].type == Descriptor_RigidBody)\n            {\n                // RigidBody\n                sRigidBodyDescription* pRB = pDataDefs->arrDataDescriptions[i].Data.RigidBodyDescription;\n                printf(\"RigidBody Name : %s\\n\", pRB->szName);\n                printf(\"RigidBody ID : %d\\n\", pRB->ID);\n                printf(\"RigidBody Parent ID : %d\\n\", pRB->parentID);\n                printf(\"Parent Offset : %3.2f,%3.2f,%3.2f\\n\", pRB->offsetx, pRB->offsety, pRB->offsetz);\n            }\n            else if(pDataDefs->arrDataDescriptions[i].type == Descriptor_Skeleton)\n            {\n                // Skeleton\n                sSkeletonDescription* pSK = pDataDefs->arrDataDescriptions[i].Data.SkeletonDescription;\n                printf(\"Skeleton Name : %s\\n\", pSK->szName);\n                printf(\"Skeleton ID : %d\\n\", pSK->skeletonID);\n                printf(\"RigidBody (Bone) Count : %d\\n\", pSK->nRigidBodies);\n                for(int j=0; j < pSK->nRigidBodies; j++)\n                {\n                    sRigidBodyDescription* pRB = &pSK->RigidBodies[j];\n                    printf(\"  RigidBody Name : %s\\n\", pRB->szName);\n                    printf(\"  RigidBody ID : %d\\n\", pRB->ID);\n                    printf(\"  RigidBody Parent ID : %d\\n\", pRB->parentID);\n                    printf(\"  Parent Offset : %3.2f,%3.2f,%3.2f\\n\", pRB->offsetx, pRB->offsety, pRB->offsetz);\n                }\n            }\n            else if(pDataDefs->arrDataDescriptions[i].type == Descriptor_ForcePlate)\n            {\n                // Force Plate\n                sForcePlateDescription* pFP = pDataDefs->arrDataDescriptions[i].Data.ForcePlateDescription;\n                printf(\"Force Plate ID : %d\\n\", pFP->ID);\n                printf(\"Force Plate Serial : %s\\n\", pFP->strSerialNo);\n                printf(\"Force Plate Width : %3.2f\\n\", pFP->fWidth);\n                printf(\"Force Plate Length : %3.2f\\n\", pFP->fLength);\n                printf(\"Force Plate Electrical Center Offset (%3.3f, %3.3f, %3.3f)\\n\", pFP->fOriginX,pFP->fOriginY, pFP->fOriginZ);\n                for(int iCorner=0; iCorner<4; iCorner++)\n                    printf(\"Force Plate Corner %d : (%3.4f, %3.4f, %3.4f)\\n\", iCorner, pFP->fCorners[iCorner][0],pFP->fCorners[iCorner][1],pFP->fCorners[iCorner][2]);\n                printf(\"Force Plate Type : %d\\n\", pFP->iPlateType);\n                printf(\"Force Plate Data Type : %d\\n\", pFP->iChannelDataType);\n                printf(\"Force Plate Channel Count : %d\\n\", pFP->nChannels);\n                for(int iChannel=0; iChannel<pFP->nChannels; iChannel++)\n                    printf(\"\\tChannel %d : %s\\n\", iChannel, pFP->szChannelNames[iChannel]);\n            }\n            else\n            {\n                printf(\"Unknown data type.\");\n                // Unknown\n            }\n        }      \n    }\n\n\n    // Create data file for writing received stream into\n    char szFile[MAX_PATH];\n    char szFolder[MAX_PATH];\n    GetCurrentDirectory(MAX_PATH, szFolder);\n    if(argc > 3)\n        sprintf(szFile, \"%s\\\\%s\", szFolder, argv[3]);\n    else\n        sprintf(szFile, \"%s\\\\Client-output.pts\",szFolder);\n    fp = fopen(szFile, \"w\");\n    if(!fp)\n    {\n        printf(\"error opening output file %s.  Exiting.\", szFile);\n        exit(1);\n    }\n    if(pDataDefs)\n        _WriteHeader(fp, pDataDefs);\n\n    // Ready to receive marker stream!\n    printf(\"\\nClient is connected to server and listening for data...\\n\");\n    int c;\n    bool bExit = false;\n    while(c =_getch())\n    {\n        switch(c)\n        {\n            case 'q':\n                bExit = true;       \n                break;  \n            case 'r':\n                resetClient();\n                break;  \n            case 'p':\n                sServerDescription ServerDescription;\n                memset(&ServerDescription, 0, sizeof(ServerDescription));\n                theClient->GetServerDescription(&ServerDescription);\n                if(!ServerDescription.HostPresent)\n                {\n                    printf(\"Unable to connect to server. Host not present. Exiting.\");\n                    return 1;\n                }\n                break;  \n            case 'f':\n                {\n                    sFrameOfMocapData* pData = theClient->GetLastFrameOfData();\n                    printf(\"Most Recent Frame: %d\", pData->iFrame);\n                }\n                break;  \n            case 'm':                           // change to multicast\n                iConnectionType = ConnectionType_Multicast;\n                iResult = CreateClient(iConnectionType);\n                if(iResult == ErrorCode_OK)\n                    printf(\"Client connection type changed to Multicast.\\n\\n\");\n                else\n                    printf(\"Error changing client connection type to Multicast.\\n\\n\");\n                break;\n            case 'u':                           // change to unicast\n                iConnectionType = ConnectionType_Unicast;\n                iResult = CreateClient(iConnectionType);\n                if(iResult == ErrorCode_OK)\n                    printf(\"Client connection type changed to Unicast.\\n\\n\");\n                else\n                    printf(\"Error changing client connection type to Unicast.\\n\\n\");\n                break;\n            case 'c' :                          // connect\n                iResult = CreateClient(iConnectionType);\n                break;\n            case 'd' :                          // disconnect\n                // note: applies to unicast connections only - indicates to Motive to stop sending packets to that client endpoint\n                iResult = theClient->SendMessageAndWait(\"Disconnect\", &response, &nBytes);\n                if (iResult == ErrorCode_OK)\n                    printf(\"[SampleClient] Disconnected\");\n                break;\n            default:\n                break;\n        }\n        if(bExit)\n            break;\n    }\n\n    // Done - clean up.\n    theClient->Uninitialize();\n    _WriteFooter(fp);\n    fclose(fp);\n\n    return ErrorCode_OK;\n}\n\n// Establish a NatNet Client connection\nint CreateClient(int iConnectionType)\n{\n    // release previous server\n    if(theClient)\n    {\n        theClient->Uninitialize();\n        delete theClient;\n    }\n\n    // create NatNet client\n    theClient = new NatNetClient(iConnectionType);\n\n\n\n    // set the callback handlers\n    theClient->SetVerbosityLevel(Verbosity_Warning);\n    theClient->SetMessageCallback(MessageHandler);\n    theClient->SetDataCallback( DataHandler, theClient );   // this function will receive data from the server\n    // [optional] use old multicast group\n    //theClient->SetMulticastAddress(\"224.0.0.1\");\n\n    // print version info\n    unsigned char ver[4];\n    theClient->NatNetVersion(ver);\n    printf(\"NatNet Sample Client (NatNet ver. %d.%d.%d.%d)\\n\", ver[0], ver[1], ver[2], ver[3]);\n\n    // Init Client and connect to NatNet server\n    // to use NatNet default port assignments\n    int retCode = theClient->Initialize(szMyIPAddress, szServerIPAddress);\n    // to use a different port for commands and/or data:\n    //int retCode = theClient->Initialize(szMyIPAddress, szServerIPAddress, MyServersCommandPort, MyServersDataPort);\n    if (retCode != ErrorCode_OK)\n    {\n        printf(\"Unable to connect to server.  Error code: %d. Exiting\", retCode);\n        return ErrorCode_Internal;\n    }\n    else\n    {\n        // get # of analog samples per mocap frame of data\n        void* pResult;\n        int ret = 0;\n        int nBytes = 0;\n        ret = theClient->SendMessageAndWait(\"AnalogSamplesPerMocapFrame\", &pResult, &nBytes);\n        if (ret == ErrorCode_OK)\n        {\n            analogSamplesPerMocapFrame = *((int*)pResult);\n            printf(\"Analog Samples Per Mocap Frame : %d\", analogSamplesPerMocapFrame);\n        }\n\n        // print server info\n        sServerDescription ServerDescription;\n        memset(&ServerDescription, 0, sizeof(ServerDescription));\n        theClient->GetServerDescription(&ServerDescription);\n        if(!ServerDescription.HostPresent)\n        {\n            printf(\"Unable to connect to server. Host not present. Exiting.\");\n            return 1;\n        }\n        printf(\"[SampleClient] Server application info:\\n\");\n        printf(\"Application: %s (ver. %d.%d.%d.%d)\\n\", ServerDescription.szHostApp, ServerDescription.HostAppVersion[0],\n            ServerDescription.HostAppVersion[1],ServerDescription.HostAppVersion[2],ServerDescription.HostAppVersion[3]);\n        printf(\"NatNet Version: %d.%d.%d.%d\\n\", ServerDescription.NatNetVersion[0], ServerDescription.NatNetVersion[1],\n            ServerDescription.NatNetVersion[2], ServerDescription.NatNetVersion[3]);\n        printf(\"Client IP:%s\\n\", szMyIPAddress);\n        printf(\"Server IP:%s\\n\", szServerIPAddress);\n        printf(\"Server Name:%s\\n\\n\", ServerDescription.szHostComputerName);\n    }\n\n    return ErrorCode_OK;\n\n}\n\n// DataHandler receives data from the server\nvoid __cdecl DataHandler(sFrameOfMocapData* data, void* pUserData)\n{\n    NatNetClient* pClient = (NatNetClient*) pUserData;\n\n    if(fp)\n        _WriteFrame(fp,data);\n\n    int i=0;\n\n    printf(\"FrameID : %d\\n\", data->iFrame);\n    printf(\"Timestamp :  %3.2lf\\n\", data->fTimestamp);\n    printf(\"Latency :  %3.2lf\\n\", data->fLatency);\n\n    // FrameOfMocapData params\n    bool bIsRecording = ((data->params & 0x01)!=0);\n    bool bTrackedModelsChanged = ((data->params & 0x02)!=0);\n    if(bIsRecording)\n        printf(\"RECORDING\\n\");\n    if(bTrackedModelsChanged)\n        printf(\"Models Changed.\\n\");\n\n\n    // timecode - for systems with an eSync and SMPTE timecode generator - decode to values\n    int hour, minute, second, frame, subframe;\n    bool bValid = pClient->DecodeTimecode(data->Timecode, data->TimecodeSubframe, &hour, &minute, &second, &frame, &subframe);\n    // decode to friendly string\n    char szTimecode[128] = \"\";\n    pClient->TimecodeStringify(data->Timecode, data->TimecodeSubframe, szTimecode, 128);\n    printf(\"Timecode : %s\\n\", szTimecode);\n\n    // Other Markers\n    printf(\"Other Markers [Count=%d]\\n\", data->nOtherMarkers);\n    for(i=0; i < data->nOtherMarkers; i++)\n    {\n        printf(\"Other Marker %d : %3.2f\\t%3.2f\\t%3.2f\\n\",\n            i,\n            data->OtherMarkers[i][0],\n            data->OtherMarkers[i][1],\n            data->OtherMarkers[i][2]);\n    }\n\n    // Rigid Bodies\n    printf(\"Rigid Bodies [Count=%d]\\n\", data->nRigidBodies);\n    for(i=0; i < data->nRigidBodies; i++)\n    {\n        // params\n        // 0x01 : bool, rigid body was successfully tracked in this frame\n        bool bTrackingValid = data->RigidBodies[i].params & 0x01;\n\n        printf(\"Rigid Body [ID=%d  Error=%3.2f  Valid=%d]\\n\", data->RigidBodies[i].ID, data->RigidBodies[i].MeanError, bTrackingValid);\n        printf(\"\\tx\\ty\\tz\\tqx\\tqy\\tqz\\tqw\\n\");\n        printf(\"\\t%3.2f\\t%3.2f\\t%3.2f\\t%3.2f\\t%3.2f\\t%3.2f\\t%3.2f\\n\",\n            data->RigidBodies[i].x,\n            data->RigidBodies[i].y,\n            data->RigidBodies[i].z,\n            data->RigidBodies[i].qx,\n            data->RigidBodies[i].qy,\n            data->RigidBodies[i].qz,\n            data->RigidBodies[i].qw);\n\n        printf(\"\\tRigid body markers [Count=%d]\\n\", data->RigidBodies[i].nMarkers);\n        for(int iMarker=0; iMarker < data->RigidBodies[i].nMarkers; iMarker++)\n        {\n            printf(\"\\t\\t\");\n            if(data->RigidBodies[i].MarkerIDs)\n                printf(\"MarkerID:%d\", data->RigidBodies[i].MarkerIDs[iMarker]);\n            if(data->RigidBodies[i].MarkerSizes)\n                printf(\"\\tMarkerSize:%3.2f\", data->RigidBodies[i].MarkerSizes[iMarker]);\n            if(data->RigidBodies[i].Markers)\n                printf(\"\\tMarkerPos:%3.2f,%3.2f,%3.2f\\n\" ,\n                    data->RigidBodies[i].Markers[iMarker][0],\n                    data->RigidBodies[i].Markers[iMarker][1],\n                    data->RigidBodies[i].Markers[iMarker][2]);\n        }\n    }\n\n    // skeletons\n    printf(\"Skeletons [Count=%d]\\n\", data->nSkeletons);\n    for(i=0; i < data->nSkeletons; i++)\n    {\n        sSkeletonData skData = data->Skeletons[i];\n        printf(\"Skeleton [ID=%d  Bone count=%d]\\n\", skData.skeletonID, skData.nRigidBodies);\n        for(int j=0; j< skData.nRigidBodies; j++)\n        {\n            sRigidBodyData rbData = skData.RigidBodyData[j];\n            printf(\"Bone %d\\t%3.2f\\t%3.2f\\t%3.2f\\t%3.2f\\t%3.2f\\t%3.2f\\t%3.2f\\n\",\n                rbData.ID, rbData.x, rbData.y, rbData.z, rbData.qx, rbData.qy, rbData.qz, rbData.qw );\n\n            printf(\"\\tRigid body markers [Count=%d]\\n\", rbData.nMarkers);\n            for(int iMarker=0; iMarker < rbData.nMarkers; iMarker++)\n            {\n                printf(\"\\t\\t\");\n                if(rbData.MarkerIDs)\n                    printf(\"MarkerID:%d\", rbData.MarkerIDs[iMarker]);\n                if(rbData.MarkerSizes)\n                    printf(\"\\tMarkerSize:%3.2f\", rbData.MarkerSizes[iMarker]);\n                if(rbData.Markers)\n                    printf(\"\\tMarkerPos:%3.2f,%3.2f,%3.2f\\n\" ,\n                    data->RigidBodies[i].Markers[iMarker][0],\n                    data->RigidBodies[i].Markers[iMarker][1],\n                    data->RigidBodies[i].Markers[iMarker][2]);\n            }\n        }\n    }\n\n    // labeled markers\n    bool bOccluded;     // marker was not visible (occluded) in this frame\n    bool bPCSolved;     // reported position provided by point cloud solve\n    bool bModelSolved;  // reported position provided by model solve\n    printf(\"Labeled Markers [Count=%d]\\n\", data->nLabeledMarkers);\n    for(i=0; i < data->nLabeledMarkers; i++)\n    {\n        bOccluded = ((data->LabeledMarkers[i].params & 0x01)!=0);\n        bPCSolved = ((data->LabeledMarkers[i].params & 0x02)!=0);\n        bModelSolved = ((data->LabeledMarkers[i].params & 0x04)!=0);\n        sMarker marker = data->LabeledMarkers[i];\n        int modelID, markerID;\n        theClient->DecodeID(marker.ID, &modelID, &markerID);\n        printf(\"Labeled Marker [ModelID=%d, MarkerID=%d, Occluded=%d, PCSolved=%d, ModelSolved=%d] [size=%3.2f] [pos=%3.2f,%3.2f,%3.2f]\\n\",\n            modelID, markerID, bOccluded, bPCSolved, bModelSolved,  marker.size, marker.x, marker.y, marker.z);\n    }\n\n    // force plates\n    if(data->nForcePlates==0)\n    {\n        printf(\"No Plates\\n\");\n    }\n    printf(\"Force Plate [Count=%d]\\n\", data->nForcePlates);\n    for(int iPlate=0; iPlate < data->nForcePlates; iPlate++)\n    {\n        printf(\"Force Plate %d\\n\", data->ForcePlates[iPlate].ID);\n        for(int iChannel=0; iChannel < data->ForcePlates[iPlate].nChannels; iChannel++)\n        {\n            printf(\"\\tChannel %d:\\t\", iChannel);\n            if(data->ForcePlates[iPlate].ChannelData[iChannel].nFrames == 0)\n            {\n                printf(\"\\tEmpty Frame\\n\");\n            }\n            else if(data->ForcePlates[iPlate].ChannelData[iChannel].nFrames != analogSamplesPerMocapFrame)\n            {\n                printf(\"\\tPartial Frame [Expected:%d   Actual:%d]\\n\", analogSamplesPerMocapFrame, data->ForcePlates[iPlate].ChannelData[iChannel].nFrames);\n            }\n            for(int iSample=0; iSample < data->ForcePlates[iPlate].ChannelData[iChannel].nFrames; iSample++)\n                printf(\"%3.2f\\t\", data->ForcePlates[iPlate].ChannelData[iChannel].Values[iSample]);\n            printf(\"\\n\");\n        }\n    }\n\n}\n\n// MessageHandler receives NatNet error/debug messages\nvoid __cdecl MessageHandler(int msgType, char* msg)\n{\n    printf(\"\\n%s\\n\", msg);\n}\n\n/* File writing routines */\nvoid _WriteHeader(FILE* fp, sDataDescriptions* pBodyDefs)\n{\n    int i=0;\n\n    if(!pBodyDefs->arrDataDescriptions[0].type == Descriptor_MarkerSet)\n        return;\n\n    sMarkerSetDescription* pMS = pBodyDefs->arrDataDescriptions[0].Data.MarkerSetDescription;\n\n    fprintf(fp, \"<MarkerSet>\\n\\n\");\n    fprintf(fp, \"<Name>\\n%s\\n</Name>\\n\\n\", pMS->szName);\n\n    fprintf(fp, \"<Markers>\\n\");\n    for(i=0; i < pMS->nMarkers; i++)\n    {\n        fprintf(fp, \"%s\\n\", pMS->szMarkerNames[i]);\n    }\n    fprintf(fp, \"</Markers>\\n\\n\");\n\n    fprintf(fp, \"<Data>\\n\");\n    fprintf(fp, \"Frame#\\t\");\n    for(i=0; i < pMS->nMarkers; i++)\n    {\n        fprintf(fp, \"M%dX\\tM%dY\\tM%dZ\\t\", i, i, i);\n    }\n    fprintf(fp,\"\\n\");\n\n}\n\nvoid _WriteFrame(FILE* fp, sFrameOfMocapData* data)\n{\n    fprintf(fp, \"%d\", data->iFrame);\n    for(int i =0; i < data->MocapData->nMarkers; i++)\n    {\n        fprintf(fp, \"\\t%.5f\\t%.5f\\t%.5f\", data->MocapData->Markers[i][0], data->MocapData->Markers[i][1], data->MocapData->Markers[i][2]);\n    }\n    fprintf(fp, \"\\n\");\n}\n\nvoid _WriteFooter(FILE* fp)\n{\n    fprintf(fp, \"</Data>\\n\\n\");\n    fprintf(fp, \"</MarkerSet>\\n\");\n}\n\nvoid resetClient()\n{\n    int iSuccess;\n\n    printf(\"\\n\\nre-setting Client\\n\\n.\");\n\n    iSuccess = theClient->Uninitialize();\n    if(iSuccess != 0)\n        printf(\"error un-initting Client\\n\");\n\n    iSuccess = theClient->Initialize(szMyIPAddress, szServerIPAddress);\n    if(iSuccess != 0)\n        printf(\"error re-initting Client\\n\");\n\n\n}\n"], "answer_code": ["theClient->SetDataCallback( DataHandler, theClient ); \n", "#include <threads>\n#include <mutex>\n"], "url": "https://stackoverflow.com/questions/34034157/where-is-the-iteration-running-in-this-code"}
,{"title": "How to exit a C++ program with Ctrl+C, if I/O read() is in blocking stage?", "time": "2019-12-19 17:12:48Z", "post_content": ["I am working on ROS environment, and trying to read CANBUS on a parallel thread. I initialized canbus in main thread because I want to make sure that CAN cables are connected. By initializing, I mean ", ", ", ", ", " to configure the socket.", "Problem: If there is no incoming CAN messages, ", " is blocked. Ctrl+C doesn't terminate the C++11 Program.", "How can I make the ", " terminate and so the whole program?", "\nThis post proposed a solution for POSIX. I am working on ubuntu16.04."], "answer": ["If you want to mimic the interrupt behavior on the other threads, those threads have to allow interruption, and your signal handling thread has to deliver the signal to them. Consider the following snippet:", "Quitting is communicated by setting a global variable. A thread is to wakeup and check that variable. Waking up the thread is a matter of visiting the thread and sending it a signal.", "In the event a worker thread intercepts ", " before the main thread does, then it sends it to the main thread to initiate a proper shutdown sequence.", "In order to allow being interrupted, a thread may call ", ".", "We define two ways of installing a signal handler, one using ", ", the other using ", ", but using a flag that provides semantics similar to ", ".", "The main thread installs the signal handler, initializes ", ", and populates the container with the worker threads that need to be shutdown later.", "Below is a small example of how to use the self-pipe trick to cause an I/O thread to gracefully exit when a CTRL-C is received.  Note that for simplicity's sake, the I/O event loop in the example is done in the main() thread rather than in a separate thread, but the technique works regardless of which thread the event-loop is in -- the signal-handler callback writes a byte to one end of the pipe(), which causes the thread select()-ing on the other end of the pipe to return from select with the pipe's fd in the ready-to-read state.  Once it detects that (via FD_ISSET()), the I/O event loop knows that it is time to exit."], "question_code": ["setsockopt()", "ioctl()", "bind()", "void readCanbus(int soktId) {\n    while(true)\n        int nbytes = read(soktId, ...);\n}\n\nint main() {\n    int soktId;\n    someSocketSetupFn(soktId);\n\n    std::thread t(readCanbus, soktId);\n\n    t.join();\n}\n", "read()", "read()", "select()", "poll()"], "answer_code": ["static volatile std::atomic<bool> quit;\nstatic volatile std::deque<std::thread> all;\nstatic volatile pthread_t main_thread;\n\nvoid sigint_handler (int) {\n    if (pthread_self() == main_thread) {\n        write(2, \"\\rQuitting.\\n\", 11);\n        quit = true;\n        for (auto &t : all) pthread_kill(t.native_handle(), SIGINT);\n    } else if (!quit) pthread_kill(main_thread, SIGINT);\n}\n", "SIGINT", "siginterrupt()", "void readCanbus(int s) {\n    siginterrupt(SIGINT, 1);\n    while(!quit) {\n        char buf[256];\n        int nbytes = read(s, buf, sizeof(buf));\n    }\n    write(2, \"Quit.\\n\", 6);\n}\n", "signal", "sigaction", "signal", "template <decltype(signal)>\nvoid sighandler(int sig, sighandler_t handler) {\n    signal(sig, handler);\n}\n\ntemplate <decltype(sigaction)>\nvoid sighandler(int sig, sighandler_t handler) {\n    struct sigaction sa = {};\n    sa.sa_handler = handler;\n    sa.sa_flags = SA_RESTART;\n    sigaction(sig, &sa, NULL);\n}\n", "main_thread", "int main () {\n    int sp[2];\n    main_thread = pthread_self();\n    socketpair(AF_UNIX, SOCK_STREAM, 0, sp);\n    all.push_back(std::thread(readCanbus, sp[0]));\n    sighandler<sigaction>(SIGINT, sigint_handler);\n    for (auto &t : all) t.join();\n}\n", "sigaction()", "signal()", "#include <errno.h>\n#include <fcntl.h>\n#include <signal.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/select.h>\n#include <sys/socket.h>\n\nint _signalHandlerFD;\n\nstatic void MySignalHandler(int sig)\n{\n   if (sig == SIGINT)\n   {\n      printf(\"Control-C/SIGINT detected!  Signaling main thread to shut down\\n\");\n      char junk = 'x';\n      if (write(_signalHandlerFD, &junk, sizeof(junk)) != sizeof(junk)) perror(\"send\");\n   }\n}\n\n/** Sets the given socket to blocking-mode (the default) or non-blocking mode\n  * In order to make sure a given socket never blocks inside recv() or send(),\n  * call SetSocketBlockingEnabled(fd, false)\n  */\nbool SetSocketBlockingEnabled(int fd, bool blocking)\n{\n   if (fd < 0) return false;\n\n#ifdef _WIN32\n   unsigned long mode = blocking ? 0 : 1;\n   return (ioctlsocket(fd, FIONBIO, &mode) == 0) ? true : false;\n#else\n   int flags = fcntl(fd, F_GETFL, 0);\n   if (flags == -1) return false;\n   flags = blocking ? (flags & ~O_NONBLOCK) : (flags | O_NONBLOCK);\n   return (fcntl(fd, F_SETFL, flags) == 0) ? true : false;\n#endif\n}\n\nint main(int, char **)\n{\n   // Create a pipe that our signal-handler can use\n   // to signal our I/O thread\n   int pipefds[2];\n   if (pipe(pipefds) != 0)\n   {\n      perror(\"pipe\");\n      exit(10);\n   }\n   _signalHandlerFD = pipefds[1];  // the \"write\" end of the pipe\n\n   // Install our signal handler\n   if (signal(SIGINT, MySignalHandler) != 0)\n   {\n      perror(\"signal\");\n      exit(10);\n   }\n\n   // Now we do our I/O event loop (a real program might\n   // do this in a separate thread, but it can work anywhere\n   // so for simplicity I'm doing it here)\n   const int timeToQuitFD = pipefds[0];\n   while(1)\n   {\n      fd_set readFDs;\n      FD_ZERO(&readFDs);\n      FD_SET(timeToQuitFD, &readFDs);\n\n      int maxFD = timeToQuitFD;\n\n      // If you have other sockets you want to read from,\n      // call FD_SET(theSocket, &readFDS) on them here, and\n      // update maxFD be to the maximum socket-fd value across\n      // of all of the sockets you want select() to watch\n\n      // select() will not return until at least one socket\n      // specified by readFDs is ready-to-be-read-from.\n      if (select(maxFD+1, &readFDs, NULL, NULL, NULL) >= 0)\n      {\n         if (FD_ISSET(timeToQuitFD, &readFDs))\n         {\n            printf(\"Signal handler told the main thread it's time to quit!\\n\");\n            break;\n         }\n\n         // also call FD_ISSET() on any other sockets here, and\n         // read() from them iff it returns true\n      }\n      else if (errno != EINTR)\n      {\n         perror(\"select()\");\n         break;\n      }\n   }\n   printf(\"main thread exiting, bye!\\n\");\n\n   return 0;\n}\n"], "url": "https://stackoverflow.com/questions/59413344/how-to-exit-a-c-program-with-ctrlc-if-i-o-read-is-in-blocking-stage"}
,{"title": "how to get a value-object from another method in python", "time": "2013-04-26 07:24:01Z", "post_content": ["I can't really understand what I'm doing wrong.. I try to get a value-object from another method.. this is my code", "But, I get this error", "How that problem solved ???", "Note :", "rospy.Subscriber('robotis/servo_head_pan_joint', Float64, self.posisi_ax12_pan)", "rospy.Subscriber('robotis/servo_head_tilt_joint', Float64, self.posisi_ax12_tilt)", "rospy.Subscriber('robotis/servo_right_elbow_joint', Float64, self.posisi_ax12_elbow)", "rospy.Subscriber is a line command to insert Float64 data for self.posisi_ax12_pan method, self.posisi_ax12_tilt method and self.posisi_ax12_elbow."], "answer": ["Obviously ", " and ", " called later (after events that you subscribing are occured) than ", ", so, you should init this attributes - self.posisi_pan_servo and self.posisi_tilt_servo:", "The error says ", " does not exist. You only seem to define this variable in ", ". That means the method ", " was not yet called when you tried to access that attribute within ", ".", "I guess that a call to ", " methods should be done before calling ", " in the constructor.", "Looks like you are not executing the method posisi_pan_servo, which initialize the attribute 'posisi_pan_servo'", "You should execute it before, trying to get that attribute.", "Maybe in the ", " method you should invoke the method. So try to change from:", "To:", "Passing a the right parameters in that invoke.", "But other thing is deep test the rospy.Subscriber method, to check if it is working as you expect"], "question_code": ["#!/usr/bin/env python\n\n\nclass tracksendi():\n    def __init__(self):\n        rospy.on_shutdown(self.shutdown)\n\n        rospy.Subscriber('robotis/servo_head_pan_joint',\n                         Float64, self.posisi_ax12_pan)\n        rospy.Subscriber('robotis/servo_head_tilt_joint',\n                         Float64, self.posisi_ax12_tilt)\n        rospy.Subscriber('robotis/servo_right_elbow_joint',\n                         Float64, self.posisi_ax12_elbow)\n\n        while not rospy.is_shutdown():\n            self.operasikan_servo()\n            rate.sleep()\n\n    def posisi_ax12_pan(self,pan):\n        self.posisi_pan_servo = pan.data   \n        return\n\n    def posisi_ax12_tilt(self,tilt):\n        self.posisi_tilt_servo = tilt.data\n        return     \n\n    def posisi_ax12_elbow(self,elbow):\n        self.posisi_elbow_data = elbow.data\n        return\n\n    def ambil_timestamp(self,waktu):\n        self.data_time_joint_states = waktu.header.stamp\n        return             \n\n    def operasikan_servo(self):\n    # Lengan Kanan\n        try:\n\n            vektor_n_rs = self.posisi_pan_servo - self.posisi_tilt_servo\n            vektor_re_rs = self.posisi_tilt_servo - self.posisi_elbow_data\n\n        except KeyError:\n            pass\n\n\nif __name__ == '__main__':\n    try:\n        tracksendi()\n    except rospy.ROSInterruptException:\n        pass\n", "vektor_n_rs = self.posisi_pan_servo - self.posisi_tilt_servo  \n\nAttributeError: tracksendi instance has no attribute 'posisi_pan_servo'\n"], "answer_code": ["   def __init__(self):\n        rospy.on_shutdown(self.shutdown)\n        self.posisi_pan_servo = 0 # or any number you want\n        self.posisi_tilt_servo = 0 # or any number you want\n        #....\n", "self.posisi_pan_servo", "posisi_ax12_pan()", "posisi_ax12_pan()", "operasikan_servo()", "posisi_ax12_*", "operasikan_servo", "rospy.Subscriber('robotis/servo_head_pan_joint', Float64, self.posisi_ax12_pan)\n", "rospy.Subscriber('robotis/servo_head_pan_joint', Float64, self.posisi_ax12_pan(pan))\n"], "url": "https://stackoverflow.com/questions/16230816/how-to-get-a-value-object-from-another-method-in-python"}
,{"title": "\u201cSegmentation fault (core dumped)\u201d in pcl code when i try to come to Plane Model Segmentation", "time": "2019-08-01 02:46:14Z", "post_content": ["there is a \"Segmentation fault (core dumped)\" when i try to make up Plane Model Segmentation with pcl.", "this is a .cpp file which running in ubuntu16.04, CMake,  pcl-1.8, ", "that is the whole code,when i catkin_make it will be ok,but when i rosrun, it show the error:Segmentation fault (core dumped)\ni think there isn't the null ptr in definations, and no multithread, no used string.and i don't know how to do."], "answer": [], "question_code": ["    #include <pcl-1.8/pcl/filters/extract_indices.h>\n    #include <pcl-1.8/pcl/filters/impl/extract_indices.hpp>\n    #include <pcl-1.8/pcl/segmentation/sac_segmentation.h>\n    #include <pcl-1.8/pcl/segmentation/impl/sac_segmentation.hpp>\n\n    PCL_INSTANTIATE(SacSegmentationExtraction, PointXYZIT);\n\n    void remove_wake(pcl::PointCloud<PointXYZIT>::Ptr in_filtered, pcl::PointCloud<PointXYZIT>::Ptr out_filtered)\n    {\n      pcl::ModelCoefficients::Ptr coefficients (new pcl::ModelCoefficients);\n      pcl::PointIndices::Ptr inliers (new pcl::PointIndices);\n\n      pcl::SACSegmentation<PointXYZIT> seg;\n      seg.setOptimizeCoefficients (true);\n      seg.setModelType (pcl::SACMODEL_PLANE);\n      seg.setMethodType (pcl::SAC_RANSAC);\n\n      seg.setDistanceThreshold (0.2);\n      seg.setInputCloud (in_filtered);\n      seg.segment (*inliers, *coefficients);\n\n      std::cerr << \"Model coefficients: \" << coefficients->values[0] << \" \" \n                                  << coefficients->values[1] << \" \"\n                                  << coefficients->values[2] << \" \" \n                                  << coefficients->values[3] << std::endl;\n\n      std::cerr << \"Model inliers: \" << inliers->indices.size () << std::endl;\n\n\n      pcl::ExtractIndices<PointXYZIT> extract;\n      extract.setInputCloud (in_filtered);\n      extract.setIndices (inliers); \n      extract.setNegative (true);\n      extract.filter (*out_filtered);\n      pcl::io::savePCDFileASCII<PointXYZIT>(\"remove_plane.pcd\", *out_filtered);\n    }\n", "in_filtered == nullptr", "out_filtered == nullptr"], "url": "https://stackoverflow.com/questions/57301200/segmentation-fault-core-dumped-in-pcl-code-when-i-try-to-come-to-plane-model"}
,{"title": "how a \u201cnonstatic member reference must be relative to a specific object\u201d can be solved accessing different function", "time": "2019-05-22 19:44:22Z", "post_content": ["I am trying to pass some function for testing, into a ", " node as shown below. \nHowever, I am getting the following ", ". \nI was doing a good amount of research about this probelm, like for example I found ", " that had a similar problem, also ", " that was explaining how to access and understand the relationship with the \"parent\" instance. I applied what was advised ", " and thanks to passing ", " on the main I was partially able to access to the ", " that has the function ", " that I am trying to access from ", " but still something is not totally correct.", "I know that it is not correct to make the members static by simply adding the \"static\" keyword, and that I need to define them as well, and that is the reason why the function is specifically set as ", "\nI am passing ampersend ", " on purpose to pass it by reference to ", " but it seems that the function is never received.", "This is the ", ", notice the ", " function that is having the issue in the ", ":", "and finally this is the ", "Can anyone point to the right direction or provide an explanation on why it is still not possible to access to the function contained in the class from the ", "? Thanks for shedding light on this."], "answer": ["Since you have not provided declaration of subscribe but it seems your problem is related to passing class member functions to other function so below solution provide two ways of achieving that one by lambdas and other by bind."], "question_code": ["main()", "non static member reference must be relative to a specific object", "madgwick::MADGWICK_reader obj(std::string file);", "class MADGWICK_reader", "void filter_function(const sensor_msgs::Imu &msg);", "main", "void filter_function(const sensor_msgs::Imu &msg);", "&", "main", "void filter_function(const sensor_msgs::Imu &msg);", "main", "namespace madgwick\n{\n    using timestamp_t = uint64_t;\n    using timestampToDouble_t = double;\n\n    struct IMU_MADGWICK_DATA\n    {\n        double magz;\n        double magy;\n        double magx;\n        float accelz;\n        float accelx;\n        float accely;\n        unsigned long timestamp;\n        double phi;   // orientation\n        double psi;   // orientation\n        double theta; // orientation\n        double gyrox; // angular velocity x\n        double gyroy; // angular velocity y\n        double gyroz; // angular velocity z\n    };\n\n\n    class Madgwick\n    {\n    public:\n      Madgwick();\n\n    };\n\n    class MADGWICK_reader\n    {\n    public:\n        MADGWICK_reader(std::string filename);\n        bool nextLine();\n        bool nextLineWithSupport();\n\n        IMU_MADGWICK_DATA madgwick_data;\n\n        sensor_msgs::Imu imuMadgwickMsg;\n        sensor_msgs::MagneticField magMedgwickMsg;\n\n        geometry_msgs::QuaternionStamped q;\n        geometry_msgs::Vector3Stamped v;\n        geometry_msgs::TransformStamped q_trans;\n        float sampleFreq;\n        double beta;\n        double q0=1.0, q1=0.0, q2=0.0, q3=0.0;\n        std_msgs::Header header;\n        float ax, ay, az, gx, gy, gz;\n        ros::Duration dtime;\n        float dt;\n\n        float invSqrt();\n        void qua2Euler(geometry_msgs::QuaternionStamped);\n        void madgwickIMU(float gx, float gy, float gz, float ax, float ay, float az);\n        void filter_function(const sensor_msgs::Imu &msg);\n\n    private:\n        io::CSVReader<13> madg_imu_reader;\n        unsigned int imuMadgNum;\n        unsigned int magMadgNum;\n        void packMadgMagMsg();\n        void pack_Imu_Madgwick_Msg();\n        void pack_Mag_Madgwick_Msg();\n    };\n}\n", "namespace madgwick\n{\n    Madgwick::Madgwick()\n    {\n\n    }\n\n    MADGWICK_reader::MADGWICK_reader(std::string filename):\n        madg_imu_reader(filename)\n    {\n        // operations ...\n    }\n\n    void MADGWICK_reader::filter_function(const sensor_msgs::Imu &msg)\n    {\n        timestampToDouble_t currentTime = (madgwick_data.timestamp)/1e6;\n        ros::Time stamp(currentTime);\n        header = msg.header;\n        ax = float(msg.linear_acceleration.x);\n        ay = float(msg.linear_acceleration.y);\n        az = float(msg.linear_acceleration.z);\n\n        // more operations ...\n    }\n}\n", "#include \"imu_filter_madgwick/madgwick_filter.h\"\n#include <iostream>\n\n    int main(int argc, char** argv)\n    {\n        ros::init(argc, argv, \"madgwick_filter_node\");\n        madgwick::MADGWICK_reader reader(std::string filename);\n\n        ros::NodeHandle n;\n        ros::Publisher pub1 = n.advertise<geometry_msgs::QuaternionStamped>(\"quaternion\", 1);\n        ros::Publisher pub2 = n.advertise<geometry_msgs::Vector3Stamped>(\"ypr\", 1);\n\n        tf::TransformBroadcaster q_brodecaster;\n\n        madgwick::MADGWICK_reader obj(std::string file);\n\n        ros::Subscriber sub = n.subscribe(\"imu0\", 10, obj.filter_function); // <-- Error Here\n\n        ros::spin();\n    }\n", "main", "[&obj](<params>){return obj.filter_function(<params>);", "ross::NodeHandle::subscribe", "this", "subscribe", "obj.filter_function", "std::bind", "std::bind"], "answer_code": ["#include <iostream>\n#include <functional>\nclass Test{\n    public:\n    void fun(int x)\n    {\n        std::cout<<\"I am having fun in Test with number \"<<x<<std::endl;\n    }\n};\nvoid sampleFunction(std::function<void(int)> sf,int x)\n{\n    sf(x);\n}\nint main()\n{\n    Test obj;\n    auto objf = std::bind(&Test::fun,&obj,std::placeholders::_1);\n    sampleFunction(objf,5);\n\n    auto lf = [&obj](int y) { return obj.fun(y); };\n    sampleFunction(lf,6);\n    return 0;\n}\n"], "url": "https://stackoverflow.com/questions/56263914/how-a-nonstatic-member-reference-must-be-relative-to-a-specific-object-can-be"}
]
